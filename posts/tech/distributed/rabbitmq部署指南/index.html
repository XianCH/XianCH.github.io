<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>RabbitMqéƒ¨ç½²æŒ‡å— | X14n&#39;s Blog</title>
<meta name="keywords" content="">
<meta name="description" content="rocketmqè™šæ‹Ÿæœºéƒ¨ç½²å’Œdockeréƒ¨ç½²">
<meta name="author" content="x14n">
<link rel="canonical" href="https://XianCH.github.io/posts/tech/distributed/rabbitmq%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.css" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.js" onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://XianCH.github.io/img/favicon.icon">
<link rel="icon" type="image/png" sizes="16x16" href="https://XianCH.github.io/img/main.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://XianCH.github.io/img/main.png">
<link rel="apple-touch-icon" href="https://XianCH.github.io/img/main.png">
<link rel="mask-icon" href="https://XianCH.github.io/img/main.png">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>
<script defer src="https://unpkg.com/mermaid@8.8.1/dist/mermaid.min.js"></script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
<script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.min.js"></script>



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = ""; 
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<meta property="og:title" content="RabbitMqéƒ¨ç½²æŒ‡å—" />
<meta property="og:description" content="rocketmqè™šæ‹Ÿæœºéƒ¨ç½²å’Œdockeréƒ¨ç½²" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://XianCH.github.io/posts/tech/distributed/rabbitmq%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97/" />
<meta property="og:image" content="https://XianCH.github.io/postsImg/rabbitMq.png" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-10-19T10:16:51+00:00" />
<meta property="article:modified_time" content="2023-09-22T10:16:51+00:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://XianCH.github.io/postsImg/rabbitMq.png" />
<meta name="twitter:title" content="RabbitMqéƒ¨ç½²æŒ‡å—"/>
<meta name="twitter:description" content="rocketmqè™šæ‹Ÿæœºéƒ¨ç½²å’Œdockeréƒ¨ç½²"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [

        {
          "@type": "ListItem",
          "position":  1 ,
          "name": "ğŸ“šæ–‡ç« ",
          "item": "https://XianCH.github.io/posts/"
        },

        {
          "@type": "ListItem",
          "position":  2 ,
          "name": "ğŸ‘¨ğŸ»â€ğŸ’» æŠ€æœ¯",
          "item": "https://XianCH.github.io/posts/tech/"
        }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "RabbitMqéƒ¨ç½²æŒ‡å—",
      "item": "https://XianCH.github.io/posts/tech/distributed/rabbitmq%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "RabbitMqéƒ¨ç½²æŒ‡å—",
  "name": "RabbitMqéƒ¨ç½²æŒ‡å—",
  "description": "rocketmqè™šæ‹Ÿæœºéƒ¨ç½²å’Œdockeréƒ¨ç½²",
  "keywords": [
    ""
  ],
  "articleBody": "1.å•æœºéƒ¨ç½² æˆ‘ä»¬åœ¨Centos7è™šæ‹Ÿæœºä¸­ä½¿ç”¨Dockeræ¥å®‰è£…ã€‚\n1.1.ä¸‹è½½é•œåƒ æ–¹å¼ä¸€ï¼šåœ¨çº¿æ‹‰å–\ndocker pull rabbitmq:3.8-management æ–¹å¼äºŒï¼šä»æœ¬åœ°åŠ è½½\nåœ¨è¯¾å‰èµ„æ–™å·²ç»æä¾›äº†é•œåƒåŒ…ï¼š\nä¸Šä¼ åˆ°è™šæ‹Ÿæœºä¸­åï¼Œä½¿ç”¨å‘½ä»¤åŠ è½½é•œåƒå³å¯ï¼š\ndocker load -i mq.tar 1.2.å®‰è£…MQ æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ¥è¿è¡ŒMQå®¹å™¨ï¼š\ndocker run \\ -e RABBITMQ_DEFAULT_USER=itcast \\ -e RABBITMQ_DEFAULT_PASS=123321 \\ -v mq-plugins:/plugins \\ --name mq \\ --hostname mq1 \\ -p 15672:15672 \\ -p 5672:5672 \\ -d \\ rabbitmq:3.8-management 2.å®‰è£…DelayExchangeæ’ä»¶ å®˜æ–¹çš„å®‰è£…æŒ‡å—åœ°å€ä¸ºï¼šhttps://blog.rabbitmq.com/posts/2015/04/scheduling-messages-with-rabbitmq\nä¸Šè¿°æ–‡æ¡£æ˜¯åŸºäºlinuxåŸç”Ÿå®‰è£…RabbitMQï¼Œç„¶åå®‰è£…æ’ä»¶ã€‚\nå› ä¸ºæˆ‘ä»¬ä¹‹å‰æ˜¯åŸºäºDockerå®‰è£…RabbitMQï¼Œæ‰€ä»¥ä¸‹é¢æˆ‘ä»¬ä¼šè®²è§£åŸºäºDockeræ¥å®‰è£…RabbitMQæ’ä»¶ã€‚\n2.1.ä¸‹è½½æ’ä»¶ RabbitMQæœ‰ä¸€ä¸ªå®˜æ–¹çš„æ’ä»¶ç¤¾åŒºï¼Œåœ°å€ä¸ºï¼šhttps://www.rabbitmq.com/community-plugins.html\nå…¶ä¸­åŒ…å«å„ç§å„æ ·çš„æ’ä»¶ï¼ŒåŒ…æ‹¬æˆ‘ä»¬è¦ä½¿ç”¨çš„DelayExchangeæ’ä»¶ï¼š\nå¤§å®¶å¯ä»¥å»å¯¹åº”çš„GitHubé¡µé¢ä¸‹è½½3.8.9ç‰ˆæœ¬çš„æ’ä»¶ï¼Œåœ°å€ä¸ºhttps://github.com/rabbitmq/rabbitmq-delayed-message-exchange/releases/tag/3.8.9è¿™ä¸ªå¯¹åº”RabbitMQçš„3.8.5ä»¥ä¸Šç‰ˆæœ¬ã€‚\nè¯¾å‰èµ„æ–™ä¹Ÿæä¾›äº†ä¸‹è½½å¥½çš„æ’ä»¶ï¼š\n2.2.ä¸Šä¼ æ’ä»¶ å› ä¸ºæˆ‘ä»¬æ˜¯åŸºäºDockerå®‰è£…ï¼Œæ‰€ä»¥éœ€è¦å…ˆæŸ¥çœ‹RabbitMQçš„æ’ä»¶ç›®å½•å¯¹åº”çš„æ•°æ®å·ã€‚å¦‚æœä¸æ˜¯åŸºäºDockerçš„åŒå­¦ï¼Œè¯·å‚è€ƒç¬¬ä¸€ç« éƒ¨åˆ†ï¼Œé‡æ–°åˆ›å»ºDockerå®¹å™¨ã€‚\næˆ‘ä»¬ä¹‹å‰è®¾å®šçš„RabbitMQçš„æ•°æ®å·åç§°ä¸ºmq-pluginsï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ä¸‹é¢å‘½ä»¤æŸ¥çœ‹æ•°æ®å·ï¼š\ndocker volume inspect mq-plugins å¯ä»¥å¾—åˆ°ä¸‹é¢ç»“æœï¼š\næ¥ä¸‹æ¥ï¼Œå°†æ’ä»¶ä¸Šä¼ åˆ°è¿™ä¸ªç›®å½•å³å¯ï¼š\n2.3.å®‰è£…æ’ä»¶ æœ€åå°±æ˜¯å®‰è£…äº†ï¼Œéœ€è¦è¿›å…¥MQå®¹å™¨å†…éƒ¨æ¥æ‰§è¡Œå®‰è£…ã€‚æˆ‘çš„å®¹å™¨åä¸ºmqï¼Œæ‰€ä»¥æ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼š\ndocker exec -it mq bash æ‰§è¡Œæ—¶ï¼Œè¯·å°†å…¶ä¸­çš„ -it åé¢çš„mqæ›¿æ¢ä¸ºä½ è‡ªå·±çš„å®¹å™¨å.\nè¿›å…¥å®¹å™¨å†…éƒ¨åï¼Œæ‰§è¡Œä¸‹é¢å‘½ä»¤å¼€å¯æ’ä»¶ï¼š\nrabbitmq-plugins enable rabbitmq_delayed_message_exchange ç»“æœå¦‚ä¸‹ï¼š\n3.é›†ç¾¤éƒ¨ç½² æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹çœ‹å¦‚ä½•å®‰è£…RabbitMQçš„é›†ç¾¤ã€‚\n2.1.é›†ç¾¤åˆ†ç±» åœ¨RabbitMQçš„å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œè®²è¿°äº†ä¸¤ç§é›†ç¾¤çš„é…ç½®æ–¹å¼ï¼š\næ™®é€šæ¨¡å¼ï¼šæ™®é€šæ¨¡å¼é›†ç¾¤ä¸è¿›è¡Œæ•°æ®åŒæ­¥ï¼Œæ¯ä¸ªMQéƒ½æœ‰è‡ªå·±çš„é˜Ÿåˆ—ã€æ•°æ®ä¿¡æ¯ï¼ˆå…¶å®ƒå…ƒæ•°æ®ä¿¡æ¯å¦‚äº¤æ¢æœºç­‰ä¼šåŒæ­¥ï¼‰ã€‚ä¾‹å¦‚æˆ‘ä»¬æœ‰2ä¸ªMQï¼šmq1ï¼Œå’Œmq2ï¼Œå¦‚æœä½ çš„æ¶ˆæ¯åœ¨mq1ï¼Œè€Œä½ è¿æ¥åˆ°äº†mq2ï¼Œé‚£ä¹ˆmq2ä¼šå»mq1æ‹‰å–æ¶ˆæ¯ï¼Œç„¶åè¿”å›ç»™ä½ ã€‚å¦‚æœmq1å®•æœºï¼Œæ¶ˆæ¯å°±ä¼šä¸¢å¤±ã€‚ é•œåƒæ¨¡å¼ï¼šä¸æ™®é€šæ¨¡å¼ä¸åŒï¼Œé˜Ÿåˆ—ä¼šåœ¨å„ä¸ªmqçš„é•œåƒèŠ‚ç‚¹ä¹‹é—´åŒæ­¥ï¼Œå› æ­¤ä½ è¿æ¥åˆ°ä»»ä½•ä¸€ä¸ªé•œåƒèŠ‚ç‚¹ï¼Œå‡å¯è·å–åˆ°æ¶ˆæ¯ã€‚è€Œä¸”å¦‚æœä¸€ä¸ªèŠ‚ç‚¹å®•æœºï¼Œå¹¶ä¸ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚ä¸è¿‡ï¼Œè¿™ç§æ–¹å¼å¢åŠ äº†æ•°æ®åŒæ­¥çš„å¸¦å®½æ¶ˆè€—ã€‚ æˆ‘ä»¬å…ˆæ¥çœ‹æ™®é€šæ¨¡å¼é›†ç¾¤ï¼Œæˆ‘ä»¬çš„è®¡åˆ’éƒ¨ç½²3èŠ‚ç‚¹çš„mqé›†ç¾¤ï¼š\nä¸»æœºå æ§åˆ¶å°ç«¯å£ amqpé€šä¿¡ç«¯å£ mq1 8081 â€”\u003e 15672 8071 â€”\u003e 5672 mq2 8082 â€”\u003e 15672 8072 â€”\u003e 5672 mq3 8083 â€”\u003e 15672 8073 â€”\u003e 5672 é›†ç¾¤ä¸­çš„èŠ‚ç‚¹æ ‡ç¤ºé»˜è®¤éƒ½æ˜¯ï¼šrabbit@[hostname]ï¼Œå› æ­¤ä»¥ä¸Šä¸‰ä¸ªèŠ‚ç‚¹çš„åç§°åˆ†åˆ«ä¸ºï¼š\nrabbit@mq1 rabbit@mq2 rabbit@mq3 2.2.è·å–cookie RabbitMQåº•å±‚ä¾èµ–äºErlangï¼Œè€ŒErlangè™šæ‹Ÿæœºå°±æ˜¯ä¸€ä¸ªé¢å‘åˆ†å¸ƒå¼çš„è¯­è¨€ï¼Œé»˜è®¤å°±æ”¯æŒé›†ç¾¤æ¨¡å¼ã€‚é›†ç¾¤æ¨¡å¼ä¸­çš„æ¯ä¸ªRabbitMQ èŠ‚ç‚¹ä½¿ç”¨ cookie æ¥ç¡®å®šå®ƒä»¬æ˜¯å¦è¢«å…è®¸ç›¸äº’é€šä¿¡ã€‚\nè¦ä½¿ä¸¤ä¸ªèŠ‚ç‚¹èƒ½å¤Ÿé€šä¿¡ï¼Œå®ƒä»¬å¿…é¡»å…·æœ‰ç›¸åŒçš„å…±äº«ç§˜å¯†ï¼Œç§°ä¸ºErlang cookieã€‚cookie åªæ˜¯ä¸€ä¸²æœ€å¤š 255 ä¸ªå­—ç¬¦çš„å­—æ¯æ•°å­—å­—ç¬¦ã€‚\næ¯ä¸ªé›†ç¾¤èŠ‚ç‚¹å¿…é¡»å…·æœ‰ç›¸åŒçš„ cookieã€‚å®ä¾‹ä¹‹é—´ä¹Ÿéœ€è¦å®ƒæ¥ç›¸äº’é€šä¿¡ã€‚\næˆ‘ä»¬å…ˆåœ¨ä¹‹å‰å¯åŠ¨çš„mqå®¹å™¨ä¸­è·å–ä¸€ä¸ªcookieå€¼ï¼Œä½œä¸ºé›†ç¾¤çš„cookieã€‚æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š\ndocker exec -it mq cat /var/lib/rabbitmq/.erlang.cookie å¯ä»¥çœ‹åˆ°cookieå€¼å¦‚ä¸‹ï¼š\nFXZMCVGLBIXZCDEMMVZQ æ¥ä¸‹æ¥ï¼Œåœæ­¢å¹¶åˆ é™¤å½“å‰çš„mqå®¹å™¨ï¼Œæˆ‘ä»¬é‡æ–°æ­å»ºé›†ç¾¤ã€‚\ndocker rm -f mq 2.3.å‡†å¤‡é›†ç¾¤é…ç½® åœ¨/tmpç›®å½•æ–°å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶ rabbitmq.confï¼š\ncd /tmp # åˆ›å»ºæ–‡ä»¶ touch rabbitmq.conf æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\nloopback_users.guest = false listeners.tcp.default = 5672 cluster_formation.peer_discovery_backend = rabbit_peer_discovery_classic_config cluster_formation.classic_config.nodes.1 = rabbit@mq1 cluster_formation.classic_config.nodes.2 = rabbit@mq2 cluster_formation.classic_config.nodes.3 = rabbit@mq3 å†åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œè®°å½•cookie\ncd /tmp # åˆ›å»ºcookieæ–‡ä»¶ touch .erlang.cookie # å†™å…¥cookie echo \"FXZMCVGLBIXZCDEMMVZQ\" \u003e .erlang.cookie # ä¿®æ”¹cookieæ–‡ä»¶çš„æƒé™ chmod 600 .erlang.cookie å‡†å¤‡ä¸‰ä¸ªç›®å½•,mq1ã€mq2ã€mq3ï¼š\ncd /tmp # åˆ›å»ºç›®å½• mkdir mq1 mq2 mq3 ç„¶åæ‹·è´rabbitmq.confã€cookieæ–‡ä»¶åˆ°mq1ã€mq2ã€mq3ï¼š\n# è¿›å…¥/tmp cd /tmp # æ‹·è´ cp rabbitmq.conf mq1 cp rabbitmq.conf mq2 cp rabbitmq.conf mq3 cp .erlang.cookie mq1 cp .erlang.cookie mq2 cp .erlang.cookie mq3 2.4.å¯åŠ¨é›†ç¾¤ åˆ›å»ºä¸€ä¸ªç½‘ç»œï¼š\ndocker network create mq-net docker volume create\nè¿è¡Œå‘½ä»¤\ndocker run -d --net mq-net \\ -v ${PWD}/mq1/rabbitmq.conf:/etc/rabbitmq/rabbitmq.conf \\ -v ${PWD}/.erlang.cookie:/var/lib/rabbitmq/.erlang.cookie \\ -e RABBITMQ_DEFAULT_USER=itcast \\ -e RABBITMQ_DEFAULT_PASS=123321 \\ --name mq1 \\ --hostname mq1 \\ -p 8071:5672 \\ -p 8081:15672 \\ rabbitmq:3.8-management docker run -d --net mq-net \\ -v ${PWD}/mq2/rabbitmq.conf:/etc/rabbitmq/rabbitmq.conf \\ -v ${PWD}/.erlang.cookie:/var/lib/rabbitmq/.erlang.cookie \\ -e RABBITMQ_DEFAULT_USER=itcast \\ -e RABBITMQ_DEFAULT_PASS=123321 \\ --name mq2 \\ --hostname mq2 \\ -p 8072:5672 \\ -p 8082:15672 \\ rabbitmq:3.8-management docker run -d --net mq-net \\ -v ${PWD}/mq3/rabbitmq.conf:/etc/rabbitmq/rabbitmq.conf \\ -v ${PWD}/.erlang.cookie:/var/lib/rabbitmq/.erlang.cookie \\ -e RABBITMQ_DEFAULT_USER=itcast \\ -e RABBITMQ_DEFAULT_PASS=123321 \\ --name mq3 \\ --hostname mq3 \\ -p 8073:5672 \\ -p 8083:15672 \\ rabbitmq:3.8-management 2.5.æµ‹è¯• åœ¨mq1è¿™ä¸ªèŠ‚ç‚¹ä¸Šæ·»åŠ ä¸€ä¸ªé˜Ÿåˆ—ï¼š\nå¦‚å›¾ï¼Œåœ¨mq2å’Œmq3ä¸¤ä¸ªæ§åˆ¶å°ä¹Ÿéƒ½èƒ½çœ‹åˆ°ï¼š\n2.5.1.æ•°æ®å…±äº«æµ‹è¯• ç‚¹å‡»è¿™ä¸ªé˜Ÿåˆ—ï¼Œè¿›å…¥ç®¡ç†é¡µé¢ï¼š\nç„¶ååˆ©ç”¨æ§åˆ¶å°å‘é€ä¸€æ¡æ¶ˆæ¯åˆ°è¿™ä¸ªé˜Ÿåˆ—ï¼š\nç»“æœåœ¨mq2ã€mq3ä¸Šéƒ½èƒ½çœ‹åˆ°è¿™æ¡æ¶ˆæ¯ï¼š\n2.5.2.å¯ç”¨æ€§æµ‹è¯• æˆ‘ä»¬è®©å…¶ä¸­ä¸€å°èŠ‚ç‚¹mq1å®•æœºï¼š\ndocker stop mq1 ç„¶åç™»å½•mq2æˆ–mq3çš„æ§åˆ¶å°ï¼Œå‘ç°simple.queueä¹Ÿä¸å¯ç”¨äº†ï¼š\nè¯´æ˜æ•°æ®å¹¶æ²¡æœ‰æ‹·è´åˆ°mq2å’Œmq3ã€‚\n4.é•œåƒæ¨¡å¼ åœ¨åˆšåˆšçš„æ¡ˆä¾‹ä¸­ï¼Œä¸€æ—¦åˆ›å»ºé˜Ÿåˆ—çš„ä¸»æœºå®•æœºï¼Œé˜Ÿåˆ—å°±ä¼šä¸å¯ç”¨ã€‚ä¸å…·å¤‡é«˜å¯ç”¨èƒ½åŠ›ã€‚å¦‚æœè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¿…é¡»ä½¿ç”¨å®˜æ–¹æä¾›çš„é•œåƒé›†ç¾¤æ–¹æ¡ˆã€‚\nå®˜æ–¹æ–‡æ¡£åœ°å€ï¼šhttps://www.rabbitmq.com/ha.html\n4.1.é•œåƒæ¨¡å¼çš„ç‰¹å¾ é»˜è®¤æƒ…å†µä¸‹ï¼Œé˜Ÿåˆ—åªä¿å­˜åœ¨åˆ›å»ºè¯¥é˜Ÿåˆ—çš„èŠ‚ç‚¹ä¸Šã€‚è€Œé•œåƒæ¨¡å¼ä¸‹ï¼Œåˆ›å»ºé˜Ÿåˆ—çš„èŠ‚ç‚¹è¢«ç§°ä¸ºè¯¥é˜Ÿåˆ—çš„ä¸»èŠ‚ç‚¹ï¼Œé˜Ÿåˆ—è¿˜ä¼šæ‹·è´åˆ°é›†ç¾¤ä¸­çš„å…¶å®ƒèŠ‚ç‚¹ï¼Œä¹Ÿå«åšè¯¥é˜Ÿåˆ—çš„é•œåƒèŠ‚ç‚¹ã€‚\nä½†æ˜¯ï¼Œä¸åŒé˜Ÿåˆ—å¯ä»¥åœ¨é›†ç¾¤ä¸­çš„ä»»æ„èŠ‚ç‚¹ä¸Šåˆ›å»ºï¼Œå› æ­¤ä¸åŒé˜Ÿåˆ—çš„ä¸»èŠ‚ç‚¹å¯ä»¥ä¸åŒã€‚ç”šè‡³ï¼Œä¸€ä¸ªé˜Ÿåˆ—çš„ä¸»èŠ‚ç‚¹å¯èƒ½æ˜¯å¦ä¸€ä¸ªé˜Ÿåˆ—çš„é•œåƒèŠ‚ç‚¹ã€‚\nç”¨æˆ·å‘é€ç»™é˜Ÿåˆ—çš„ä¸€åˆ‡è¯·æ±‚ï¼Œä¾‹å¦‚å‘é€æ¶ˆæ¯ã€æ¶ˆæ¯å›æ‰§é»˜è®¤éƒ½ä¼šåœ¨ä¸»èŠ‚ç‚¹å®Œæˆï¼Œå¦‚æœæ˜¯ä»èŠ‚ç‚¹æ¥æ”¶åˆ°è¯·æ±‚ï¼Œä¹Ÿä¼šè·¯ç”±åˆ°ä¸»èŠ‚ç‚¹å»å®Œæˆã€‚é•œåƒèŠ‚ç‚¹ä»…ä»…èµ·åˆ°å¤‡ä»½æ•°æ®ä½œç”¨ã€‚\nå½“ä¸»èŠ‚ç‚¹æ¥æ”¶åˆ°æ¶ˆè´¹è€…çš„ACKæ—¶ï¼Œæ‰€æœ‰é•œåƒéƒ½ä¼šåˆ é™¤èŠ‚ç‚¹ä¸­çš„æ•°æ®ã€‚\næ€»ç»“å¦‚ä¸‹ï¼š\né•œåƒé˜Ÿåˆ—ç»“æ„æ˜¯ä¸€ä¸»å¤šä»ï¼ˆä»å°±æ˜¯é•œåƒï¼‰ æ‰€æœ‰æ“ä½œéƒ½æ˜¯ä¸»èŠ‚ç‚¹å®Œæˆï¼Œç„¶ååŒæ­¥ç»™é•œåƒèŠ‚ç‚¹ ä¸»å®•æœºåï¼Œé•œåƒèŠ‚ç‚¹ä¼šæ›¿ä»£æˆæ–°çš„ä¸»ï¼ˆå¦‚æœåœ¨ä¸»ä»åŒæ­¥å®Œæˆå‰ï¼Œä¸»å°±å·²ç»å®•æœºï¼Œå¯èƒ½å‡ºç°æ•°æ®ä¸¢å¤±ï¼‰ ä¸å…·å¤‡è´Ÿè½½å‡è¡¡åŠŸèƒ½ï¼Œå› ä¸ºæ‰€æœ‰æ“ä½œéƒ½ä¼šæœ‰ä¸»èŠ‚ç‚¹å®Œæˆï¼ˆä½†æ˜¯ä¸åŒé˜Ÿåˆ—ï¼Œå…¶ä¸»èŠ‚ç‚¹å¯ä»¥ä¸åŒï¼Œå¯ä»¥åˆ©ç”¨è¿™ä¸ªæé«˜ååé‡ï¼‰ 4.2.é•œåƒæ¨¡å¼çš„é…ç½® é•œåƒæ¨¡å¼çš„é…ç½®æœ‰3ç§æ¨¡å¼ï¼š\nha-mode ha-params æ•ˆæœ å‡†ç¡®æ¨¡å¼exactly é˜Ÿåˆ—çš„å‰¯æœ¬é‡count é›†ç¾¤ä¸­é˜Ÿåˆ—å‰¯æœ¬ï¼ˆä¸»æœåŠ¡å™¨å’Œé•œåƒæœåŠ¡å™¨ä¹‹å’Œï¼‰çš„æ•°é‡ã€‚countå¦‚æœä¸º1æ„å‘³ç€å•ä¸ªå‰¯æœ¬ï¼šå³é˜Ÿåˆ—ä¸»èŠ‚ç‚¹ã€‚countå€¼ä¸º2è¡¨ç¤º2ä¸ªå‰¯æœ¬ï¼š1ä¸ªé˜Ÿåˆ—ä¸»å’Œ1ä¸ªé˜Ÿåˆ—é•œåƒã€‚æ¢å¥è¯è¯´ï¼šcount = é•œåƒæ•°é‡ + 1ã€‚å¦‚æœç¾¤é›†ä¸­çš„èŠ‚ç‚¹æ•°å°‘äºcountï¼Œåˆ™è¯¥é˜Ÿåˆ—å°†é•œåƒåˆ°æ‰€æœ‰èŠ‚ç‚¹ã€‚å¦‚æœæœ‰é›†ç¾¤æ€»æ•°å¤§äºcount+1ï¼Œå¹¶ä¸”åŒ…å«é•œåƒçš„èŠ‚ç‚¹å‡ºç°æ•…éšœï¼Œåˆ™å°†åœ¨å¦ä¸€ä¸ªèŠ‚ç‚¹ä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒã€‚ all (none) é˜Ÿåˆ—åœ¨ç¾¤é›†ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ä¹‹é—´è¿›è¡Œé•œåƒã€‚é˜Ÿåˆ—å°†é•œåƒåˆ°ä»»ä½•æ–°åŠ å…¥çš„èŠ‚ç‚¹ã€‚é•œåƒåˆ°æ‰€æœ‰èŠ‚ç‚¹å°†å¯¹æ‰€æœ‰ç¾¤é›†èŠ‚ç‚¹æ–½åŠ é¢å¤–çš„å‹åŠ›ï¼ŒåŒ…æ‹¬ç½‘ç»œI / Oï¼Œç£ç›˜I / Oå’Œç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µã€‚æ¨èä½¿ç”¨exactlyï¼Œè®¾ç½®å‰¯æœ¬æ•°ä¸ºï¼ˆN / 2 +1ï¼‰ã€‚ nodes node names æŒ‡å®šé˜Ÿåˆ—åˆ›å»ºåˆ°å“ªäº›èŠ‚ç‚¹ï¼Œå¦‚æœæŒ‡å®šçš„èŠ‚ç‚¹å…¨éƒ¨ä¸å­˜åœ¨ï¼Œåˆ™ä¼šå‡ºç°å¼‚å¸¸ã€‚å¦‚æœæŒ‡å®šçš„èŠ‚ç‚¹åœ¨é›†ç¾¤ä¸­å­˜åœ¨ï¼Œä½†æ˜¯æš‚æ—¶ä¸å¯ç”¨ï¼Œä¼šåˆ›å»ºèŠ‚ç‚¹åˆ°å½“å‰å®¢æˆ·ç«¯è¿æ¥åˆ°çš„èŠ‚ç‚¹ã€‚ è¿™é‡Œæˆ‘ä»¬ä»¥rabbitmqctlå‘½ä»¤ä½œä¸ºæ¡ˆä¾‹æ¥è®²è§£é…ç½®è¯­æ³•ã€‚\nè¯­æ³•ç¤ºä¾‹ï¼š\n4.2.1.exactlyæ¨¡å¼ rabbitmqctl set_policy ha-two \"^two\\.\" '{\"ha-mode\":\"exactly\",\"ha-params\":2,\"ha-sync-mode\":\"automatic\"}' rabbitmqctl set_policyï¼šå›ºå®šå†™æ³• ha-twoï¼šç­–ç•¥åç§°ï¼Œè‡ªå®šä¹‰ \"^two\\.\"ï¼šåŒ¹é…é˜Ÿåˆ—çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œç¬¦åˆå‘½åè§„åˆ™çš„é˜Ÿåˆ—æ‰ç”Ÿæ•ˆï¼Œè¿™é‡Œæ˜¯ä»»ä½•ä»¥two.å¼€å¤´çš„é˜Ÿåˆ—åç§° '{\"ha-mode\":\"exactly\",\"ha-params\":2,\"ha-sync-mode\":\"automatic\"}': ç­–ç•¥å†…å®¹ \"ha-mode\":\"exactly\"ï¼šç­–ç•¥æ¨¡å¼ï¼Œæ­¤å¤„æ˜¯exactlyæ¨¡å¼ï¼ŒæŒ‡å®šå‰¯æœ¬æ•°é‡ \"ha-params\":2ï¼šç­–ç•¥å‚æ•°ï¼Œè¿™é‡Œæ˜¯2ï¼Œå°±æ˜¯å‰¯æœ¬æ•°é‡ä¸º2ï¼Œ1ä¸»1é•œåƒ \"ha-sync-mode\":\"automatic\"ï¼šåŒæ­¥ç­–ç•¥ï¼Œé»˜è®¤æ˜¯manualï¼Œå³æ–°åŠ å…¥çš„é•œåƒèŠ‚ç‚¹ä¸ä¼šåŒæ­¥æ—§çš„æ¶ˆæ¯ã€‚å¦‚æœè®¾ç½®ä¸ºautomaticï¼Œåˆ™æ–°åŠ å…¥çš„é•œåƒèŠ‚ç‚¹ä¼šæŠŠä¸»èŠ‚ç‚¹ä¸­æ‰€æœ‰æ¶ˆæ¯éƒ½åŒæ­¥ï¼Œä¼šå¸¦æ¥é¢å¤–çš„ç½‘ç»œå¼€é”€ 4.2.2.allæ¨¡å¼ rabbitmqctl set_policy ha-all \"^all\\.\" '{\"ha-mode\":\"all\"}' ha-allï¼šç­–ç•¥åç§°ï¼Œè‡ªå®šä¹‰ \"^all\\.\"ï¼šåŒ¹é…æ‰€æœ‰ä»¥all.å¼€å¤´çš„é˜Ÿåˆ—å '{\"ha-mode\":\"all\"}'ï¼šç­–ç•¥å†…å®¹ \"ha-mode\":\"all\"ï¼šç­–ç•¥æ¨¡å¼ï¼Œæ­¤å¤„æ˜¯allæ¨¡å¼ï¼Œå³æ‰€æœ‰èŠ‚ç‚¹éƒ½ä¼šç§°ä¸ºé•œåƒèŠ‚ç‚¹ 4.2.3.nodesæ¨¡å¼ rabbitmqctl set_policy ha-nodes \"^nodes\\.\" '{\"ha-mode\":\"nodes\",\"ha-params\":[\"rabbit@nodeA\", \"rabbit@nodeB\"]}' rabbitmqctl set_policyï¼šå›ºå®šå†™æ³• ha-nodesï¼šç­–ç•¥åç§°ï¼Œè‡ªå®šä¹‰ \"^nodes\\.\"ï¼šåŒ¹é…é˜Ÿåˆ—çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œç¬¦åˆå‘½åè§„åˆ™çš„é˜Ÿåˆ—æ‰ç”Ÿæ•ˆï¼Œè¿™é‡Œæ˜¯ä»»ä½•ä»¥nodes.å¼€å¤´çš„é˜Ÿåˆ—åç§° '{\"ha-mode\":\"nodes\",\"ha-params\":[\"rabbit@nodeA\", \"rabbit@nodeB\"]}': ç­–ç•¥å†…å®¹ \"ha-mode\":\"nodes\"ï¼šç­–ç•¥æ¨¡å¼ï¼Œæ­¤å¤„æ˜¯nodesæ¨¡å¼ \"ha-params\":[\"rabbit@mq1\", \"rabbit@mq2\"]ï¼šç­–ç•¥å‚æ•°ï¼Œè¿™é‡ŒæŒ‡å®šå‰¯æœ¬æ‰€åœ¨èŠ‚ç‚¹åç§° 4.3.æµ‹è¯• æˆ‘ä»¬ä½¿ç”¨exactlyæ¨¡å¼çš„é•œåƒï¼Œå› ä¸ºé›†ç¾¤èŠ‚ç‚¹æ•°é‡ä¸º3ï¼Œå› æ­¤é•œåƒæ•°é‡å°±è®¾ç½®ä¸º2.\nè¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š\ndocker exec -it mq1 rabbitmqctl set_policy ha-two \"^two\\.\" '{\"ha-mode\":\"exactly\",\"ha-params\":2,\"ha-sync-mode\":\"automatic\"}' ä¸‹é¢ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„é˜Ÿåˆ—ï¼š\nåœ¨ä»»æ„ä¸€ä¸ªmqæ§åˆ¶å°æŸ¥çœ‹é˜Ÿåˆ—ï¼š\n4.3.1.æµ‹è¯•æ•°æ®å…±äº« ç»™two.queueå‘é€ä¸€æ¡æ¶ˆæ¯ï¼š\nç„¶ååœ¨mq1ã€mq2ã€mq3çš„ä»»æ„æ§åˆ¶å°æŸ¥çœ‹æ¶ˆæ¯ï¼š\n4.3.2.æµ‹è¯•é«˜å¯ç”¨ ç°åœ¨ï¼Œæˆ‘ä»¬è®©two.queueçš„ä¸»èŠ‚ç‚¹mq1å®•æœºï¼š\ndocker stop mq1 æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼š\næŸ¥çœ‹é˜Ÿåˆ—çŠ¶æ€ï¼š\nå‘ç°ä¾ç„¶æ˜¯å¥åº·çš„ï¼å¹¶ä¸”å…¶ä¸»èŠ‚ç‚¹åˆ‡æ¢åˆ°äº†rabbit@mq2ä¸Š\n5.ä»²è£é˜Ÿåˆ— ä»RabbitMQ 3.8ç‰ˆæœ¬å¼€å§‹ï¼Œå¼•å…¥äº†æ–°çš„ä»²è£é˜Ÿåˆ—ï¼Œä»–å…·å¤‡ä¸é•œåƒé˜Ÿé‡Œç±»ä¼¼çš„åŠŸèƒ½ï¼Œä½†ä½¿ç”¨æ›´åŠ æ–¹ä¾¿ã€‚\n5.1.æ·»åŠ ä»²è£é˜Ÿåˆ— åœ¨ä»»æ„æ§åˆ¶å°æ·»åŠ ä¸€ä¸ªé˜Ÿåˆ—ï¼Œä¸€å®šè¦é€‰æ‹©é˜Ÿåˆ—ç±»å‹ä¸ºQuorumç±»å‹ã€‚\nåœ¨ä»»æ„æ§åˆ¶å°æŸ¥çœ‹é˜Ÿåˆ—ï¼š\nå¯ä»¥çœ‹åˆ°ï¼Œä»²è£é˜Ÿåˆ—çš„ + 2å­—æ ·ã€‚ä»£è¡¨è¿™ä¸ªé˜Ÿåˆ—æœ‰2ä¸ªé•œåƒèŠ‚ç‚¹ã€‚\nå› ä¸ºä»²è£é˜Ÿåˆ—é»˜è®¤çš„é•œåƒæ•°ä¸º5ã€‚å¦‚æœä½ çš„é›†ç¾¤æœ‰7ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆé•œåƒæ•°è‚¯å®šæ˜¯5ï¼›è€Œæˆ‘ä»¬é›†ç¾¤åªæœ‰3ä¸ªèŠ‚ç‚¹ï¼Œå› æ­¤é•œåƒæ•°é‡å°±æ˜¯3.\n5.2.æµ‹è¯• å¯ä»¥å‚è€ƒå¯¹é•œåƒé›†ç¾¤çš„æµ‹è¯•ï¼Œæ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚\n5.3.é›†ç¾¤æ‰©å®¹ 5.3.1.åŠ å…¥é›†ç¾¤ 1ï¼‰å¯åŠ¨ä¸€ä¸ªæ–°çš„MQå®¹å™¨ï¼š\ndocker run -d --net mq-net \\ -v ${PWD}/.erlang.cookie:/var/lib/rabbitmq/.erlang.cookie \\ -e RABBITMQ_DEFAULT_USER=itcast \\ -e RABBITMQ_DEFAULT_PASS=123321 \\ --name mq4 \\ --hostname mq5 \\ -p 8074:15672 \\ -p 8084:15672 \\ rabbitmq:3.8-management 2ï¼‰è¿›å…¥å®¹å™¨æ§åˆ¶å°ï¼š\ndocker exec -it mq4 bash 3ï¼‰åœæ­¢mqè¿›ç¨‹\nrabbitmqctl stop_app 4ï¼‰é‡ç½®RabbitMQä¸­çš„æ•°æ®ï¼š\nrabbitmqctl reset 5ï¼‰åŠ å…¥mq1ï¼š\nrabbitmqctl join_cluster rabbit@mq1 6ï¼‰å†æ¬¡å¯åŠ¨mqè¿›ç¨‹\nrabbitmqctl start_app 5.3.2.å¢åŠ ä»²è£é˜Ÿåˆ—å‰¯æœ¬ æˆ‘ä»¬å…ˆæŸ¥çœ‹ä¸‹quorum.queueè¿™ä¸ªé˜Ÿåˆ—ç›®å‰çš„å‰¯æœ¬æƒ…å†µï¼Œè¿›å…¥mq1å®¹å™¨ï¼š\ndocker exec -it mq1 bash æ‰§è¡Œå‘½ä»¤ï¼š\nrabbitmq-queues quorum_status \"quorum.queue\" ç»“æœï¼š\nç°åœ¨ï¼Œæˆ‘ä»¬è®©mq4ä¹ŸåŠ å…¥è¿›æ¥ï¼š\nrabbitmq-queues add_member \"quorum.queue\" \"rabbit@mq4\" ç»“æœï¼š\nå†æ¬¡æŸ¥çœ‹ï¼š\nrabbitmq-queues quorum_status \"quorum.queue\" æŸ¥çœ‹æ§åˆ¶å°ï¼Œå‘ç°quorum.queueçš„é•œåƒæ•°é‡ä¹Ÿä»åŸæ¥çš„ +2 å˜æˆäº† +3ï¼š\n",
  "wordCount" : "4526",
  "inLanguage": "zh",
  "image":"https://XianCH.github.io/postsImg/rabbitMq.png","datePublished": "2022-10-19T10:16:51Z",
  "dateModified": "2023-09-22T10:16:51Z",
  "author":[{
    "@type": "Person",
    "name": "x14n"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://XianCH.github.io/posts/tech/distributed/rabbitmq%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "X14n's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://XianCH.github.io/img/favicon.icon"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://XianCH.github.io/" accesskey="h" title="x14n&#39;s Blog (Alt + H)">
            <img src="https://XianCH.github.io/img/main.png" alt="logo" aria-label="logo"
                 height="35">x14n&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                         stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                         stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://XianCH.github.io/search" title="ğŸ” æœç´¢ (Alt &#43; /)" accesskey=/>
                <span>ğŸ” æœç´¢</span>
                </a>
            </li>
            <li>
                <a href="https://XianCH.github.io/" title="ğŸ  ä¸»é¡µ">
                <span>ğŸ  ä¸»é¡µ</span>
                </a>
            </li>
            <li>
                <a href="https://XianCH.github.io/posts" title="ğŸ“š æ–‡ç« ">
                <span>ğŸ“š æ–‡ç« </span>
                </a>
            </li>
            <li>
                <a href="https://XianCH.github.io/tags" title="ğŸ§© æ ‡ç­¾">
                <span>ğŸ§© æ ‡ç­¾</span>
                </a>
            </li>
            <li>
                <a href="https://XianCH.github.io/archives/" title="â±ï¸ æ—¶é—´è½´">
                <span>â±ï¸ æ—¶é—´è½´</span>
                </a>
            </li>
            <li>
                <a href="https://XianCH.github.io/about" title="ğŸ™‹ğŸ»â€â™‚ï¸ å…³äº">
                <span>ğŸ™‹ğŸ»â€â™‚ï¸ å…³äº</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main page">
<style>
    i[id*="post_meta_style"] {
        display: flex;
        align-items: center;
        margin: 0 0 10px 0;
    }
</style>

<article class="post-single">
    <div id="single-content">
        <header class="post-header">
            <div class="breadcrumbs"><a href="https://XianCH.github.io/">ğŸ  ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href="https://XianCH.github.io/posts/">ğŸ“šæ–‡ç« </a>&nbsp;Â»&nbsp;<a href="https://XianCH.github.io/posts/tech/">ğŸ‘¨ğŸ»â€ğŸ’» æŠ€æœ¯</a></div>
            <h1 class="post-title">
                RabbitMqéƒ¨ç½²æŒ‡å—
            </h1>
            <div class="post-description">
                rocketmqè™šæ‹Ÿæœºéƒ¨ç½²å’Œdockeréƒ¨ç½²
            </div>
            <div class="post-meta">

<style>
    i[id*="post_meta_style"] {
        display: flex;
        align-items: center;
        margin: 0 0 10px 0;
    }

    .parent-post-meta {
        display: flex;
        flex-wrap: wrap;
        opacity: 0.8;
    }
</style>

<span class="parent-post-meta">
    <span id="post_meta_style_1">
        <span class="fa fa-calendar-check-o"></span>
        <span>2022-10-19
            &nbsp;&nbsp;
        </span>
    </span>
    
    
    
    
    
    
    
    <span id="post_meta_style_3">
        <span class="fa fa-file-word-o"></span>
        <span>4526å­—
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_4">
        <span class="fa fa-clock-o"></span>
        <span>10åˆ†é’Ÿ
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_5">
        <span class="fa fa-user-o"></span>
        <span>x14n
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_6">
        <span class="fa fa-tags" style="opacity: 0.8"></span>
        <span>
            <span class="post-tags-meta">
                <a href="https://XianCH.github.io/tags/distributed/" style="color: var(--secondary)!important;">distributed</a>
            </span>
        </span>
    </span>
</span>
<span style="opacity: 0.8;">
                    <span id="post_meta_style_7">
                        &nbsp;&nbsp;
                        <span class="fa fa-eye" ></span>
                        <span>
                            <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv"></span></span>
                            &nbsp;&nbsp;
                        </span>
                    </span>
                    <span id="post_meta_style_8">
                        <span class="fa fa-commenting-o"></span>
                        <span>
                            <script src="https://cdn.staticfile.org/twikoo/1.5.8/twikoo.all.min.js"></script>
                            <script>
                                let url = document.documentURI
                                
                                let dnsUrl = "https://XianCH.github.io/"
                                let urlSplit = url.split(dnsUrl)
                                let finalUrl = urlSplit[1]
                                if (finalUrl[0] !== '/') {
                                    finalUrl = '/'+finalUrl
                                }
                                twikoo.getCommentsCount({
                                    envId:  null , 
                                region:  null , 
                                urls: [ 
                                    
                                    finalUrl,
                                ],
                                    includeReply: false 
                                }).then(function (res) {
                                    let count = res[0].count
                                    const obj = document.getElementById("comment_count");
                                    obj.innerText = count
                                    
                                    
                                    
                                }).catch(function (err) {
                                    
                                    console.error(err);
                                });
                            </script>
                            <span id="comment_count"></span>
                        </span>
                    </span>
                </span>

</div>
        </header> 
<figure class="entry-cover1"><img style="zoom:;" loading="lazy" src="https://XianCH.github.io/postsImg/rabbitMq.png" alt="">
    
</figure><aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">ç›®å½•</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#1%e5%8d%95%e6%9c%ba%e9%83%a8%e7%bd%b2" aria-label="1.å•æœºéƒ¨ç½²">1.å•æœºéƒ¨ç½²</a><ul>
                        
                <li>
                    <a href="#11%e4%b8%8b%e8%bd%bd%e9%95%9c%e5%83%8f" aria-label="1.1.ä¸‹è½½é•œåƒ">1.1.ä¸‹è½½é•œåƒ</a></li>
                <li>
                    <a href="#12%e5%ae%89%e8%a3%85mq" aria-label="1.2.å®‰è£…MQ">1.2.å®‰è£…MQ</a></li></ul>
                </li>
                <li>
                    <a href="#2%e5%ae%89%e8%a3%85delayexchange%e6%8f%92%e4%bb%b6" aria-label="2.å®‰è£…DelayExchangeæ’ä»¶">2.å®‰è£…DelayExchangeæ’ä»¶</a><ul>
                        
                <li>
                    <a href="#21%e4%b8%8b%e8%bd%bd%e6%8f%92%e4%bb%b6" aria-label="2.1.ä¸‹è½½æ’ä»¶">2.1.ä¸‹è½½æ’ä»¶</a></li>
                <li>
                    <a href="#22%e4%b8%8a%e4%bc%a0%e6%8f%92%e4%bb%b6" aria-label="2.2.ä¸Šä¼ æ’ä»¶">2.2.ä¸Šä¼ æ’ä»¶</a></li>
                <li>
                    <a href="#23%e5%ae%89%e8%a3%85%e6%8f%92%e4%bb%b6" aria-label="2.3.å®‰è£…æ’ä»¶">2.3.å®‰è£…æ’ä»¶</a></li></ul>
                </li>
                <li>
                    <a href="#3%e9%9b%86%e7%be%a4%e9%83%a8%e7%bd%b2" aria-label="3.é›†ç¾¤éƒ¨ç½²">3.é›†ç¾¤éƒ¨ç½²</a><ul>
                        
                <li>
                    <a href="#21%e9%9b%86%e7%be%a4%e5%88%86%e7%b1%bb" aria-label="2.1.é›†ç¾¤åˆ†ç±»">2.1.é›†ç¾¤åˆ†ç±»</a></li>
                <li>
                    <a href="#22%e8%8e%b7%e5%8f%96cookie" aria-label="2.2.è·å–cookie">2.2.è·å–cookie</a></li>
                <li>
                    <a href="#23%e5%87%86%e5%a4%87%e9%9b%86%e7%be%a4%e9%85%8d%e7%bd%ae" aria-label="2.3.å‡†å¤‡é›†ç¾¤é…ç½®">2.3.å‡†å¤‡é›†ç¾¤é…ç½®</a></li>
                <li>
                    <a href="#24%e5%90%af%e5%8a%a8%e9%9b%86%e7%be%a4" aria-label="2.4.å¯åŠ¨é›†ç¾¤">2.4.å¯åŠ¨é›†ç¾¤</a></li>
                <li>
                    <a href="#25%e6%b5%8b%e8%af%95" aria-label="2.5.æµ‹è¯•">2.5.æµ‹è¯•</a><ul>
                        
                <li>
                    <a href="#251%e6%95%b0%e6%8d%ae%e5%85%b1%e4%ba%ab%e6%b5%8b%e8%af%95" aria-label="2.5.1.æ•°æ®å…±äº«æµ‹è¯•">2.5.1.æ•°æ®å…±äº«æµ‹è¯•</a></li>
                <li>
                    <a href="#252%e5%8f%af%e7%94%a8%e6%80%a7%e6%b5%8b%e8%af%95" aria-label="2.5.2.å¯ç”¨æ€§æµ‹è¯•">2.5.2.å¯ç”¨æ€§æµ‹è¯•</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#4%e9%95%9c%e5%83%8f%e6%a8%a1%e5%bc%8f" aria-label="4.é•œåƒæ¨¡å¼">4.é•œåƒæ¨¡å¼</a><ul>
                        
                <li>
                    <a href="#41%e9%95%9c%e5%83%8f%e6%a8%a1%e5%bc%8f%e7%9a%84%e7%89%b9%e5%be%81" aria-label="4.1.é•œåƒæ¨¡å¼çš„ç‰¹å¾">4.1.é•œåƒæ¨¡å¼çš„ç‰¹å¾</a></li>
                <li>
                    <a href="#42%e9%95%9c%e5%83%8f%e6%a8%a1%e5%bc%8f%e7%9a%84%e9%85%8d%e7%bd%ae" aria-label="4.2.é•œåƒæ¨¡å¼çš„é…ç½®">4.2.é•œåƒæ¨¡å¼çš„é…ç½®</a><ul>
                        
                <li>
                    <a href="#421exactly%e6%a8%a1%e5%bc%8f" aria-label="4.2.1.exactlyæ¨¡å¼">4.2.1.exactlyæ¨¡å¼</a></li>
                <li>
                    <a href="#422all%e6%a8%a1%e5%bc%8f" aria-label="4.2.2.allæ¨¡å¼">4.2.2.allæ¨¡å¼</a></li>
                <li>
                    <a href="#423nodes%e6%a8%a1%e5%bc%8f" aria-label="4.2.3.nodesæ¨¡å¼">4.2.3.nodesæ¨¡å¼</a></li></ul>
                </li>
                <li>
                    <a href="#43%e6%b5%8b%e8%af%95" aria-label="4.3.æµ‹è¯•">4.3.æµ‹è¯•</a><ul>
                        
                <li>
                    <a href="#431%e6%b5%8b%e8%af%95%e6%95%b0%e6%8d%ae%e5%85%b1%e4%ba%ab" aria-label="4.3.1.æµ‹è¯•æ•°æ®å…±äº«">4.3.1.æµ‹è¯•æ•°æ®å…±äº«</a></li>
                <li>
                    <a href="#432%e6%b5%8b%e8%af%95%e9%ab%98%e5%8f%af%e7%94%a8" aria-label="4.3.2.æµ‹è¯•é«˜å¯ç”¨">4.3.2.æµ‹è¯•é«˜å¯ç”¨</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#5%e4%bb%b2%e8%a3%81%e9%98%9f%e5%88%97" aria-label="5.ä»²è£é˜Ÿåˆ—">5.ä»²è£é˜Ÿåˆ—</a><ul>
                        
                <li>
                    <a href="#51%e6%b7%bb%e5%8a%a0%e4%bb%b2%e8%a3%81%e9%98%9f%e5%88%97" aria-label="5.1.æ·»åŠ ä»²è£é˜Ÿåˆ—">5.1.æ·»åŠ ä»²è£é˜Ÿåˆ—</a></li>
                <li>
                    <a href="#52%e6%b5%8b%e8%af%95" aria-label="5.2.æµ‹è¯•">5.2.æµ‹è¯•</a></li>
                <li>
                    <a href="#53%e9%9b%86%e7%be%a4%e6%89%a9%e5%ae%b9" aria-label="5.3.é›†ç¾¤æ‰©å®¹">5.3.é›†ç¾¤æ‰©å®¹</a><ul>
                        
                <li>
                    <a href="#531%e5%8a%a0%e5%85%a5%e9%9b%86%e7%be%a4" aria-label="5.3.1.åŠ å…¥é›†ç¾¤">5.3.1.åŠ å…¥é›†ç¾¤</a></li>
                <li>
                    <a href="#532%e5%a2%9e%e5%8a%a0%e4%bb%b2%e8%a3%81%e9%98%9f%e5%88%97%e5%89%af%e6%9c%ac" aria-label="5.3.2.å¢åŠ ä»²è£é˜Ÿåˆ—å‰¯æœ¬">5.3.2.å¢åŠ ä»²è£é˜Ÿåˆ—å‰¯æœ¬</a>
                </li>
            </ul>
            </li>
            </ul>
            </li>
            </ul>
        </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
        
        activeElement = elements[0];
        const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
        document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
    }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        if (elements) {
            activeElement = Array.from(elements).find((element) => {
                if ((getOffsetTop(element) - window.pageYOffset) > 0 &&
                    (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                    return element;
                }
            }) || activeElement

            elements.forEach(element => {
                const id = encodeURI(element.getAttribute('id')).toLowerCase();
                if (element === activeElement){
                    document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
                } else {
                    document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
                }
            })
        }
    }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;
        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;
    }
</script>
        <div class="post-content"><h1 id="1å•æœºéƒ¨ç½²">1.å•æœºéƒ¨ç½²<a hidden class="anchor" aria-hidden="true" href="#1å•æœºéƒ¨ç½²">#</a></h1>
<p>æˆ‘ä»¬åœ¨Centos7è™šæ‹Ÿæœºä¸­ä½¿ç”¨Dockeræ¥å®‰è£…ã€‚</p>
<h2 id="11ä¸‹è½½é•œåƒ">1.1.ä¸‹è½½é•œåƒ<a hidden class="anchor" aria-hidden="true" href="#11ä¸‹è½½é•œåƒ">#</a></h2>
<p>æ–¹å¼ä¸€ï¼šåœ¨çº¿æ‹‰å–</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>docker pull rabbitmq:3.8-management
</span></span></code></pre></div><p>æ–¹å¼äºŒï¼šä»æœ¬åœ°åŠ è½½</p>
<p>åœ¨è¯¾å‰èµ„æ–™å·²ç»æä¾›äº†é•œåƒåŒ…ï¼š</p>
<p><img loading="lazy" src="assets/image-20210423191210349.png" alt="image-20210423191210349"  />
</p>
<p>ä¸Šä¼ åˆ°è™šæ‹Ÿæœºä¸­åï¼Œä½¿ç”¨å‘½ä»¤åŠ è½½é•œåƒå³å¯ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>docker load -i mq.tar
</span></span></code></pre></div><h2 id="12å®‰è£…mq">1.2.å®‰è£…MQ<a hidden class="anchor" aria-hidden="true" href="#12å®‰è£…mq">#</a></h2>
<p>æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ¥è¿è¡ŒMQå®¹å™¨ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>docker run <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> -e RABBITMQ_DEFAULT_USER<span style="color:#f92672">=</span>itcast <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> -e RABBITMQ_DEFAULT_PASS<span style="color:#f92672">=</span><span style="color:#ae81ff">123321</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> -v mq-plugins:/plugins <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> --name mq <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> --hostname mq1 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> -p 15672:15672 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> -p 5672:5672 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> -d <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> rabbitmq:3.8-management
</span></span></code></pre></div><h1 id="2å®‰è£…delayexchangeæ’ä»¶">2.å®‰è£…DelayExchangeæ’ä»¶<a hidden class="anchor" aria-hidden="true" href="#2å®‰è£…delayexchangeæ’ä»¶">#</a></h1>
<p>å®˜æ–¹çš„å®‰è£…æŒ‡å—åœ°å€ä¸ºï¼šhttps://blog.rabbitmq.com/posts/2015/04/scheduling-messages-with-rabbitmq</p>
<p>ä¸Šè¿°æ–‡æ¡£æ˜¯åŸºäºlinuxåŸç”Ÿå®‰è£…RabbitMQï¼Œç„¶åå®‰è£…æ’ä»¶ã€‚</p>
<p>å› ä¸ºæˆ‘ä»¬ä¹‹å‰æ˜¯åŸºäºDockerå®‰è£…RabbitMQï¼Œæ‰€ä»¥ä¸‹é¢æˆ‘ä»¬ä¼šè®²è§£åŸºäºDockeræ¥å®‰è£…RabbitMQæ’ä»¶ã€‚</p>
<h2 id="21ä¸‹è½½æ’ä»¶">2.1.ä¸‹è½½æ’ä»¶<a hidden class="anchor" aria-hidden="true" href="#21ä¸‹è½½æ’ä»¶">#</a></h2>
<p>RabbitMQæœ‰ä¸€ä¸ªå®˜æ–¹çš„æ’ä»¶ç¤¾åŒºï¼Œåœ°å€ä¸ºï¼šhttps://www.rabbitmq.com/community-plugins.html</p>
<p>å…¶ä¸­åŒ…å«å„ç§å„æ ·çš„æ’ä»¶ï¼ŒåŒ…æ‹¬æˆ‘ä»¬è¦ä½¿ç”¨çš„DelayExchangeæ’ä»¶ï¼š</p>
<p><img loading="lazy" src="assets/image-20210713104511055.png" alt="image-20210713104511055"  />
</p>
<p>å¤§å®¶å¯ä»¥å»å¯¹åº”çš„GitHubé¡µé¢ä¸‹è½½3.8.9ç‰ˆæœ¬çš„æ’ä»¶ï¼Œåœ°å€ä¸ºhttps://github.com/rabbitmq/rabbitmq-delayed-message-exchange/releases/tag/3.8.9è¿™ä¸ªå¯¹åº”RabbitMQçš„3.8.5ä»¥ä¸Šç‰ˆæœ¬ã€‚</p>
<p>è¯¾å‰èµ„æ–™ä¹Ÿæä¾›äº†ä¸‹è½½å¥½çš„æ’ä»¶ï¼š</p>
<p><img loading="lazy" src="assets/image-20210713104808909.png" alt="image-20210713104808909"  />
</p>
<h2 id="22ä¸Šä¼ æ’ä»¶">2.2.ä¸Šä¼ æ’ä»¶<a hidden class="anchor" aria-hidden="true" href="#22ä¸Šä¼ æ’ä»¶">#</a></h2>
<p>å› ä¸ºæˆ‘ä»¬æ˜¯åŸºäºDockerå®‰è£…ï¼Œæ‰€ä»¥éœ€è¦å…ˆæŸ¥çœ‹RabbitMQçš„æ’ä»¶ç›®å½•å¯¹åº”çš„æ•°æ®å·ã€‚å¦‚æœä¸æ˜¯åŸºäºDockerçš„åŒå­¦ï¼Œè¯·å‚è€ƒç¬¬ä¸€ç« éƒ¨åˆ†ï¼Œé‡æ–°åˆ›å»ºDockerå®¹å™¨ã€‚</p>
<p>æˆ‘ä»¬ä¹‹å‰è®¾å®šçš„RabbitMQçš„æ•°æ®å·åç§°ä¸º<code>mq-plugins</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ä¸‹é¢å‘½ä»¤æŸ¥çœ‹æ•°æ®å·ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>docker volume inspect mq-plugins
</span></span></code></pre></div><p>å¯ä»¥å¾—åˆ°ä¸‹é¢ç»“æœï¼š</p>
<p><img loading="lazy" src="assets/image-20210713105135701.png" alt="image-20210713105135701"  />
</p>
<p>æ¥ä¸‹æ¥ï¼Œå°†æ’ä»¶ä¸Šä¼ åˆ°è¿™ä¸ªç›®å½•å³å¯ï¼š</p>
<p><img loading="lazy" src="assets/image-20210713105339785.png" alt="image-20210713105339785"  />
</p>
<h2 id="23å®‰è£…æ’ä»¶">2.3.å®‰è£…æ’ä»¶<a hidden class="anchor" aria-hidden="true" href="#23å®‰è£…æ’ä»¶">#</a></h2>
<p>æœ€åå°±æ˜¯å®‰è£…äº†ï¼Œéœ€è¦è¿›å…¥MQå®¹å™¨å†…éƒ¨æ¥æ‰§è¡Œå®‰è£…ã€‚æˆ‘çš„å®¹å™¨åä¸º<code>mq</code>ï¼Œæ‰€ä»¥æ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>docker exec -it mq bash
</span></span></code></pre></div><p>æ‰§è¡Œæ—¶ï¼Œè¯·å°†å…¶ä¸­çš„ <code>-it</code> åé¢çš„<code>mq</code>æ›¿æ¢ä¸ºä½ è‡ªå·±çš„å®¹å™¨å.</p>
<p>è¿›å…¥å®¹å™¨å†…éƒ¨åï¼Œæ‰§è¡Œä¸‹é¢å‘½ä»¤å¼€å¯æ’ä»¶ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>rabbitmq-plugins enable rabbitmq_delayed_message_exchange
</span></span></code></pre></div><p>ç»“æœå¦‚ä¸‹ï¼š</p>
<p><img loading="lazy" src="assets/image-20210713105829435.png" alt="image-20210713105829435"  />
</p>
<h1 id="3é›†ç¾¤éƒ¨ç½²">3.é›†ç¾¤éƒ¨ç½²<a hidden class="anchor" aria-hidden="true" href="#3é›†ç¾¤éƒ¨ç½²">#</a></h1>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹çœ‹å¦‚ä½•å®‰è£…RabbitMQçš„é›†ç¾¤ã€‚</p>
<h2 id="21é›†ç¾¤åˆ†ç±»">2.1.é›†ç¾¤åˆ†ç±»<a hidden class="anchor" aria-hidden="true" href="#21é›†ç¾¤åˆ†ç±»">#</a></h2>
<p>åœ¨RabbitMQçš„å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œè®²è¿°äº†ä¸¤ç§é›†ç¾¤çš„é…ç½®æ–¹å¼ï¼š</p>
<ul>
<li>æ™®é€šæ¨¡å¼ï¼šæ™®é€šæ¨¡å¼é›†ç¾¤ä¸è¿›è¡Œæ•°æ®åŒæ­¥ï¼Œæ¯ä¸ªMQéƒ½æœ‰è‡ªå·±çš„é˜Ÿåˆ—ã€æ•°æ®ä¿¡æ¯ï¼ˆå…¶å®ƒå…ƒæ•°æ®ä¿¡æ¯å¦‚äº¤æ¢æœºç­‰ä¼šåŒæ­¥ï¼‰ã€‚ä¾‹å¦‚æˆ‘ä»¬æœ‰2ä¸ªMQï¼šmq1ï¼Œå’Œmq2ï¼Œå¦‚æœä½ çš„æ¶ˆæ¯åœ¨mq1ï¼Œè€Œä½ è¿æ¥åˆ°äº†mq2ï¼Œé‚£ä¹ˆmq2ä¼šå»mq1æ‹‰å–æ¶ˆæ¯ï¼Œç„¶åè¿”å›ç»™ä½ ã€‚å¦‚æœmq1å®•æœºï¼Œæ¶ˆæ¯å°±ä¼šä¸¢å¤±ã€‚</li>
<li>é•œåƒæ¨¡å¼ï¼šä¸æ™®é€šæ¨¡å¼ä¸åŒï¼Œé˜Ÿåˆ—ä¼šåœ¨å„ä¸ªmqçš„é•œåƒèŠ‚ç‚¹ä¹‹é—´åŒæ­¥ï¼Œå› æ­¤ä½ è¿æ¥åˆ°ä»»ä½•ä¸€ä¸ªé•œåƒèŠ‚ç‚¹ï¼Œå‡å¯è·å–åˆ°æ¶ˆæ¯ã€‚è€Œä¸”å¦‚æœä¸€ä¸ªèŠ‚ç‚¹å®•æœºï¼Œå¹¶ä¸ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚ä¸è¿‡ï¼Œè¿™ç§æ–¹å¼å¢åŠ äº†æ•°æ®åŒæ­¥çš„å¸¦å®½æ¶ˆè€—ã€‚</li>
</ul>
<p>æˆ‘ä»¬å…ˆæ¥çœ‹æ™®é€šæ¨¡å¼é›†ç¾¤ï¼Œæˆ‘ä»¬çš„è®¡åˆ’éƒ¨ç½²3èŠ‚ç‚¹çš„mqé›†ç¾¤ï¼š</p>
<table>
<thead>
<tr>
<th>ä¸»æœºå</th>
<th>æ§åˆ¶å°ç«¯å£</th>
<th>amqpé€šä¿¡ç«¯å£</th>
</tr>
</thead>
<tbody>
<tr>
<td>mq1</td>
<td>8081 &mdash;&gt; 15672</td>
<td>8071 &mdash;&gt; 5672</td>
</tr>
<tr>
<td>mq2</td>
<td>8082 &mdash;&gt; 15672</td>
<td>8072 &mdash;&gt; 5672</td>
</tr>
<tr>
<td>mq3</td>
<td>8083 &mdash;&gt; 15672</td>
<td>8073  &mdash;&gt; 5672</td>
</tr>
</tbody>
</table>
<p>é›†ç¾¤ä¸­çš„èŠ‚ç‚¹æ ‡ç¤ºé»˜è®¤éƒ½æ˜¯ï¼š<code>rabbit@[hostname]</code>ï¼Œå› æ­¤ä»¥ä¸Šä¸‰ä¸ªèŠ‚ç‚¹çš„åç§°åˆ†åˆ«ä¸ºï¼š</p>
<ul>
<li>rabbit@mq1</li>
<li>rabbit@mq2</li>
<li>rabbit@mq3</li>
</ul>
<h2 id="22è·å–cookie">2.2.è·å–cookie<a hidden class="anchor" aria-hidden="true" href="#22è·å–cookie">#</a></h2>
<p>RabbitMQåº•å±‚ä¾èµ–äºErlangï¼Œè€ŒErlangè™šæ‹Ÿæœºå°±æ˜¯ä¸€ä¸ªé¢å‘åˆ†å¸ƒå¼çš„è¯­è¨€ï¼Œé»˜è®¤å°±æ”¯æŒé›†ç¾¤æ¨¡å¼ã€‚é›†ç¾¤æ¨¡å¼ä¸­çš„æ¯ä¸ªRabbitMQ èŠ‚ç‚¹ä½¿ç”¨ cookie æ¥ç¡®å®šå®ƒä»¬æ˜¯å¦è¢«å…è®¸ç›¸äº’é€šä¿¡ã€‚</p>
<p>è¦ä½¿ä¸¤ä¸ªèŠ‚ç‚¹èƒ½å¤Ÿé€šä¿¡ï¼Œå®ƒä»¬å¿…é¡»å…·æœ‰ç›¸åŒçš„å…±äº«ç§˜å¯†ï¼Œç§°ä¸º<strong>Erlang cookie</strong>ã€‚cookie åªæ˜¯ä¸€ä¸²æœ€å¤š 255 ä¸ªå­—ç¬¦çš„å­—æ¯æ•°å­—å­—ç¬¦ã€‚</p>
<p>æ¯ä¸ªé›†ç¾¤èŠ‚ç‚¹å¿…é¡»å…·æœ‰<strong>ç›¸åŒçš„ cookie</strong>ã€‚å®ä¾‹ä¹‹é—´ä¹Ÿéœ€è¦å®ƒæ¥ç›¸äº’é€šä¿¡ã€‚</p>
<p>æˆ‘ä»¬å…ˆåœ¨ä¹‹å‰å¯åŠ¨çš„mqå®¹å™¨ä¸­è·å–ä¸€ä¸ªcookieå€¼ï¼Œä½œä¸ºé›†ç¾¤çš„cookieã€‚æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>docker exec -it mq cat /var/lib/rabbitmq/.erlang.cookie
</span></span></code></pre></div><p>å¯ä»¥çœ‹åˆ°cookieå€¼å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>FXZMCVGLBIXZCDEMMVZQ
</span></span></code></pre></div><p>æ¥ä¸‹æ¥ï¼Œåœæ­¢å¹¶åˆ é™¤å½“å‰çš„mqå®¹å™¨ï¼Œæˆ‘ä»¬é‡æ–°æ­å»ºé›†ç¾¤ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>docker rm -f mq
</span></span></code></pre></div><p><img loading="lazy" src="assets/image-20210717212345165.png" alt="image-20210717212345165"  />
</p>
<h2 id="23å‡†å¤‡é›†ç¾¤é…ç½®">2.3.å‡†å¤‡é›†ç¾¤é…ç½®<a hidden class="anchor" aria-hidden="true" href="#23å‡†å¤‡é›†ç¾¤é…ç½®">#</a></h2>
<p>åœ¨/tmpç›®å½•æ–°å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶ rabbitmq.confï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cd /tmp
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>touch rabbitmq.conf
</span></span></code></pre></div><p>æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">loopback_users.guest</span> = <span style="color:#e6db74">false</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">listeners.tcp.default</span> = <span style="color:#ae81ff">5672</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">cluster_formation.peer_discovery_backend</span> = <span style="color:#e6db74">rabbit_peer_discovery_classic_config</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">cluster_formation.classic_config.nodes.1</span> = <span style="color:#e6db74">rabbit@mq1</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">cluster_formation.classic_config.nodes.2</span> = <span style="color:#e6db74">rabbit@mq2</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">cluster_formation.classic_config.nodes.3</span> = <span style="color:#e6db74">rabbit@mq3</span>
</span></span></code></pre></div><p>å†åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œè®°å½•cookie</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cd /tmp
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºcookieæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>touch .erlang.cookie
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å†™å…¥cookie</span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;FXZMCVGLBIXZCDEMMVZQ&#34;</span> &gt; .erlang.cookie
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ”¹cookieæ–‡ä»¶çš„æƒé™</span>
</span></span><span style="display:flex;"><span>chmod <span style="color:#ae81ff">600</span> .erlang.cookie
</span></span></code></pre></div><p>å‡†å¤‡ä¸‰ä¸ªç›®å½•,mq1ã€mq2ã€mq3ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cd /tmp
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºç›®å½•</span>
</span></span><span style="display:flex;"><span>mkdir mq1 mq2 mq3
</span></span></code></pre></div><p>ç„¶åæ‹·è´rabbitmq.confã€cookieæ–‡ä»¶åˆ°mq1ã€mq2ã€mq3ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e"># è¿›å…¥/tmp</span>
</span></span><span style="display:flex;"><span>cd /tmp
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ‹·è´</span>
</span></span><span style="display:flex;"><span>cp rabbitmq.conf mq1
</span></span><span style="display:flex;"><span>cp rabbitmq.conf mq2
</span></span><span style="display:flex;"><span>cp rabbitmq.conf mq3
</span></span><span style="display:flex;"><span>cp .erlang.cookie mq1
</span></span><span style="display:flex;"><span>cp .erlang.cookie mq2
</span></span><span style="display:flex;"><span>cp .erlang.cookie mq3
</span></span></code></pre></div><h2 id="24å¯åŠ¨é›†ç¾¤">2.4.å¯åŠ¨é›†ç¾¤<a hidden class="anchor" aria-hidden="true" href="#24å¯åŠ¨é›†ç¾¤">#</a></h2>
<p>åˆ›å»ºä¸€ä¸ªç½‘ç»œï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>docker network create mq-net
</span></span></code></pre></div><p>docker volume create</p>
<p>è¿è¡Œå‘½ä»¤</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>docker run -d --net mq-net <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-v <span style="color:#e6db74">${</span>PWD<span style="color:#e6db74">}</span>/mq1/rabbitmq.conf:/etc/rabbitmq/rabbitmq.conf <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-v <span style="color:#e6db74">${</span>PWD<span style="color:#e6db74">}</span>/.erlang.cookie:/var/lib/rabbitmq/.erlang.cookie <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-e RABBITMQ_DEFAULT_USER<span style="color:#f92672">=</span>itcast <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-e RABBITMQ_DEFAULT_PASS<span style="color:#f92672">=</span><span style="color:#ae81ff">123321</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--name mq1 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--hostname mq1 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-p 8071:5672 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-p 8081:15672 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>rabbitmq:3.8-management
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>docker run -d --net mq-net <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-v <span style="color:#e6db74">${</span>PWD<span style="color:#e6db74">}</span>/mq2/rabbitmq.conf:/etc/rabbitmq/rabbitmq.conf <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-v <span style="color:#e6db74">${</span>PWD<span style="color:#e6db74">}</span>/.erlang.cookie:/var/lib/rabbitmq/.erlang.cookie <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-e RABBITMQ_DEFAULT_USER<span style="color:#f92672">=</span>itcast <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-e RABBITMQ_DEFAULT_PASS<span style="color:#f92672">=</span><span style="color:#ae81ff">123321</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--name mq2 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--hostname mq2 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-p 8072:5672 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-p 8082:15672 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>rabbitmq:3.8-management
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>docker run -d --net mq-net <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-v <span style="color:#e6db74">${</span>PWD<span style="color:#e6db74">}</span>/mq3/rabbitmq.conf:/etc/rabbitmq/rabbitmq.conf <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-v <span style="color:#e6db74">${</span>PWD<span style="color:#e6db74">}</span>/.erlang.cookie:/var/lib/rabbitmq/.erlang.cookie <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-e RABBITMQ_DEFAULT_USER<span style="color:#f92672">=</span>itcast <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-e RABBITMQ_DEFAULT_PASS<span style="color:#f92672">=</span><span style="color:#ae81ff">123321</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--name mq3 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--hostname mq3 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-p 8073:5672 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-p 8083:15672 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>rabbitmq:3.8-management
</span></span></code></pre></div><h2 id="25æµ‹è¯•">2.5.æµ‹è¯•<a hidden class="anchor" aria-hidden="true" href="#25æµ‹è¯•">#</a></h2>
<p>åœ¨mq1è¿™ä¸ªèŠ‚ç‚¹ä¸Šæ·»åŠ ä¸€ä¸ªé˜Ÿåˆ—ï¼š</p>
<p><img loading="lazy" src="assets/image-20210717222833196.png" alt="image-20210717222833196"  />
</p>
<p>å¦‚å›¾ï¼Œåœ¨mq2å’Œmq3ä¸¤ä¸ªæ§åˆ¶å°ä¹Ÿéƒ½èƒ½çœ‹åˆ°ï¼š</p>
<p><img loading="lazy" src="assets/image-20210717223057902.png" alt="image-20210717223057902"  />
</p>
<h3 id="251æ•°æ®å…±äº«æµ‹è¯•">2.5.1.æ•°æ®å…±äº«æµ‹è¯•<a hidden class="anchor" aria-hidden="true" href="#251æ•°æ®å…±äº«æµ‹è¯•">#</a></h3>
<p>ç‚¹å‡»è¿™ä¸ªé˜Ÿåˆ—ï¼Œè¿›å…¥ç®¡ç†é¡µé¢ï¼š</p>
<p><img loading="lazy" src="assets/image-20210717223421750.png" alt="image-20210717223421750"  />
</p>
<p>ç„¶ååˆ©ç”¨æ§åˆ¶å°å‘é€ä¸€æ¡æ¶ˆæ¯åˆ°è¿™ä¸ªé˜Ÿåˆ—ï¼š</p>
<p><img loading="lazy" src="assets/image-20210717223320238.png" alt="image-20210717223320238"  />
</p>
<p>ç»“æœåœ¨mq2ã€mq3ä¸Šéƒ½èƒ½çœ‹åˆ°è¿™æ¡æ¶ˆæ¯ï¼š</p>
<p><img loading="lazy" src="assets/image-20210717223603628.png" alt="image-20210717223603628"  />
</p>
<h3 id="252å¯ç”¨æ€§æµ‹è¯•">2.5.2.å¯ç”¨æ€§æµ‹è¯•<a hidden class="anchor" aria-hidden="true" href="#252å¯ç”¨æ€§æµ‹è¯•">#</a></h3>
<p>æˆ‘ä»¬è®©å…¶ä¸­ä¸€å°èŠ‚ç‚¹mq1å®•æœºï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>docker stop mq1
</span></span></code></pre></div><p>ç„¶åç™»å½•mq2æˆ–mq3çš„æ§åˆ¶å°ï¼Œå‘ç°simple.queueä¹Ÿä¸å¯ç”¨äº†ï¼š</p>
<p><img loading="lazy" src="assets/image-20210717223800203.png" alt="image-20210717223800203"  />
</p>
<p>è¯´æ˜æ•°æ®å¹¶æ²¡æœ‰æ‹·è´åˆ°mq2å’Œmq3ã€‚</p>
<h1 id="4é•œåƒæ¨¡å¼">4.é•œåƒæ¨¡å¼<a hidden class="anchor" aria-hidden="true" href="#4é•œåƒæ¨¡å¼">#</a></h1>
<p>åœ¨åˆšåˆšçš„æ¡ˆä¾‹ä¸­ï¼Œä¸€æ—¦åˆ›å»ºé˜Ÿåˆ—çš„ä¸»æœºå®•æœºï¼Œé˜Ÿåˆ—å°±ä¼šä¸å¯ç”¨ã€‚ä¸å…·å¤‡é«˜å¯ç”¨èƒ½åŠ›ã€‚å¦‚æœè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¿…é¡»ä½¿ç”¨å®˜æ–¹æä¾›çš„é•œåƒé›†ç¾¤æ–¹æ¡ˆã€‚</p>
<p>å®˜æ–¹æ–‡æ¡£åœ°å€ï¼šhttps://www.rabbitmq.com/ha.html</p>
<h2 id="41é•œåƒæ¨¡å¼çš„ç‰¹å¾">4.1.é•œåƒæ¨¡å¼çš„ç‰¹å¾<a hidden class="anchor" aria-hidden="true" href="#41é•œåƒæ¨¡å¼çš„ç‰¹å¾">#</a></h2>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œé˜Ÿåˆ—åªä¿å­˜åœ¨åˆ›å»ºè¯¥é˜Ÿåˆ—çš„èŠ‚ç‚¹ä¸Šã€‚è€Œé•œåƒæ¨¡å¼ä¸‹ï¼Œåˆ›å»ºé˜Ÿåˆ—çš„èŠ‚ç‚¹è¢«ç§°ä¸ºè¯¥é˜Ÿåˆ—çš„<strong>ä¸»èŠ‚ç‚¹</strong>ï¼Œé˜Ÿåˆ—è¿˜ä¼šæ‹·è´åˆ°é›†ç¾¤ä¸­çš„å…¶å®ƒèŠ‚ç‚¹ï¼Œä¹Ÿå«åšè¯¥é˜Ÿåˆ—çš„<strong>é•œåƒ</strong>èŠ‚ç‚¹ã€‚</p>
<p>ä½†æ˜¯ï¼Œä¸åŒé˜Ÿåˆ—å¯ä»¥åœ¨é›†ç¾¤ä¸­çš„ä»»æ„èŠ‚ç‚¹ä¸Šåˆ›å»ºï¼Œå› æ­¤ä¸åŒé˜Ÿåˆ—çš„ä¸»èŠ‚ç‚¹å¯ä»¥ä¸åŒã€‚ç”šè‡³ï¼Œ<strong>ä¸€ä¸ªé˜Ÿåˆ—çš„ä¸»èŠ‚ç‚¹å¯èƒ½æ˜¯å¦ä¸€ä¸ªé˜Ÿåˆ—çš„é•œåƒèŠ‚ç‚¹</strong>ã€‚</p>
<p>ç”¨æˆ·å‘é€ç»™é˜Ÿåˆ—çš„ä¸€åˆ‡è¯·æ±‚ï¼Œä¾‹å¦‚å‘é€æ¶ˆæ¯ã€æ¶ˆæ¯å›æ‰§é»˜è®¤éƒ½ä¼šåœ¨ä¸»èŠ‚ç‚¹å®Œæˆï¼Œå¦‚æœæ˜¯ä»èŠ‚ç‚¹æ¥æ”¶åˆ°è¯·æ±‚ï¼Œä¹Ÿä¼šè·¯ç”±åˆ°ä¸»èŠ‚ç‚¹å»å®Œæˆã€‚<strong>é•œåƒèŠ‚ç‚¹ä»…ä»…èµ·åˆ°å¤‡ä»½æ•°æ®ä½œç”¨</strong>ã€‚</p>
<p>å½“ä¸»èŠ‚ç‚¹æ¥æ”¶åˆ°æ¶ˆè´¹è€…çš„ACKæ—¶ï¼Œæ‰€æœ‰é•œåƒéƒ½ä¼šåˆ é™¤èŠ‚ç‚¹ä¸­çš„æ•°æ®ã€‚</p>
<p>æ€»ç»“å¦‚ä¸‹ï¼š</p>
<ul>
<li>é•œåƒé˜Ÿåˆ—ç»“æ„æ˜¯ä¸€ä¸»å¤šä»ï¼ˆä»å°±æ˜¯é•œåƒï¼‰</li>
<li>æ‰€æœ‰æ“ä½œéƒ½æ˜¯ä¸»èŠ‚ç‚¹å®Œæˆï¼Œç„¶ååŒæ­¥ç»™é•œåƒèŠ‚ç‚¹</li>
<li>ä¸»å®•æœºåï¼Œé•œåƒèŠ‚ç‚¹ä¼šæ›¿ä»£æˆæ–°çš„ä¸»ï¼ˆå¦‚æœåœ¨ä¸»ä»åŒæ­¥å®Œæˆå‰ï¼Œä¸»å°±å·²ç»å®•æœºï¼Œå¯èƒ½å‡ºç°æ•°æ®ä¸¢å¤±ï¼‰</li>
<li>ä¸å…·å¤‡è´Ÿè½½å‡è¡¡åŠŸèƒ½ï¼Œå› ä¸ºæ‰€æœ‰æ“ä½œéƒ½ä¼šæœ‰ä¸»èŠ‚ç‚¹å®Œæˆï¼ˆä½†æ˜¯ä¸åŒé˜Ÿåˆ—ï¼Œå…¶ä¸»èŠ‚ç‚¹å¯ä»¥ä¸åŒï¼Œå¯ä»¥åˆ©ç”¨è¿™ä¸ªæé«˜ååé‡ï¼‰</li>
</ul>
<h2 id="42é•œåƒæ¨¡å¼çš„é…ç½®">4.2.é•œåƒæ¨¡å¼çš„é…ç½®<a hidden class="anchor" aria-hidden="true" href="#42é•œåƒæ¨¡å¼çš„é…ç½®">#</a></h2>
<p>é•œåƒæ¨¡å¼çš„é…ç½®æœ‰3ç§æ¨¡å¼ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:left">ha-mode</th>
<th style="text-align:left">ha-params</th>
<th style="text-align:left">æ•ˆæœ</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">å‡†ç¡®æ¨¡å¼exactly</td>
<td style="text-align:left">é˜Ÿåˆ—çš„å‰¯æœ¬é‡count</td>
<td style="text-align:left">é›†ç¾¤ä¸­é˜Ÿåˆ—å‰¯æœ¬ï¼ˆä¸»æœåŠ¡å™¨å’Œé•œåƒæœåŠ¡å™¨ä¹‹å’Œï¼‰çš„æ•°é‡ã€‚countå¦‚æœä¸º1æ„å‘³ç€å•ä¸ªå‰¯æœ¬ï¼šå³é˜Ÿåˆ—ä¸»èŠ‚ç‚¹ã€‚countå€¼ä¸º2è¡¨ç¤º2ä¸ªå‰¯æœ¬ï¼š1ä¸ªé˜Ÿåˆ—ä¸»å’Œ1ä¸ªé˜Ÿåˆ—é•œåƒã€‚æ¢å¥è¯è¯´ï¼šcount = é•œåƒæ•°é‡ + 1ã€‚å¦‚æœç¾¤é›†ä¸­çš„èŠ‚ç‚¹æ•°å°‘äºcountï¼Œåˆ™è¯¥é˜Ÿåˆ—å°†é•œåƒåˆ°æ‰€æœ‰èŠ‚ç‚¹ã€‚å¦‚æœæœ‰é›†ç¾¤æ€»æ•°å¤§äºcount+1ï¼Œå¹¶ä¸”åŒ…å«é•œåƒçš„èŠ‚ç‚¹å‡ºç°æ•…éšœï¼Œåˆ™å°†åœ¨å¦ä¸€ä¸ªèŠ‚ç‚¹ä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒã€‚</td>
</tr>
<tr>
<td style="text-align:left">all</td>
<td style="text-align:left">(none)</td>
<td style="text-align:left">é˜Ÿåˆ—åœ¨ç¾¤é›†ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ä¹‹é—´è¿›è¡Œé•œåƒã€‚é˜Ÿåˆ—å°†é•œåƒåˆ°ä»»ä½•æ–°åŠ å…¥çš„èŠ‚ç‚¹ã€‚é•œåƒåˆ°æ‰€æœ‰èŠ‚ç‚¹å°†å¯¹æ‰€æœ‰ç¾¤é›†èŠ‚ç‚¹æ–½åŠ é¢å¤–çš„å‹åŠ›ï¼ŒåŒ…æ‹¬ç½‘ç»œI / Oï¼Œç£ç›˜I / Oå’Œç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µã€‚æ¨èä½¿ç”¨exactlyï¼Œè®¾ç½®å‰¯æœ¬æ•°ä¸ºï¼ˆN / 2 +1ï¼‰ã€‚</td>
</tr>
<tr>
<td style="text-align:left">nodes</td>
<td style="text-align:left"><em>node names</em></td>
<td style="text-align:left">æŒ‡å®šé˜Ÿåˆ—åˆ›å»ºåˆ°å“ªäº›èŠ‚ç‚¹ï¼Œå¦‚æœæŒ‡å®šçš„èŠ‚ç‚¹å…¨éƒ¨ä¸å­˜åœ¨ï¼Œåˆ™ä¼šå‡ºç°å¼‚å¸¸ã€‚å¦‚æœæŒ‡å®šçš„èŠ‚ç‚¹åœ¨é›†ç¾¤ä¸­å­˜åœ¨ï¼Œä½†æ˜¯æš‚æ—¶ä¸å¯ç”¨ï¼Œä¼šåˆ›å»ºèŠ‚ç‚¹åˆ°å½“å‰å®¢æˆ·ç«¯è¿æ¥åˆ°çš„èŠ‚ç‚¹ã€‚</td>
</tr>
</tbody>
</table>
<p>è¿™é‡Œæˆ‘ä»¬ä»¥rabbitmqctlå‘½ä»¤ä½œä¸ºæ¡ˆä¾‹æ¥è®²è§£é…ç½®è¯­æ³•ã€‚</p>
<p>è¯­æ³•ç¤ºä¾‹ï¼š</p>
<h3 id="421exactlyæ¨¡å¼">4.2.1.exactlyæ¨¡å¼<a hidden class="anchor" aria-hidden="true" href="#421exactlyæ¨¡å¼">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>rabbitmqctl set_policy ha-two &#34;^two\.&#34; &#39;{&#34;ha-mode&#34;:&#34;exactly&#34;,&#34;ha-params&#34;:2,&#34;ha-sync-mode&#34;:&#34;automatic&#34;}&#39;
</span></span></code></pre></div><ul>
<li><code>rabbitmqctl set_policy</code>ï¼šå›ºå®šå†™æ³•</li>
<li><code>ha-two</code>ï¼šç­–ç•¥åç§°ï¼Œè‡ªå®šä¹‰</li>
<li><code>&quot;^two\.&quot;</code>ï¼šåŒ¹é…é˜Ÿåˆ—çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œç¬¦åˆå‘½åè§„åˆ™çš„é˜Ÿåˆ—æ‰ç”Ÿæ•ˆï¼Œè¿™é‡Œæ˜¯ä»»ä½•ä»¥<code>two.</code>å¼€å¤´çš„é˜Ÿåˆ—åç§°</li>
<li><code>'{&quot;ha-mode&quot;:&quot;exactly&quot;,&quot;ha-params&quot;:2,&quot;ha-sync-mode&quot;:&quot;automatic&quot;}'</code>: ç­–ç•¥å†…å®¹
<ul>
<li><code>&quot;ha-mode&quot;:&quot;exactly&quot;</code>ï¼šç­–ç•¥æ¨¡å¼ï¼Œæ­¤å¤„æ˜¯exactlyæ¨¡å¼ï¼ŒæŒ‡å®šå‰¯æœ¬æ•°é‡</li>
<li><code>&quot;ha-params&quot;:2</code>ï¼šç­–ç•¥å‚æ•°ï¼Œè¿™é‡Œæ˜¯2ï¼Œå°±æ˜¯å‰¯æœ¬æ•°é‡ä¸º2ï¼Œ1ä¸»1é•œåƒ</li>
<li><code>&quot;ha-sync-mode&quot;:&quot;automatic&quot;</code>ï¼šåŒæ­¥ç­–ç•¥ï¼Œé»˜è®¤æ˜¯manualï¼Œå³æ–°åŠ å…¥çš„é•œåƒèŠ‚ç‚¹ä¸ä¼šåŒæ­¥æ—§çš„æ¶ˆæ¯ã€‚å¦‚æœè®¾ç½®ä¸ºautomaticï¼Œåˆ™æ–°åŠ å…¥çš„é•œåƒèŠ‚ç‚¹ä¼šæŠŠä¸»èŠ‚ç‚¹ä¸­æ‰€æœ‰æ¶ˆæ¯éƒ½åŒæ­¥ï¼Œä¼šå¸¦æ¥é¢å¤–çš„ç½‘ç»œå¼€é”€</li>
</ul>
</li>
</ul>
<h3 id="422allæ¨¡å¼">4.2.2.allæ¨¡å¼<a hidden class="anchor" aria-hidden="true" href="#422allæ¨¡å¼">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>rabbitmqctl set_policy ha-all &#34;^all\.&#34; &#39;{&#34;ha-mode&#34;:&#34;all&#34;}&#39;
</span></span></code></pre></div><ul>
<li><code>ha-all</code>ï¼šç­–ç•¥åç§°ï¼Œè‡ªå®šä¹‰</li>
<li><code>&quot;^all\.&quot;</code>ï¼šåŒ¹é…æ‰€æœ‰ä»¥<code>all.</code>å¼€å¤´çš„é˜Ÿåˆ—å</li>
<li><code>'{&quot;ha-mode&quot;:&quot;all&quot;}'</code>ï¼šç­–ç•¥å†…å®¹
<ul>
<li><code>&quot;ha-mode&quot;:&quot;all&quot;</code>ï¼šç­–ç•¥æ¨¡å¼ï¼Œæ­¤å¤„æ˜¯allæ¨¡å¼ï¼Œå³æ‰€æœ‰èŠ‚ç‚¹éƒ½ä¼šç§°ä¸ºé•œåƒèŠ‚ç‚¹</li>
</ul>
</li>
</ul>
<h3 id="423nodesæ¨¡å¼">4.2.3.nodesæ¨¡å¼<a hidden class="anchor" aria-hidden="true" href="#423nodesæ¨¡å¼">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>rabbitmqctl set_policy ha-nodes &#34;^nodes\.&#34; &#39;{&#34;ha-mode&#34;:&#34;nodes&#34;,&#34;ha-params&#34;:[&#34;rabbit@nodeA&#34;, &#34;rabbit@nodeB&#34;]}&#39;
</span></span></code></pre></div><ul>
<li><code>rabbitmqctl set_policy</code>ï¼šå›ºå®šå†™æ³•</li>
<li><code>ha-nodes</code>ï¼šç­–ç•¥åç§°ï¼Œè‡ªå®šä¹‰</li>
<li><code>&quot;^nodes\.&quot;</code>ï¼šåŒ¹é…é˜Ÿåˆ—çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œç¬¦åˆå‘½åè§„åˆ™çš„é˜Ÿåˆ—æ‰ç”Ÿæ•ˆï¼Œè¿™é‡Œæ˜¯ä»»ä½•ä»¥<code>nodes.</code>å¼€å¤´çš„é˜Ÿåˆ—åç§°</li>
<li><code>'{&quot;ha-mode&quot;:&quot;nodes&quot;,&quot;ha-params&quot;:[&quot;rabbit@nodeA&quot;, &quot;rabbit@nodeB&quot;]}'</code>: ç­–ç•¥å†…å®¹
<ul>
<li><code>&quot;ha-mode&quot;:&quot;nodes&quot;</code>ï¼šç­–ç•¥æ¨¡å¼ï¼Œæ­¤å¤„æ˜¯nodesæ¨¡å¼</li>
<li><code>&quot;ha-params&quot;:[&quot;rabbit@mq1&quot;, &quot;rabbit@mq2&quot;]</code>ï¼šç­–ç•¥å‚æ•°ï¼Œè¿™é‡ŒæŒ‡å®šå‰¯æœ¬æ‰€åœ¨èŠ‚ç‚¹åç§°</li>
</ul>
</li>
</ul>
<h2 id="43æµ‹è¯•">4.3.æµ‹è¯•<a hidden class="anchor" aria-hidden="true" href="#43æµ‹è¯•">#</a></h2>
<p>æˆ‘ä»¬ä½¿ç”¨exactlyæ¨¡å¼çš„é•œåƒï¼Œå› ä¸ºé›†ç¾¤èŠ‚ç‚¹æ•°é‡ä¸º3ï¼Œå› æ­¤é•œåƒæ•°é‡å°±è®¾ç½®ä¸º2.</p>
<p>è¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>docker exec -it mq1 rabbitmqctl set_policy ha-two <span style="color:#e6db74">&#34;^two\.&#34;</span> <span style="color:#e6db74">&#39;{&#34;ha-mode&#34;:&#34;exactly&#34;,&#34;ha-params&#34;:2,&#34;ha-sync-mode&#34;:&#34;automatic&#34;}&#39;</span>
</span></span></code></pre></div><p>ä¸‹é¢ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„é˜Ÿåˆ—ï¼š</p>
<p><img loading="lazy" src="assets/image-20210717231751411.png" alt="image-20210717231751411"  />
</p>
<p>åœ¨ä»»æ„ä¸€ä¸ªmqæ§åˆ¶å°æŸ¥çœ‹é˜Ÿåˆ—ï¼š</p>
<p><img loading="lazy" src="assets/image-20210717231829505.png" alt="image-20210717231829505"  />
</p>
<h3 id="431æµ‹è¯•æ•°æ®å…±äº«">4.3.1.æµ‹è¯•æ•°æ®å…±äº«<a hidden class="anchor" aria-hidden="true" href="#431æµ‹è¯•æ•°æ®å…±äº«">#</a></h3>
<p>ç»™two.queueå‘é€ä¸€æ¡æ¶ˆæ¯ï¼š</p>
<p><img loading="lazy" src="assets/image-20210717231958996.png" alt="image-20210717231958996"  />
</p>
<p>ç„¶ååœ¨mq1ã€mq2ã€mq3çš„ä»»æ„æ§åˆ¶å°æŸ¥çœ‹æ¶ˆæ¯ï¼š</p>
<p><img loading="lazy" src="assets/image-20210717232108584.png" alt="image-20210717232108584"  />
</p>
<h3 id="432æµ‹è¯•é«˜å¯ç”¨">4.3.2.æµ‹è¯•é«˜å¯ç”¨<a hidden class="anchor" aria-hidden="true" href="#432æµ‹è¯•é«˜å¯ç”¨">#</a></h3>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬è®©two.queueçš„ä¸»èŠ‚ç‚¹mq1å®•æœºï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>docker stop mq1
</span></span></code></pre></div><p>æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼š</p>
<p><img loading="lazy" src="assets/image-20210717232257420.png" alt="image-20210717232257420"  />
</p>
<p>æŸ¥çœ‹é˜Ÿåˆ—çŠ¶æ€ï¼š</p>
<p><img loading="lazy" src="assets/image-20210717232322646.png" alt="image-20210717232322646"  />
</p>
<p>å‘ç°ä¾ç„¶æ˜¯å¥åº·çš„ï¼å¹¶ä¸”å…¶ä¸»èŠ‚ç‚¹åˆ‡æ¢åˆ°äº†rabbit@mq2ä¸Š</p>
<h1 id="5ä»²è£é˜Ÿåˆ—">5.ä»²è£é˜Ÿåˆ—<a hidden class="anchor" aria-hidden="true" href="#5ä»²è£é˜Ÿåˆ—">#</a></h1>
<p>ä»RabbitMQ 3.8ç‰ˆæœ¬å¼€å§‹ï¼Œå¼•å…¥äº†æ–°çš„ä»²è£é˜Ÿåˆ—ï¼Œä»–å…·å¤‡ä¸é•œåƒé˜Ÿé‡Œç±»ä¼¼çš„åŠŸèƒ½ï¼Œä½†ä½¿ç”¨æ›´åŠ æ–¹ä¾¿ã€‚</p>
<h2 id="51æ·»åŠ ä»²è£é˜Ÿåˆ—">5.1.æ·»åŠ ä»²è£é˜Ÿåˆ—<a hidden class="anchor" aria-hidden="true" href="#51æ·»åŠ ä»²è£é˜Ÿåˆ—">#</a></h2>
<p>åœ¨ä»»æ„æ§åˆ¶å°æ·»åŠ ä¸€ä¸ªé˜Ÿåˆ—ï¼Œä¸€å®šè¦é€‰æ‹©é˜Ÿåˆ—ç±»å‹ä¸ºQuorumç±»å‹ã€‚</p>
<p><img loading="lazy" src="assets/image-20210717234329640.png" alt="image-20210717234329640"  />
</p>
<p>åœ¨ä»»æ„æ§åˆ¶å°æŸ¥çœ‹é˜Ÿåˆ—ï¼š</p>
<p><img loading="lazy" src="assets/image-20210717234426209.png" alt="image-20210717234426209"  />
</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œä»²è£é˜Ÿåˆ—çš„ + 2å­—æ ·ã€‚ä»£è¡¨è¿™ä¸ªé˜Ÿåˆ—æœ‰2ä¸ªé•œåƒèŠ‚ç‚¹ã€‚</p>
<p>å› ä¸ºä»²è£é˜Ÿåˆ—é»˜è®¤çš„é•œåƒæ•°ä¸º5ã€‚å¦‚æœä½ çš„é›†ç¾¤æœ‰7ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆé•œåƒæ•°è‚¯å®šæ˜¯5ï¼›è€Œæˆ‘ä»¬é›†ç¾¤åªæœ‰3ä¸ªèŠ‚ç‚¹ï¼Œå› æ­¤é•œåƒæ•°é‡å°±æ˜¯3.</p>
<h2 id="52æµ‹è¯•">5.2.æµ‹è¯•<a hidden class="anchor" aria-hidden="true" href="#52æµ‹è¯•">#</a></h2>
<p>å¯ä»¥å‚è€ƒå¯¹é•œåƒé›†ç¾¤çš„æµ‹è¯•ï¼Œæ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚</p>
<h2 id="53é›†ç¾¤æ‰©å®¹">5.3.é›†ç¾¤æ‰©å®¹<a hidden class="anchor" aria-hidden="true" href="#53é›†ç¾¤æ‰©å®¹">#</a></h2>
<h3 id="531åŠ å…¥é›†ç¾¤">5.3.1.åŠ å…¥é›†ç¾¤<a hidden class="anchor" aria-hidden="true" href="#531åŠ å…¥é›†ç¾¤">#</a></h3>
<p>1ï¼‰å¯åŠ¨ä¸€ä¸ªæ–°çš„MQå®¹å™¨ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>docker run -d --net mq-net <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-v <span style="color:#e6db74">${</span>PWD<span style="color:#e6db74">}</span>/.erlang.cookie:/var/lib/rabbitmq/.erlang.cookie <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-e RABBITMQ_DEFAULT_USER<span style="color:#f92672">=</span>itcast <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-e RABBITMQ_DEFAULT_PASS<span style="color:#f92672">=</span><span style="color:#ae81ff">123321</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--name mq4 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--hostname mq5 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-p 8074:15672 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-p 8084:15672 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>rabbitmq:3.8-management
</span></span></code></pre></div><p>2ï¼‰è¿›å…¥å®¹å™¨æ§åˆ¶å°ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>docker exec -it mq4 bash
</span></span></code></pre></div><p>3ï¼‰åœæ­¢mqè¿›ç¨‹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>rabbitmqctl stop_app
</span></span></code></pre></div><p>4ï¼‰é‡ç½®RabbitMQä¸­çš„æ•°æ®ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>rabbitmqctl reset
</span></span></code></pre></div><p>5ï¼‰åŠ å…¥mq1ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>rabbitmqctl join_cluster rabbit@mq1
</span></span></code></pre></div><p>6ï¼‰å†æ¬¡å¯åŠ¨mqè¿›ç¨‹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>rabbitmqctl start_app
</span></span></code></pre></div><p><img loading="lazy" src="assets/image-20210718001909492.png" alt="image-20210718001909492"  />
</p>
<h3 id="532å¢åŠ ä»²è£é˜Ÿåˆ—å‰¯æœ¬">5.3.2.å¢åŠ ä»²è£é˜Ÿåˆ—å‰¯æœ¬<a hidden class="anchor" aria-hidden="true" href="#532å¢åŠ ä»²è£é˜Ÿåˆ—å‰¯æœ¬">#</a></h3>
<p>æˆ‘ä»¬å…ˆæŸ¥çœ‹ä¸‹quorum.queueè¿™ä¸ªé˜Ÿåˆ—ç›®å‰çš„å‰¯æœ¬æƒ…å†µï¼Œè¿›å…¥mq1å®¹å™¨ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>docker exec -it mq1 bash
</span></span></code></pre></div><p>æ‰§è¡Œå‘½ä»¤ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>rabbitmq-queues quorum_status <span style="color:#e6db74">&#34;quorum.queue&#34;</span>
</span></span></code></pre></div><p>ç»“æœï¼š</p>
<p><img loading="lazy" src="assets/image-20210718002118357.png" alt="image-20210718002118357"  />
</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬è®©mq4ä¹ŸåŠ å…¥è¿›æ¥ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>rabbitmq-queues add_member <span style="color:#e6db74">&#34;quorum.queue&#34;</span> <span style="color:#e6db74">&#34;rabbit@mq4&#34;</span>
</span></span></code></pre></div><p>ç»“æœï¼š</p>
<p><img loading="lazy" src="assets/image-20210718002253226.png" alt="image-20210718002253226"  />
</p>
<p>å†æ¬¡æŸ¥çœ‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>rabbitmq-queues quorum_status <span style="color:#e6db74">&#34;quorum.queue&#34;</span>
</span></span></code></pre></div><p><img loading="lazy" src="assets/image-20210718002342603.png" alt="image-20210718002342603"  />
</p>
<p>æŸ¥çœ‹æ§åˆ¶å°ï¼Œå‘ç°quorum.queueçš„é•œåƒæ•°é‡ä¹Ÿä»åŸæ¥çš„ +2 å˜æˆäº† +3ï¼š</p>
<p><img loading="lazy" src="assets/image-20210718002422365.png" alt="image-20210718002422365"  />
</p>


        </div>

        <footer class="post-footer">
            
<nav class="paginav">
  <a class="prev" href="https://XianCH.github.io/posts/tech/distributed/springcloud/">
    <span class="title">Â« ä¸Šä¸€é¡µ</span>
    <br>
    <span>springcloud</span>
  </a>
  <a class="next" href="https://XianCH.github.io/posts/tech/distributed/rabbitmq-2/">
    <span class="title">ä¸‹ä¸€é¡µ Â»</span>
    <br>
    <span>RabbitMq-2</span>
  </a>
</nav>

        </footer>
    </div>

<style>
    .comments_details summary::marker {
        font-size: 20px;
        content: 'ğŸ‘‰å±•å¼€è¯„è®º';
        color: var(--content);
    }
    .comments_details[open] summary::marker{
        font-size: 20px;
        content: 'ğŸ‘‡å…³é—­è¯„è®º';
        color: var(--content);
    }
</style>


<div>
    <details class="comments_details">
        <summary style="cursor: pointer; margin: 50px 0 20px 0;width: 130px;">
            <span style="font-size: 20px;color: var(--content);">...</span>
        </summary>
        <div id="tcomment"></div>
    </details>
    <script src="https://cdn.staticfile.org/twikoo/1.5.8/twikoo.all.min.js">
    </script>
    <script>
        twikoo.init({
            envId:  null ,
        el: "#tcomment",
            lang: 'zh-CN',
            region:  null ,
        path: window.TWIKOO_MAGIC_PATH||window.location.pathname,
        })
    </script>
</div>
</article>
</main>

<footer class="footer">
    <span>
        Copyright
        &copy;
        -2024
        <a href="https://XianCH.github.io/" style="color:#939393;">X14n&#39;s Blog</a>
        All Rights Reserved
    </span>
    <a href="https://beian.miit.gov.cn/" target="_blank" style="color:#939393;"></a>&nbsp;
    <span>
        <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=null"
           style="display:inline-block;text-decoration:none;height:20px;color:#939393;">
            <img src="" style="float:left;margin: 0px 5px 0px 0px;"/>
            
        </a>
    </span>
    <span id="busuanzi_container">
        <span class="fa fa-user"></span> <span id="busuanzi_value_site_uv"></span>
        <span class="fa fa-eye"></span> <span id="busuanzi_value_site_pv"></span>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <span class="topInner">
        <svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z"/>
        </svg>
        <span id="read_progress"></span>
    </span>
</a>

<script>
    document.addEventListener('scroll', function (e) {
        const readProgress = document.getElementById("read_progress");
        const scrollHeight = document.documentElement.scrollHeight;
        const clientHeight = document.documentElement.clientHeight;
        const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
        readProgress.innerText = ((scrollTop / (scrollHeight - clientHeight)).toFixed(2) * 100).toFixed(0);
    })
</script>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });
</script>
<script>
    let mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };
</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        (function() {
            document.cookie = "change-themes" + "="+ escape ("false");
        })()

        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    });
</script>

<script>
    document.body.addEventListener('copy', function (e) {
        if (window.getSelection().toString() && window.getSelection().toString().length > 50) {
            let clipboardData = e.clipboardData || window.clipboardData;
            if (clipboardData) {
                e.preventDefault();
                let htmlData = window.getSelection().toString() +
                    '\r\n\nâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r\n' +
                    'ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œ'+"X14n's Blog"+'ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚' +
                '\r\nåŸæ–‡é“¾æ¥ï¼š' + location.href;
                let textData = window.getSelection().toString() +
                    '\r\n\nâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r\n' +
                    'ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œ'+"X14n's Blog"+'ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚' +
                '\r\nåŸæ–‡é“¾æ¥ï¼š' + location.href;
                clipboardData.setData('text/html', htmlData);
                clipboardData.setData('text/plain', textData);
            }
        }
    });
</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;
        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'å¤åˆ¶';

        function copyingDone() {
            copybutton.innerText = 'å·²å¤åˆ¶ï¼';
            setTimeout(() => {
                copybutton.innerText = 'å¤åˆ¶';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                let text = codeblock.textContent +
                    '\r\nâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r\n' +
                    'ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œ'+"X14n's Blog"+'ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚' +
                '\r\nåŸæ–‡é“¾æ¥ï¼š' + location.href;
                navigator.clipboard.writeText(text);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) {}
            selection.removeRange(range);
        });

        let language = codeblock.className.replaceAll("language-", "")
        let macTool = document.createElement("div")
        let macTool1 = document.createElement("div")
        let macTool2 = document.createElement("div")
        let macTool3 = document.createElement("div")
        let languageType = document.createElement("div")
        languageType.innerText = language
        macTool.setAttribute('class', 'mac-tool')
        macTool1.setAttribute('class', 'mac bb1')
        macTool2.setAttribute('class', 'mac bb2')
        macTool3.setAttribute('class', 'mac bb3')
        languageType.setAttribute('class', 'language-type')
        macTool.appendChild(macTool1)
        macTool.appendChild(macTool2)
        macTool.appendChild(macTool3)
        macTool.appendChild(languageType)

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
            container.appendChild(macTool)
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
            container.appendChild(macTool)
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
            container.appendChild(macTool)
        }
    });
</script>
</body>

</html>
