<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>springcloud | X14n&#39;s Blog</title>
<meta name="keywords" content="">
<meta name="description" content="springcloudå­¦ä¹ ">
<meta name="author" content="x14n">
<link rel="canonical" href="https://XianCH.github.io/posts/tech/distributed/springcloud/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.css" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.js" onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://XianCH.github.io/img/favicon.icon">
<link rel="icon" type="image/png" sizes="16x16" href="https://XianCH.github.io/img/main.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://XianCH.github.io/img/main.png">
<link rel="apple-touch-icon" href="https://XianCH.github.io/img/main.png">
<link rel="mask-icon" href="https://XianCH.github.io/img/main.png">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh" href="https://XianCH.github.io/posts/tech/distributed/springcloud/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>
<script defer src="https://unpkg.com/mermaid@8.8.1/dist/mermaid.min.js"></script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
<script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.min.js"></script>



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = ""; 
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

  

<meta property="og:title" content="springcloud" />
<meta property="og:description" content="springcloudå­¦ä¹ " />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://XianCH.github.io/posts/tech/distributed/springcloud/" />
<meta property="og:image" content="https://XianCH.github.io/postsImg/springcloud.png" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-12-22T10:16:51+00:00" />
<meta property="article:modified_time" content="2023-09-22T10:16:51+00:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://XianCH.github.io/postsImg/springcloud.png" />
<meta name="twitter:title" content="springcloud"/>
<meta name="twitter:description" content="springcloudå­¦ä¹ "/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [

        {
          "@type": "ListItem",
          "position":  1 ,
          "name": "Post",
          "item": "https://XianCH.github.io/posts/"
        },

        {
          "@type": "ListItem",
          "position":  2 ,
          "name": "Tech",
          "item": "https://XianCH.github.io/posts/tech/"
        }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "springcloud",
      "item": "https://XianCH.github.io/posts/tech/distributed/springcloud/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "springcloud",
  "name": "springcloud",
  "description": "springcloudå­¦ä¹ ",
  "keywords": [
    ""
  ],
  "articleBody": "1.Nacosé…ç½®ç®¡ç† Nacosé™¤äº†å¯ä»¥åšæ³¨å†Œä¸­å¿ƒï¼ŒåŒæ ·å¯ä»¥åšé…ç½®ç®¡ç†æ¥ä½¿ç”¨ã€‚\n1.1.ç»Ÿä¸€é…ç½®ç®¡ç† å½“å¾®æœåŠ¡éƒ¨ç½²çš„å®ä¾‹è¶Šæ¥è¶Šå¤šï¼Œè¾¾åˆ°æ•°åã€æ•°ç™¾æ—¶ï¼Œé€ä¸ªä¿®æ”¹å¾®æœåŠ¡é…ç½®å°±ä¼šè®©äººæŠ“ç‹‚ï¼Œè€Œä¸”å¾ˆå®¹æ˜“å‡ºé”™ã€‚æˆ‘ä»¬éœ€è¦ä¸€ç§ç»Ÿä¸€é…ç½®ç®¡ç†æ–¹æ¡ˆï¼Œå¯ä»¥é›†ä¸­ç®¡ç†æ‰€æœ‰å®ä¾‹çš„é…ç½®ã€‚\nNacosä¸€æ–¹é¢å¯ä»¥å°†é…ç½®é›†ä¸­ç®¡ç†ï¼Œå¦ä¸€æ–¹å¯ä»¥åœ¨é…ç½®å˜æ›´æ—¶ï¼ŒåŠæ—¶é€šçŸ¥å¾®æœåŠ¡ï¼Œå®ç°é…ç½®çš„çƒ­æ›´æ–°ã€‚\n1.1.1.åœ¨nacosä¸­æ·»åŠ é…ç½®æ–‡ä»¶ å¦‚ä½•åœ¨nacosä¸­ç®¡ç†é…ç½®å‘¢ï¼Ÿ\nç„¶ååœ¨å¼¹å‡ºçš„è¡¨å•ä¸­ï¼Œå¡«å†™é…ç½®ä¿¡æ¯ï¼š\næ³¨æ„ï¼šé¡¹ç›®çš„æ ¸å¿ƒé…ç½®ï¼Œéœ€è¦çƒ­æ›´æ–°çš„é…ç½®æ‰æœ‰æ”¾åˆ°nacosç®¡ç†çš„å¿…è¦ã€‚åŸºæœ¬ä¸ä¼šå˜æ›´çš„ä¸€äº›é…ç½®è¿˜æ˜¯ä¿å­˜åœ¨å¾®æœåŠ¡æœ¬åœ°æ¯”è¾ƒå¥½ã€‚\n1.1.2.ä»å¾®æœåŠ¡æ‹‰å–é…ç½® å¾®æœåŠ¡è¦æ‹‰å–nacosä¸­ç®¡ç†çš„é…ç½®ï¼Œå¹¶ä¸”ä¸æœ¬åœ°çš„application.ymlé…ç½®åˆå¹¶ï¼Œæ‰èƒ½å®Œæˆé¡¹ç›®å¯åŠ¨ã€‚\nä½†å¦‚æœå°šæœªè¯»å–application.ymlï¼Œåˆå¦‚ä½•å¾—çŸ¥nacosåœ°å€å‘¢ï¼Ÿ\nå› æ­¤springå¼•å…¥äº†ä¸€ç§æ–°çš„é…ç½®æ–‡ä»¶ï¼šbootstrap.yamlæ–‡ä»¶ï¼Œä¼šåœ¨application.ymlä¹‹å‰è¢«è¯»å–ï¼Œæµç¨‹å¦‚ä¸‹ï¼š\n1ï¼‰å¼•å…¥nacos-configä¾èµ–\né¦–å…ˆï¼Œåœ¨user-serviceæœåŠ¡ä¸­ï¼Œå¼•å…¥nacos-configçš„å®¢æˆ·ç«¯ä¾èµ–ï¼š\ncom.alibaba.cloud spring-cloud-starter-alibaba-nacos-config 2ï¼‰æ·»åŠ bootstrap.yaml\nç„¶åï¼Œåœ¨user-serviceä¸­æ·»åŠ ä¸€ä¸ªbootstrap.yamlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\nspring: application: name: userservice # æœåŠ¡åç§° profiles: active: dev #å¼€å‘ç¯å¢ƒï¼Œè¿™é‡Œæ˜¯dev cloud: nacos: server-addr: localhost:8848 # Nacosåœ°å€ config: file-extension: yaml # æ–‡ä»¶åç¼€å è¿™é‡Œä¼šæ ¹æ®spring.cloud.nacos.server-addrè·å–nacosåœ°å€ï¼Œå†æ ¹æ®\n${spring.application.name}-${spring.profiles.active}.${spring.cloud.nacos.config.file-extension}ä½œä¸ºæ–‡ä»¶idï¼Œæ¥è¯»å–é…ç½®ã€‚\næœ¬ä¾‹ä¸­ï¼Œå°±æ˜¯å»è¯»å–userservice-dev.yamlï¼š\n3ï¼‰è¯»å–nacosé…ç½®\nåœ¨user-serviceä¸­çš„UserControllerä¸­æ·»åŠ ä¸šåŠ¡é€»è¾‘ï¼Œè¯»å–pattern.dateformaté…ç½®ï¼š\nå®Œæ•´ä»£ç ï¼š\npackage cn.itcast.user.web; import cn.itcast.user.pojo.User; import cn.itcast.user.service.UserService; import lombok.extern.slf4j.Slf4j; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.beans.factory.annotation.Value; import org.springframework.web.bind.annotation.*; import java.time.LocalDateTime; import java.time.format.DateTimeFormatter; @Slf4j @RestController @RequestMapping(\"/user\") public class UserController { @Autowired private UserService userService; @Value(\"${pattern.dateformat}\") private String dateformat; @GetMapping(\"now\") public String now(){ return LocalDateTime.now().format(DateTimeFormatter.ofPattern(dateformat)); } // ...ç•¥ } åœ¨é¡µé¢è®¿é—®ï¼Œå¯ä»¥çœ‹åˆ°æ•ˆæœï¼š\n1.2.é…ç½®çƒ­æ›´æ–° æˆ‘ä»¬æœ€ç»ˆçš„ç›®çš„ï¼Œæ˜¯ä¿®æ”¹nacosä¸­çš„é…ç½®åï¼Œå¾®æœåŠ¡ä¸­æ— éœ€é‡å¯å³å¯è®©é…ç½®ç”Ÿæ•ˆï¼Œä¹Ÿå°±æ˜¯é…ç½®çƒ­æ›´æ–°ã€‚\nè¦å®ç°é…ç½®çƒ­æ›´æ–°ï¼Œå¯ä»¥ä½¿ç”¨ä¸¤ç§æ–¹å¼ï¼š\n1.2.1.æ–¹å¼ä¸€ åœ¨@Valueæ³¨å…¥çš„å˜é‡æ‰€åœ¨ç±»ä¸Šæ·»åŠ æ³¨è§£@RefreshScopeï¼š\n1.2.2.æ–¹å¼äºŒ ä½¿ç”¨@ConfigurationPropertiesæ³¨è§£ä»£æ›¿@Valueæ³¨è§£ã€‚\nåœ¨user-serviceæœåŠ¡ä¸­ï¼Œæ·»åŠ ä¸€ä¸ªç±»ï¼Œè¯»å–patterrn.dateformatå±æ€§ï¼š\npackage cn.itcast.user.config; import lombok.Data; import org.springframework.boot.context.properties.ConfigurationProperties; import org.springframework.stereotype.Component; @Component @Data @ConfigurationProperties(prefix = \"pattern\") public class PatternProperties { private String dateformat; } åœ¨UserControllerä¸­ä½¿ç”¨è¿™ä¸ªç±»ä»£æ›¿@Valueï¼š\nå®Œæ•´ä»£ç ï¼š\npackage cn.itcast.user.web; import cn.itcast.user.config.PatternProperties; import cn.itcast.user.pojo.User; import cn.itcast.user.service.UserService; import lombok.extern.slf4j.Slf4j; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.PathVariable; import org.springframework.web.bind.annotation.RequestMapping; import org.springframework.web.bind.annotation.RestController; import java.time.LocalDateTime; import java.time.format.DateTimeFormatter; @Slf4j @RestController @RequestMapping(\"/user\") public class UserController { @Autowired private UserService userService; @Autowired private PatternProperties patternProperties; @GetMapping(\"now\") public String now(){ return LocalDateTime.now().format(DateTimeFormatter.ofPattern(patternProperties.getDateformat())); } // ç•¥ } 1.3.é…ç½®å…±äº« å…¶å®å¾®æœåŠ¡å¯åŠ¨æ—¶ï¼Œä¼šå»nacosè¯»å–å¤šä¸ªé…ç½®æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼š\n[spring.application.name]-[spring.profiles.active].yamlï¼Œä¾‹å¦‚ï¼šuserservice-dev.yaml\n[spring.application.name].yamlï¼Œä¾‹å¦‚ï¼šuserservice.yaml\nè€Œ[spring.application.name].yamlä¸åŒ…å«ç¯å¢ƒï¼Œå› æ­¤å¯ä»¥è¢«å¤šä¸ªç¯å¢ƒå…±äº«ã€‚\nä¸‹é¢æˆ‘ä»¬é€šè¿‡æ¡ˆä¾‹æ¥æµ‹è¯•é…ç½®å…±äº«\n1ï¼‰æ·»åŠ ä¸€ä¸ªç¯å¢ƒå…±äº«é…ç½® æˆ‘ä»¬åœ¨nacosä¸­æ·»åŠ ä¸€ä¸ªuserservice.yamlæ–‡ä»¶ï¼š\n2ï¼‰åœ¨user-serviceä¸­è¯»å–å…±äº«é…ç½® åœ¨user-serviceæœåŠ¡ä¸­ï¼Œä¿®æ”¹PatternPropertiesç±»ï¼Œè¯»å–æ–°æ·»åŠ çš„å±æ€§ï¼š\nåœ¨user-serviceæœåŠ¡ä¸­ï¼Œä¿®æ”¹UserControllerï¼Œæ·»åŠ ä¸€ä¸ªæ–¹æ³•ï¼š\n3ï¼‰è¿è¡Œä¸¤ä¸ªUserApplicationï¼Œä½¿ç”¨ä¸åŒçš„profile ä¿®æ”¹UserApplication2è¿™ä¸ªå¯åŠ¨é¡¹ï¼Œæ”¹å˜å…¶profileå€¼ï¼š\nè¿™æ ·ï¼ŒUserApplication(8081)ä½¿ç”¨çš„profileæ˜¯devï¼ŒUserApplication2(8082)ä½¿ç”¨çš„profileæ˜¯testã€‚\nå¯åŠ¨UserApplicationå’ŒUserApplication2\nè®¿é—®http://localhost:8081/user/propï¼Œç»“æœï¼š\nè®¿é—®http://localhost:8082/user/propï¼Œç»“æœï¼š\nå¯ä»¥çœ‹å‡ºæ¥ï¼Œä¸ç®¡æ˜¯devï¼Œè¿˜æ˜¯testç¯å¢ƒï¼Œéƒ½è¯»å–åˆ°äº†envSharedValueè¿™ä¸ªå±æ€§çš„å€¼ã€‚\n4ï¼‰é…ç½®å…±äº«çš„ä¼˜å…ˆçº§ å½“nacosã€æœåŠ¡æœ¬åœ°åŒæ—¶å‡ºç°ç›¸åŒå±æ€§æ—¶ï¼Œä¼˜å…ˆçº§æœ‰é«˜ä½ä¹‹åˆ†ï¼š\n1.4.æ­å»ºNacosé›†ç¾¤ Nacosç”Ÿäº§ç¯å¢ƒä¸‹ä¸€å®šè¦éƒ¨ç½²ä¸ºé›†ç¾¤çŠ¶æ€ï¼Œéƒ¨ç½²æ–¹å¼å‚è€ƒè¯¾å‰èµ„æ–™ä¸­çš„æ–‡æ¡£ï¼š\n2.Feignè¿œç¨‹è°ƒç”¨ å…ˆæ¥çœ‹æˆ‘ä»¬ä»¥å‰åˆ©ç”¨RestTemplateå‘èµ·è¿œç¨‹è°ƒç”¨çš„ä»£ç ï¼š\nå­˜åœ¨ä¸‹é¢çš„é—®é¢˜ï¼š\nâ€¢ä»£ç å¯è¯»æ€§å·®ï¼Œç¼–ç¨‹ä½“éªŒä¸ç»Ÿä¸€\nâ€¢å‚æ•°å¤æ‚URLéš¾ä»¥ç»´æŠ¤\nFeignæ˜¯ä¸€ä¸ªå£°æ˜å¼çš„httpå®¢æˆ·ç«¯ï¼Œå®˜æ–¹åœ°å€ï¼šhttps://github.com/OpenFeign/feign\nå…¶ä½œç”¨å°±æ˜¯å¸®åŠ©æˆ‘ä»¬ä¼˜é›…çš„å®ç°httpè¯·æ±‚çš„å‘é€ï¼Œè§£å†³ä¸Šé¢æåˆ°çš„é—®é¢˜ã€‚\n2.1.Feignæ›¿ä»£RestTemplate Feginçš„ä½¿ç”¨æ­¥éª¤å¦‚ä¸‹ï¼š\n1ï¼‰å¼•å…¥ä¾èµ– æˆ‘ä»¬åœ¨order-serviceæœåŠ¡çš„pomæ–‡ä»¶ä¸­å¼•å…¥feignçš„ä¾èµ–ï¼š\norg.springframework.cloud spring-cloud-starter-openfeign 2ï¼‰æ·»åŠ æ³¨è§£ åœ¨order-serviceçš„å¯åŠ¨ç±»æ·»åŠ æ³¨è§£å¼€å¯Feignçš„åŠŸèƒ½ï¼š\n3ï¼‰ç¼–å†™Feignçš„å®¢æˆ·ç«¯ åœ¨order-serviceä¸­æ–°å»ºä¸€ä¸ªæ¥å£ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\npackage cn.itcast.order.client; import cn.itcast.order.pojo.User; import org.springframework.cloud.openfeign.FeignClient; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.PathVariable; @FeignClient(\"userservice\") public interface UserClient { @GetMapping(\"/user/{id}\") User findById(@PathVariable(\"id\") Long id); } è¿™ä¸ªå®¢æˆ·ç«¯ä¸»è¦æ˜¯åŸºäºSpringMVCçš„æ³¨è§£æ¥å£°æ˜è¿œç¨‹è°ƒç”¨çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼š\næœåŠ¡åç§°ï¼šuserservice è¯·æ±‚æ–¹å¼ï¼šGET è¯·æ±‚è·¯å¾„ï¼š/user/{id} è¯·æ±‚å‚æ•°ï¼šLong id è¿”å›å€¼ç±»å‹ï¼šUser è¿™æ ·ï¼ŒFeignå°±å¯ä»¥å¸®åŠ©æˆ‘ä»¬å‘é€httpè¯·æ±‚ï¼Œæ— éœ€è‡ªå·±ä½¿ç”¨RestTemplateæ¥å‘é€äº†ã€‚\n4ï¼‰æµ‹è¯• ä¿®æ”¹order-serviceä¸­çš„OrderServiceç±»ä¸­çš„queryOrderByIdæ–¹æ³•ï¼Œä½¿ç”¨Feignå®¢æˆ·ç«¯ä»£æ›¿RestTemplateï¼š\næ˜¯ä¸æ˜¯çœ‹èµ·æ¥ä¼˜é›…å¤šäº†ã€‚\n5ï¼‰æ€»ç»“ ä½¿ç”¨Feignçš„æ­¥éª¤ï¼š\nâ‘  å¼•å…¥ä¾èµ–\nâ‘¡ æ·»åŠ @EnableFeignClientsæ³¨è§£\nâ‘¢ ç¼–å†™FeignClientæ¥å£\nâ‘£ ä½¿ç”¨FeignClientä¸­å®šä¹‰çš„æ–¹æ³•ä»£æ›¿RestTemplate\n2.2.è‡ªå®šä¹‰é…ç½® Feignå¯ä»¥æ”¯æŒå¾ˆå¤šçš„è‡ªå®šä¹‰é…ç½®ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š\nç±»å‹ ä½œç”¨ è¯´æ˜ feign.Logger.Level ä¿®æ”¹æ—¥å¿—çº§åˆ« åŒ…å«å››ç§ä¸åŒçš„çº§åˆ«ï¼šNONEã€BASICã€HEADERSã€FULL feign.codec.Decoder å“åº”ç»“æœçš„è§£æå™¨ httpè¿œç¨‹è°ƒç”¨çš„ç»“æœåšè§£æï¼Œä¾‹å¦‚è§£æjsonå­—ç¬¦ä¸²ä¸ºjavaå¯¹è±¡ feign.codec.Encoder è¯·æ±‚å‚æ•°ç¼–ç  å°†è¯·æ±‚å‚æ•°ç¼–ç ï¼Œä¾¿äºé€šè¿‡httpè¯·æ±‚å‘é€ feign. Contract æ”¯æŒçš„æ³¨è§£æ ¼å¼ é»˜è®¤æ˜¯SpringMVCçš„æ³¨è§£ feign. Retryer å¤±è´¥é‡è¯•æœºåˆ¶ è¯·æ±‚å¤±è´¥çš„é‡è¯•æœºåˆ¶ï¼Œé»˜è®¤æ˜¯æ²¡æœ‰ï¼Œä¸è¿‡ä¼šä½¿ç”¨Ribbonçš„é‡è¯• ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œé»˜è®¤å€¼å°±èƒ½æ»¡è¶³æˆ‘ä»¬ä½¿ç”¨ï¼Œå¦‚æœè¦è‡ªå®šä¹‰æ—¶ï¼Œåªéœ€è¦åˆ›å»ºè‡ªå®šä¹‰çš„@Beanè¦†ç›–é»˜è®¤Beanå³å¯ã€‚\nä¸‹é¢ä»¥æ—¥å¿—ä¸ºä¾‹æ¥æ¼”ç¤ºå¦‚ä½•è‡ªå®šä¹‰é…ç½®ã€‚\n2.2.1.é…ç½®æ–‡ä»¶æ–¹å¼ åŸºäºé…ç½®æ–‡ä»¶ä¿®æ”¹feignçš„æ—¥å¿—çº§åˆ«å¯ä»¥é’ˆå¯¹å•ä¸ªæœåŠ¡ï¼š\nfeign: client: config: userservice: # é’ˆå¯¹æŸä¸ªå¾®æœåŠ¡çš„é…ç½® loggerLevel: FULL # æ—¥å¿—çº§åˆ« ä¹Ÿå¯ä»¥é’ˆå¯¹æ‰€æœ‰æœåŠ¡ï¼š\nfeign: client: config: default: # è¿™é‡Œç”¨defaultå°±æ˜¯å…¨å±€é…ç½®ï¼Œå¦‚æœæ˜¯å†™æœåŠ¡åç§°ï¼Œåˆ™æ˜¯é’ˆå¯¹æŸä¸ªå¾®æœåŠ¡çš„é…ç½® loggerLevel: FULL # æ—¥å¿—çº§åˆ« è€Œæ—¥å¿—çš„çº§åˆ«åˆ†ä¸ºå››ç§ï¼š\nNONEï¼šä¸è®°å½•ä»»ä½•æ—¥å¿—ä¿¡æ¯ï¼Œè¿™æ˜¯é»˜è®¤å€¼ã€‚ BASICï¼šä»…è®°å½•è¯·æ±‚çš„æ–¹æ³•ï¼ŒURLä»¥åŠå“åº”çŠ¶æ€ç å’Œæ‰§è¡Œæ—¶é—´ HEADERSï¼šåœ¨BASICçš„åŸºç¡€ä¸Šï¼Œé¢å¤–è®°å½•äº†è¯·æ±‚å’Œå“åº”çš„å¤´ä¿¡æ¯ FULLï¼šè®°å½•æ‰€æœ‰è¯·æ±‚å’Œå“åº”çš„æ˜ç»†ï¼ŒåŒ…æ‹¬å¤´ä¿¡æ¯ã€è¯·æ±‚ä½“ã€å…ƒæ•°æ®ã€‚ 2.2.2.Javaä»£ç æ–¹å¼ ä¹Ÿå¯ä»¥åŸºäºJavaä»£ç æ¥ä¿®æ”¹æ—¥å¿—çº§åˆ«ï¼Œå…ˆå£°æ˜ä¸€ä¸ªç±»ï¼Œç„¶åå£°æ˜ä¸€ä¸ªLogger.Levelçš„å¯¹è±¡ï¼š\npublic class DefaultFeignConfiguration { @Bean public Logger.Level feignLogLevel(){ return Logger.Level.BASIC; // æ—¥å¿—çº§åˆ«ä¸ºBASIC } } å¦‚æœè¦å…¨å±€ç”Ÿæ•ˆï¼Œå°†å…¶æ”¾åˆ°å¯åŠ¨ç±»çš„@EnableFeignClientsè¿™ä¸ªæ³¨è§£ä¸­ï¼š\n@EnableFeignClients(defaultConfiguration = DefaultFeignConfiguration .class) å¦‚æœæ˜¯å±€éƒ¨ç”Ÿæ•ˆï¼Œåˆ™æŠŠå®ƒæ”¾åˆ°å¯¹åº”çš„@FeignClientè¿™ä¸ªæ³¨è§£ä¸­ï¼š\n@FeignClient(value = \"userservice\", configuration = DefaultFeignConfiguration .class) 2.3.Feignä½¿ç”¨ä¼˜åŒ– Feignåº•å±‚å‘èµ·httpè¯·æ±‚ï¼Œä¾èµ–äºå…¶å®ƒçš„æ¡†æ¶ã€‚å…¶åº•å±‚å®¢æˆ·ç«¯å®ç°åŒ…æ‹¬ï¼š\nâ€¢URLConnectionï¼šé»˜è®¤å®ç°ï¼Œä¸æ”¯æŒè¿æ¥æ± \nâ€¢Apache HttpClient ï¼šæ”¯æŒè¿æ¥æ± \nâ€¢OKHttpï¼šæ”¯æŒè¿æ¥æ± \nå› æ­¤æé«˜Feignçš„æ€§èƒ½ä¸»è¦æ‰‹æ®µå°±æ˜¯ä½¿ç”¨è¿æ¥æ± ä»£æ›¿é»˜è®¤çš„URLConnectionã€‚\nè¿™é‡Œæˆ‘ä»¬ç”¨Apacheçš„HttpClientæ¥æ¼”ç¤ºã€‚\n1ï¼‰å¼•å…¥ä¾èµ–\nåœ¨order-serviceçš„pomæ–‡ä»¶ä¸­å¼•å…¥Apacheçš„HttpClientä¾èµ–ï¼š\nio.github.openfeign feign-httpclient 2ï¼‰é…ç½®è¿æ¥æ± \nåœ¨order-serviceçš„application.ymlä¸­æ·»åŠ é…ç½®ï¼š\nfeign: client: config: default: # defaultå…¨å±€çš„é…ç½® loggerLevel: BASIC # æ—¥å¿—çº§åˆ«ï¼ŒBASICå°±æ˜¯åŸºæœ¬çš„è¯·æ±‚å’Œå“åº”ä¿¡æ¯ httpclient: enabled: true # å¼€å¯feignå¯¹HttpClientçš„æ”¯æŒ max-connections: 200 # æœ€å¤§çš„è¿æ¥æ•° max-connections-per-route: 50 # æ¯ä¸ªè·¯å¾„çš„æœ€å¤§è¿æ¥æ•° æ¥ä¸‹æ¥ï¼Œåœ¨FeignClientFactoryBeanä¸­çš„loadBalanceæ–¹æ³•ä¸­æ‰“æ–­ç‚¹ï¼š\nDebugæ–¹å¼å¯åŠ¨order-serviceæœåŠ¡ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œçš„clientï¼Œåº•å±‚å°±æ˜¯Apache HttpClientï¼š\næ€»ç»“ï¼ŒFeignçš„ä¼˜åŒ–ï¼š\n1.æ—¥å¿—çº§åˆ«å°½é‡ç”¨basic\n2.ä½¿ç”¨HttpClientæˆ–OKHttpä»£æ›¿URLConnection\nâ‘  å¼•å…¥feign-httpClientä¾èµ–\nâ‘¡ é…ç½®æ–‡ä»¶å¼€å¯httpClientåŠŸèƒ½ï¼Œè®¾ç½®è¿æ¥æ± å‚æ•°\n2.4.æœ€ä½³å®è·µ æ‰€è°“æœ€è¿‘å®è·µï¼Œå°±æ˜¯ä½¿ç”¨è¿‡ç¨‹ä¸­æ€»ç»“çš„ç»éªŒï¼Œæœ€å¥½çš„ä¸€ç§ä½¿ç”¨æ–¹å¼ã€‚\nè‡ªä¹ è§‚å¯Ÿå¯ä»¥å‘ç°ï¼ŒFeignçš„å®¢æˆ·ç«¯ä¸æœåŠ¡æä¾›è€…çš„controllerä»£ç éå¸¸ç›¸ä¼¼ï¼š\nfeignå®¢æˆ·ç«¯ï¼š\nUserControllerï¼š\næœ‰æ²¡æœ‰ä¸€ç§åŠæ³•ç®€åŒ–è¿™ç§é‡å¤çš„ä»£ç ç¼–å†™å‘¢ï¼Ÿ\n2.4.1.ç»§æ‰¿æ–¹å¼ ä¸€æ ·çš„ä»£ç å¯ä»¥é€šè¿‡ç»§æ‰¿æ¥å…±äº«ï¼š\n1ï¼‰å®šä¹‰ä¸€ä¸ªAPIæ¥å£ï¼Œåˆ©ç”¨å®šä¹‰æ–¹æ³•ï¼Œå¹¶åŸºäºSpringMVCæ³¨è§£åšå£°æ˜ã€‚\n2ï¼‰Feignå®¢æˆ·ç«¯å’ŒControlleréƒ½é›†æˆæ”¹æ¥å£\nä¼˜ç‚¹ï¼š\nç®€å• å®ç°äº†ä»£ç å…±äº« ç¼ºç‚¹ï¼š\næœåŠ¡æä¾›æ–¹ã€æœåŠ¡æ¶ˆè´¹æ–¹ç´§è€¦åˆ\nå‚æ•°åˆ—è¡¨ä¸­çš„æ³¨è§£æ˜ å°„å¹¶ä¸ä¼šç»§æ‰¿ï¼Œå› æ­¤Controllerä¸­å¿…é¡»å†æ¬¡å£°æ˜æ–¹æ³•ã€å‚æ•°åˆ—è¡¨ã€æ³¨è§£\n2.4.2.æŠ½å–æ–¹å¼ å°†Feignçš„ClientæŠ½å–ä¸ºç‹¬ç«‹æ¨¡å—ï¼Œå¹¶ä¸”æŠŠæ¥å£æœ‰å…³çš„POJOã€é»˜è®¤çš„Feigné…ç½®éƒ½æ”¾åˆ°è¿™ä¸ªæ¨¡å—ä¸­ï¼Œæä¾›ç»™æ‰€æœ‰æ¶ˆè´¹è€…ä½¿ç”¨ã€‚\nä¾‹å¦‚ï¼Œå°†UserClientã€Userã€Feignçš„é»˜è®¤é…ç½®éƒ½æŠ½å–åˆ°ä¸€ä¸ªfeign-apiåŒ…ä¸­ï¼Œæ‰€æœ‰å¾®æœåŠ¡å¼•ç”¨è¯¥ä¾èµ–åŒ…ï¼Œå³å¯ç›´æ¥ä½¿ç”¨ã€‚\n2.4.3.å®ç°åŸºäºæŠ½å–çš„æœ€ä½³å®è·µ 1ï¼‰æŠ½å– é¦–å…ˆåˆ›å»ºä¸€ä¸ªmoduleï¼Œå‘½åä¸ºfeign-apiï¼š\né¡¹ç›®ç»“æ„ï¼š\nåœ¨feign-apiä¸­ç„¶åå¼•å…¥feignçš„starterä¾èµ–\norg.springframework.cloud spring-cloud-starter-openfeign ç„¶åï¼Œorder-serviceä¸­ç¼–å†™çš„UserClientã€Userã€DefaultFeignConfigurationéƒ½å¤åˆ¶åˆ°feign-apié¡¹ç›®ä¸­\n2ï¼‰åœ¨order-serviceä¸­ä½¿ç”¨feign-api é¦–å…ˆï¼Œåˆ é™¤order-serviceä¸­çš„UserClientã€Userã€DefaultFeignConfigurationç­‰ç±»æˆ–æ¥å£ã€‚\nåœ¨order-serviceçš„pomæ–‡ä»¶ä¸­ä¸­å¼•å…¥feign-apiçš„ä¾èµ–ï¼š\ncn.itcast.demo feign-api 1.0 ä¿®æ”¹order-serviceä¸­çš„æ‰€æœ‰ä¸ä¸Šè¿°ä¸‰ä¸ªç»„ä»¶æœ‰å…³çš„å¯¼åŒ…éƒ¨åˆ†ï¼Œæ”¹æˆå¯¼å…¥feign-apiä¸­çš„åŒ…\n3ï¼‰é‡å¯æµ‹è¯• é‡å¯åï¼Œå‘ç°æœåŠ¡æŠ¥é”™äº†ï¼š\nè¿™æ˜¯å› ä¸ºUserClientç°åœ¨åœ¨cn.itcast.feign.clientsåŒ…ä¸‹ï¼Œ\nè€Œorder-serviceçš„@EnableFeignClientsæ³¨è§£æ˜¯åœ¨cn.itcast.orderåŒ…ä¸‹ï¼Œä¸åœ¨åŒä¸€ä¸ªåŒ…ï¼Œæ— æ³•æ‰«æåˆ°UserClientã€‚\n4ï¼‰è§£å†³æ‰«æåŒ…é—®é¢˜ æ–¹å¼ä¸€ï¼š\næŒ‡å®šFeignåº”è¯¥æ‰«æçš„åŒ…ï¼š\n@EnableFeignClients(basePackages = \"cn.itcast.feign.clients\") æ–¹å¼äºŒï¼š\næŒ‡å®šéœ€è¦åŠ è½½çš„Clientæ¥å£ï¼š\n@EnableFeignClients(clients = {UserClient.class}) 3.GatewayæœåŠ¡ç½‘å…³ Spring Cloud Gateway æ˜¯ Spring Cloud çš„ä¸€ä¸ªå…¨æ–°é¡¹ç›®ï¼Œè¯¥é¡¹ç›®æ˜¯åŸºäº Spring 5.0ï¼ŒSpring Boot 2.0 å’Œ Project Reactor ç­‰å“åº”å¼ç¼–ç¨‹å’Œäº‹ä»¶æµæŠ€æœ¯å¼€å‘çš„ç½‘å…³ï¼Œå®ƒæ—¨åœ¨ä¸ºå¾®æœåŠ¡æ¶æ„æä¾›ä¸€ç§ç®€å•æœ‰æ•ˆçš„ç»Ÿä¸€çš„ API è·¯ç”±ç®¡ç†æ–¹å¼ã€‚\n3.1.ä¸ºä»€ä¹ˆéœ€è¦ç½‘å…³ Gatewayç½‘å…³æ˜¯æˆ‘ä»¬æœåŠ¡çš„å®ˆé—¨ç¥ï¼Œæ‰€æœ‰å¾®æœåŠ¡çš„ç»Ÿä¸€å…¥å£ã€‚\nç½‘å…³çš„æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§ï¼š\nè¯·æ±‚è·¯ç”± æƒé™æ§åˆ¶ é™æµ æ¶æ„å›¾ï¼š\næƒé™æ§åˆ¶ï¼šç½‘å…³ä½œä¸ºå¾®æœåŠ¡å…¥å£ï¼Œéœ€è¦æ ¡éªŒç”¨æˆ·æ˜¯æ˜¯å¦æœ‰è¯·æ±‚èµ„æ ¼ï¼Œå¦‚æœæ²¡æœ‰åˆ™è¿›è¡Œæ‹¦æˆªã€‚\nè·¯ç”±å’Œè´Ÿè½½å‡è¡¡ï¼šä¸€åˆ‡è¯·æ±‚éƒ½å¿…é¡»å…ˆç»è¿‡gatewayï¼Œä½†ç½‘å…³ä¸å¤„ç†ä¸šåŠ¡ï¼Œè€Œæ˜¯æ ¹æ®æŸç§è§„åˆ™ï¼ŒæŠŠè¯·æ±‚è½¬å‘åˆ°æŸä¸ªå¾®æœåŠ¡ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åšè·¯ç”±ã€‚å½“ç„¶è·¯ç”±çš„ç›®æ ‡æœåŠ¡æœ‰å¤šä¸ªæ—¶ï¼Œè¿˜éœ€è¦åšè´Ÿè½½å‡è¡¡ã€‚\né™æµï¼šå½“è¯·æ±‚æµé‡è¿‡é«˜æ—¶ï¼Œåœ¨ç½‘å…³ä¸­æŒ‰ç…§ä¸‹æµçš„å¾®æœåŠ¡èƒ½å¤Ÿæ¥å—çš„é€Ÿåº¦æ¥æ”¾è¡Œè¯·æ±‚ï¼Œé¿å…æœåŠ¡å‹åŠ›è¿‡å¤§ã€‚\nåœ¨SpringCloudä¸­ç½‘å…³çš„å®ç°åŒ…æ‹¬ä¸¤ç§ï¼š\ngateway zuul Zuulæ˜¯åŸºäºServletçš„å®ç°ï¼Œå±äºé˜»å¡å¼ç¼–ç¨‹ã€‚è€ŒSpringCloudGatewayåˆ™æ˜¯åŸºäºSpring5ä¸­æä¾›çš„WebFluxï¼Œå±äºå“åº”å¼ç¼–ç¨‹çš„å®ç°ï¼Œå…·å¤‡æ›´å¥½çš„æ€§èƒ½ã€‚\n3.2.gatewayå¿«é€Ÿå…¥é—¨ ä¸‹é¢ï¼Œæˆ‘ä»¬å°±æ¼”ç¤ºä¸‹ç½‘å…³çš„åŸºæœ¬è·¯ç”±åŠŸèƒ½ã€‚åŸºæœ¬æ­¥éª¤å¦‚ä¸‹ï¼š\nåˆ›å»ºSpringBootå·¥ç¨‹gatewayï¼Œå¼•å…¥ç½‘å…³ä¾èµ– ç¼–å†™å¯åŠ¨ç±» ç¼–å†™åŸºç¡€é…ç½®å’Œè·¯ç”±è§„åˆ™ å¯åŠ¨ç½‘å…³æœåŠ¡è¿›è¡Œæµ‹è¯• 1ï¼‰åˆ›å»ºgatewayæœåŠ¡ï¼Œå¼•å…¥ä¾èµ– åˆ›å»ºæœåŠ¡ï¼š\nå¼•å…¥ä¾èµ–ï¼š\norg.springframework.cloud spring-cloud-starter-gateway com.alibaba.cloud spring-cloud-starter-alibaba-nacos-discovery 2ï¼‰ç¼–å†™å¯åŠ¨ç±» package cn.itcast.gateway; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; @SpringBootApplication public class GatewayApplication { public static void main(String[] args) { SpringApplication.run(GatewayApplication.class, args); } } 3ï¼‰ç¼–å†™åŸºç¡€é…ç½®å’Œè·¯ç”±è§„åˆ™ åˆ›å»ºapplication.ymlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\nserver: port: 10010 # ç½‘å…³ç«¯å£ spring: application: name: gateway # æœåŠ¡åç§° cloud: nacos: server-addr: localhost:8848 # nacosåœ°å€ gateway: routes: # ç½‘å…³è·¯ç”±é…ç½® - id: user-service # è·¯ç”±idï¼Œè‡ªå®šä¹‰ï¼Œåªè¦å”¯ä¸€å³å¯ # uri: http://127.0.0.1:8081 # è·¯ç”±çš„ç›®æ ‡åœ°å€ httpå°±æ˜¯å›ºå®šåœ°å€ uri: lb://userservice # è·¯ç”±çš„ç›®æ ‡åœ°å€ lbå°±æ˜¯è´Ÿè½½å‡è¡¡ï¼Œåé¢è·ŸæœåŠ¡åç§° predicates: # è·¯ç”±æ–­è¨€ï¼Œä¹Ÿå°±æ˜¯åˆ¤æ–­è¯·æ±‚æ˜¯å¦ç¬¦åˆè·¯ç”±è§„åˆ™çš„æ¡ä»¶ - Path=/user/** # è¿™ä¸ªæ˜¯æŒ‰ç…§è·¯å¾„åŒ¹é…ï¼Œåªè¦ä»¥/user/å¼€å¤´å°±ç¬¦åˆè¦æ±‚ æˆ‘ä»¬å°†ç¬¦åˆPath è§„åˆ™çš„ä¸€åˆ‡è¯·æ±‚ï¼Œéƒ½ä»£ç†åˆ° uriå‚æ•°æŒ‡å®šçš„åœ°å€ã€‚\næœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å°† /user/**å¼€å¤´çš„è¯·æ±‚ï¼Œä»£ç†åˆ°lb://userserviceï¼Œlbæ˜¯è´Ÿè½½å‡è¡¡ï¼Œæ ¹æ®æœåŠ¡åæ‹‰å–æœåŠ¡åˆ—è¡¨ï¼Œå®ç°è´Ÿè½½å‡è¡¡ã€‚\n4ï¼‰é‡å¯æµ‹è¯• é‡å¯ç½‘å…³ï¼Œè®¿é—®http://localhost:10010/user/1æ—¶ï¼Œç¬¦åˆ/user/**è§„åˆ™ï¼Œè¯·æ±‚è½¬å‘åˆ°uriï¼šhttp://userservice/user/1ï¼Œå¾—åˆ°äº†ç»“æœï¼š\n5ï¼‰ç½‘å…³è·¯ç”±çš„æµç¨‹å›¾ æ•´ä¸ªè®¿é—®çš„æµç¨‹å¦‚ä¸‹ï¼š\næ€»ç»“ï¼š\nç½‘å…³æ­å»ºæ­¥éª¤ï¼š\nåˆ›å»ºé¡¹ç›®ï¼Œå¼•å…¥nacosæœåŠ¡å‘ç°å’Œgatewayä¾èµ–\né…ç½®application.ymlï¼ŒåŒ…æ‹¬æœåŠ¡åŸºæœ¬ä¿¡æ¯ã€nacosåœ°å€ã€è·¯ç”±\nè·¯ç”±é…ç½®åŒ…æ‹¬ï¼š\nè·¯ç”±idï¼šè·¯ç”±çš„å”¯ä¸€æ ‡ç¤º\nè·¯ç”±ç›®æ ‡ï¼ˆuriï¼‰ï¼šè·¯ç”±çš„ç›®æ ‡åœ°å€ï¼Œhttpä»£è¡¨å›ºå®šåœ°å€ï¼Œlbä»£è¡¨æ ¹æ®æœåŠ¡åè´Ÿè½½å‡è¡¡\nè·¯ç”±æ–­è¨€ï¼ˆpredicatesï¼‰ï¼šåˆ¤æ–­è·¯ç”±çš„è§„åˆ™ï¼Œ\nè·¯ç”±è¿‡æ»¤å™¨ï¼ˆfiltersï¼‰ï¼šå¯¹è¯·æ±‚æˆ–å“åº”åšå¤„ç†\næ¥ä¸‹æ¥ï¼Œå°±é‡ç‚¹æ¥å­¦ä¹ è·¯ç”±æ–­è¨€å’Œè·¯ç”±è¿‡æ»¤å™¨çš„è¯¦ç»†çŸ¥è¯†\n3.3.æ–­è¨€å·¥å‚ æˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ä¸­å†™çš„æ–­è¨€è§„åˆ™åªæ˜¯å­—ç¬¦ä¸²ï¼Œè¿™äº›å­—ç¬¦ä¸²ä¼šè¢«Predicate Factoryè¯»å–å¹¶å¤„ç†ï¼Œè½¬å˜ä¸ºè·¯ç”±åˆ¤æ–­çš„æ¡ä»¶\nä¾‹å¦‚Path=/user/**æ˜¯æŒ‰ç…§è·¯å¾„åŒ¹é…ï¼Œè¿™ä¸ªè§„åˆ™æ˜¯ç”±\norg.springframework.cloud.gateway.handler.predicate.PathRoutePredicateFactoryç±»æ¥\nå¤„ç†çš„ï¼Œåƒè¿™æ ·çš„æ–­è¨€å·¥å‚åœ¨SpringCloudGatewayè¿˜æœ‰åå‡ ä¸ª:\nåç§° è¯´æ˜ ç¤ºä¾‹ After æ˜¯æŸä¸ªæ—¶é—´ç‚¹åçš„è¯·æ±‚ - After=2037-01-20T17:42:47.789-07:00[America/Denver] Before æ˜¯æŸä¸ªæ—¶é—´ç‚¹ä¹‹å‰çš„è¯·æ±‚ - Before=2031-04-13T15:14:47.433+08:00[Asia/Shanghai] Between æ˜¯æŸä¸¤ä¸ªæ—¶é—´ç‚¹ä¹‹å‰çš„è¯·æ±‚ - Between=2037-01-20T17:42:47.789-07:00[America/Denver], 2037-01-21T17:42:47.789-07:00[America/Denver] Cookie è¯·æ±‚å¿…é¡»åŒ…å«æŸäº›cookie - Cookie=chocolate, ch.p Header è¯·æ±‚å¿…é¡»åŒ…å«æŸäº›header - Header=X-Request-Id, \\d+ Host è¯·æ±‚å¿…é¡»æ˜¯è®¿é—®æŸä¸ªhostï¼ˆåŸŸåï¼‰ - Host=.somehost.org,.anotherhost.org Method è¯·æ±‚æ–¹å¼å¿…é¡»æ˜¯æŒ‡å®šæ–¹å¼ - Method=GET,POST Path è¯·æ±‚è·¯å¾„å¿…é¡»ç¬¦åˆæŒ‡å®šè§„åˆ™ - Path=/red/{segment},/blue/** Query è¯·æ±‚å‚æ•°å¿…é¡»åŒ…å«æŒ‡å®šå‚æ•° - Query=name, Jackæˆ–è€…- Query=name RemoteAddr è¯·æ±‚è€…çš„ipå¿…é¡»æ˜¯æŒ‡å®šèŒƒå›´ - RemoteAddr=192.168.1.1/24 Weight æƒé‡å¤„ç† æˆ‘ä»¬åªéœ€è¦æŒæ¡Pathè¿™ç§è·¯ç”±å·¥ç¨‹å°±å¯ä»¥äº†ã€‚\n3.4.è¿‡æ»¤å™¨å·¥å‚ GatewayFilteræ˜¯ç½‘å…³ä¸­æä¾›çš„ä¸€ç§è¿‡æ»¤å™¨ï¼Œå¯ä»¥å¯¹è¿›å…¥ç½‘å…³çš„è¯·æ±‚å’Œå¾®æœåŠ¡è¿”å›çš„å“åº”åšå¤„ç†ï¼š\n3.4.1.è·¯ç”±è¿‡æ»¤å™¨çš„ç§ç±» Springæä¾›äº†31ç§ä¸åŒçš„è·¯ç”±è¿‡æ»¤å™¨å·¥å‚ã€‚ä¾‹å¦‚ï¼š\nåç§° è¯´æ˜ AddRequestHeader ç»™å½“å‰è¯·æ±‚æ·»åŠ ä¸€ä¸ªè¯·æ±‚å¤´ RemoveRequestHeader ç§»é™¤è¯·æ±‚ä¸­çš„ä¸€ä¸ªè¯·æ±‚å¤´ AddResponseHeader ç»™å“åº”ç»“æœä¸­æ·»åŠ ä¸€ä¸ªå“åº”å¤´ RemoveResponseHeader ä»å“åº”ç»“æœä¸­ç§»é™¤æœ‰ä¸€ä¸ªå“åº”å¤´ RequestRateLimiter é™åˆ¶è¯·æ±‚çš„æµé‡ 3.4.2.è¯·æ±‚å¤´è¿‡æ»¤å™¨ ä¸‹é¢æˆ‘ä»¬ä»¥AddRequestHeader ä¸ºä¾‹æ¥è®²è§£ã€‚\néœ€æ±‚ï¼šç»™æ‰€æœ‰è¿›å…¥userserviceçš„è¯·æ±‚æ·»åŠ ä¸€ä¸ªè¯·æ±‚å¤´ï¼šTruth=itcast is freaking awesome!\nåªéœ€è¦ä¿®æ”¹gatewayæœåŠ¡çš„application.ymlæ–‡ä»¶ï¼Œæ·»åŠ è·¯ç”±è¿‡æ»¤å³å¯ï¼š\nspring: cloud: gateway: routes: - id: user-service uri: lb://userservice predicates: - Path=/user/** filters: # è¿‡æ»¤å™¨ - AddRequestHeader=Truth, Itcast is freaking awesome! # æ·»åŠ è¯·æ±‚å¤´ å½“å‰è¿‡æ»¤å™¨å†™åœ¨userserviceè·¯ç”±ä¸‹ï¼Œå› æ­¤ä»…ä»…å¯¹è®¿é—®userserviceçš„è¯·æ±‚æœ‰æ•ˆã€‚\n3.4.3.é»˜è®¤è¿‡æ»¤å™¨ å¦‚æœè¦å¯¹æ‰€æœ‰çš„è·¯ç”±éƒ½ç”Ÿæ•ˆï¼Œåˆ™å¯ä»¥å°†è¿‡æ»¤å™¨å·¥å‚å†™åˆ°defaultä¸‹ã€‚æ ¼å¼å¦‚ä¸‹ï¼š\nspring: cloud: gateway: routes: - id: user-service uri: lb://userservice predicates: - Path=/user/** default-filters: # é»˜è®¤è¿‡æ»¤é¡¹ - AddRequestHeader=Truth, Itcast is freaking awesome! 3.4.4.æ€»ç»“ è¿‡æ»¤å™¨çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ\nâ‘  å¯¹è·¯ç”±çš„è¯·æ±‚æˆ–å“åº”åšåŠ å·¥å¤„ç†ï¼Œæ¯”å¦‚æ·»åŠ è¯·æ±‚å¤´\nâ‘¡ é…ç½®åœ¨è·¯ç”±ä¸‹çš„è¿‡æ»¤å™¨åªå¯¹å½“å‰è·¯ç”±çš„è¯·æ±‚ç”Ÿæ•ˆ\ndefaultFiltersçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ\nâ‘  å¯¹æ‰€æœ‰è·¯ç”±éƒ½ç”Ÿæ•ˆçš„è¿‡æ»¤å™¨\n3.5.å…¨å±€è¿‡æ»¤å™¨ ä¸Šä¸€èŠ‚å­¦ä¹ çš„è¿‡æ»¤å™¨ï¼Œç½‘å…³æä¾›äº†31ç§ï¼Œä½†æ¯ä¸€ç§è¿‡æ»¤å™¨çš„ä½œç”¨éƒ½æ˜¯å›ºå®šçš„ã€‚å¦‚æœæˆ‘ä»¬å¸Œæœ›æ‹¦æˆªè¯·æ±‚ï¼Œåšè‡ªå·±çš„ä¸šåŠ¡é€»è¾‘åˆ™æ²¡åŠæ³•å®ç°ã€‚\n3.5.1.å…¨å±€è¿‡æ»¤å™¨ä½œç”¨ å…¨å±€è¿‡æ»¤å™¨çš„ä½œç”¨ä¹Ÿæ˜¯å¤„ç†ä¸€åˆ‡è¿›å…¥ç½‘å…³çš„è¯·æ±‚å’Œå¾®æœåŠ¡å“åº”ï¼Œä¸GatewayFilterçš„ä½œç”¨ä¸€æ ·ã€‚åŒºåˆ«åœ¨äºGatewayFilteré€šè¿‡é…ç½®å®šä¹‰ï¼Œå¤„ç†é€»è¾‘æ˜¯å›ºå®šçš„ï¼›è€ŒGlobalFilterçš„é€»è¾‘éœ€è¦è‡ªå·±å†™ä»£ç å®ç°ã€‚\nå®šä¹‰æ–¹å¼æ˜¯å®ç°GlobalFilteræ¥å£ã€‚\npublic interface GlobalFilter { /** * å¤„ç†å½“å‰è¯·æ±‚ï¼Œæœ‰å¿…è¦çš„è¯é€šè¿‡{@link GatewayFilterChain}å°†è¯·æ±‚äº¤ç»™ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨å¤„ç† * * @param exchange è¯·æ±‚ä¸Šä¸‹æ–‡ï¼Œé‡Œé¢å¯ä»¥è·å–Requestã€Responseç­‰ä¿¡æ¯ * @param chain ç”¨æ¥æŠŠè¯·æ±‚å§”æ‰˜ç»™ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨ * @return {@code Mono} è¿”å›æ ‡ç¤ºå½“å‰è¿‡æ»¤å™¨ä¸šåŠ¡ç»“æŸ */ Mono\u003cVoid\u003e filter(ServerWebExchange exchange, GatewayFilterChain chain); } åœ¨filterä¸­ç¼–å†™è‡ªå®šä¹‰é€»è¾‘ï¼Œå¯ä»¥å®ç°ä¸‹åˆ—åŠŸèƒ½ï¼š\nç™»å½•çŠ¶æ€åˆ¤æ–­ æƒé™æ ¡éªŒ è¯·æ±‚é™æµç­‰ 3.5.2.è‡ªå®šä¹‰å…¨å±€è¿‡æ»¤å™¨ éœ€æ±‚ï¼šå®šä¹‰å…¨å±€è¿‡æ»¤å™¨ï¼Œæ‹¦æˆªè¯·æ±‚ï¼Œåˆ¤æ–­è¯·æ±‚çš„å‚æ•°æ˜¯å¦æ»¡è¶³ä¸‹é¢æ¡ä»¶ï¼š\nå‚æ•°ä¸­æ˜¯å¦æœ‰authorizationï¼Œ\nauthorizationå‚æ•°å€¼æ˜¯å¦ä¸ºadmin\nå¦‚æœåŒæ—¶æ»¡è¶³åˆ™æ”¾è¡Œï¼Œå¦åˆ™æ‹¦æˆª\nå®ç°ï¼š\nåœ¨gatewayä¸­å®šä¹‰ä¸€ä¸ªè¿‡æ»¤å™¨ï¼š\npackage cn.itcast.gateway.filters; import org.springframework.cloud.gateway.filter.GatewayFilterChain; import org.springframework.cloud.gateway.filter.GlobalFilter; import org.springframework.core.annotation.Order; import org.springframework.http.HttpStatus; import org.springframework.stereotype.Component; import org.springframework.web.server.ServerWebExchange; import reactor.core.publisher.Mono; @Order(-1) @Component public class AuthorizeFilter implements GlobalFilter { @Override public Mono\u003cVoid\u003e filter(ServerWebExchange exchange, GatewayFilterChain chain) { // 1.è·å–è¯·æ±‚å‚æ•° MultiValueMap\u003cString, String\u003e params = exchange.getRequest().getQueryParams(); // 2.è·å–authorizationå‚æ•° String auth = params.getFirst(\"authorization\"); // 3.æ ¡éªŒ if (\"admin\".equals(auth)) { // æ”¾è¡Œ return chain.filter(exchange); } // 4.æ‹¦æˆª // 4.1.ç¦æ­¢è®¿é—®ï¼Œè®¾ç½®çŠ¶æ€ç  exchange.getResponse().setStatusCode(HttpStatus.FORBIDDEN); // 4.2.ç»“æŸå¤„ç† return exchange.getResponse().setComplete(); } } 3.5.3.è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåº è¯·æ±‚è¿›å…¥ç½‘å…³ä¼šç¢°åˆ°ä¸‰ç±»è¿‡æ»¤å™¨ï¼šå½“å‰è·¯ç”±çš„è¿‡æ»¤å™¨ã€DefaultFilterã€GlobalFilter\nè¯·æ±‚è·¯ç”±åï¼Œä¼šå°†å½“å‰è·¯ç”±è¿‡æ»¤å™¨å’ŒDefaultFilterã€GlobalFilterï¼Œåˆå¹¶åˆ°ä¸€ä¸ªè¿‡æ»¤å™¨é“¾ï¼ˆé›†åˆï¼‰ä¸­ï¼Œæ’åºåä¾æ¬¡æ‰§è¡Œæ¯ä¸ªè¿‡æ»¤å™¨ï¼š\næ’åºçš„è§„åˆ™æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ\næ¯ä¸€ä¸ªè¿‡æ»¤å™¨éƒ½å¿…é¡»æŒ‡å®šä¸€ä¸ªintç±»å‹çš„orderå€¼ï¼Œorderå€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œæ‰§è¡Œé¡ºåºè¶Šé å‰ã€‚ GlobalFilteré€šè¿‡å®ç°Orderedæ¥å£ï¼Œæˆ–è€…æ·»åŠ @Orderæ³¨è§£æ¥æŒ‡å®šorderå€¼ï¼Œç”±æˆ‘ä»¬è‡ªå·±æŒ‡å®š è·¯ç”±è¿‡æ»¤å™¨å’ŒdefaultFilterçš„orderç”±SpringæŒ‡å®šï¼Œé»˜è®¤æ˜¯æŒ‰ç…§å£°æ˜é¡ºåºä»1é€’å¢ã€‚ å½“è¿‡æ»¤å™¨çš„orderå€¼ä¸€æ ·æ—¶ï¼Œä¼šæŒ‰ç…§ defaultFilter \u003e è·¯ç”±è¿‡æ»¤å™¨ \u003e GlobalFilterçš„é¡ºåºæ‰§è¡Œã€‚ è¯¦ç»†å†…å®¹ï¼Œå¯ä»¥æŸ¥çœ‹æºç ï¼š\norg.springframework.cloud.gateway.route.RouteDefinitionRouteLocator#getFilters()æ–¹æ³•æ˜¯å…ˆåŠ è½½defaultFiltersï¼Œç„¶åå†åŠ è½½æŸä¸ªrouteçš„filtersï¼Œç„¶ååˆå¹¶ã€‚\norg.springframework.cloud.gateway.handler.FilteringWebHandler#handle()æ–¹æ³•ä¼šåŠ è½½å…¨å±€è¿‡æ»¤å™¨ï¼Œä¸å‰é¢çš„è¿‡æ»¤å™¨åˆå¹¶åæ ¹æ®orderæ’åºï¼Œç»„ç»‡è¿‡æ»¤å™¨é“¾\n3.6.è·¨åŸŸé—®é¢˜ 3.6.1.ä»€ä¹ˆæ˜¯è·¨åŸŸé—®é¢˜ è·¨åŸŸï¼šåŸŸåä¸ä¸€è‡´å°±æ˜¯è·¨åŸŸï¼Œä¸»è¦åŒ…æ‹¬ï¼š\nåŸŸåä¸åŒï¼š www.taobao.com å’Œ www.taobao.org å’Œ www.jd.com å’Œ miaosha.jd.com\nåŸŸåç›¸åŒï¼Œç«¯å£ä¸åŒï¼šlocalhost:8080å’Œlocalhost8081\nè·¨åŸŸé—®é¢˜ï¼šæµè§ˆå™¨ç¦æ­¢è¯·æ±‚çš„å‘èµ·è€…ä¸æœåŠ¡ç«¯å‘ç”Ÿè·¨åŸŸajaxè¯·æ±‚ï¼Œè¯·æ±‚è¢«æµè§ˆå™¨æ‹¦æˆªçš„é—®é¢˜\nè§£å†³æ–¹æ¡ˆï¼šCORSï¼Œè¿™ä¸ªä»¥å‰åº”è¯¥å­¦ä¹ è¿‡ï¼Œè¿™é‡Œä¸å†èµ˜è¿°äº†ã€‚ä¸çŸ¥é“çš„å°ä¼™ä¼´å¯ä»¥æŸ¥çœ‹https://www.ruanyifeng.com/blog/2016/04/cors.html\n3.6.2.æ¨¡æ‹Ÿè·¨åŸŸé—®é¢˜ æ‰¾åˆ°è¯¾å‰èµ„æ–™çš„é¡µé¢æ–‡ä»¶ï¼š\næ”¾å…¥tomcatæˆ–è€…nginxè¿™æ ·çš„webæœåŠ¡å™¨ä¸­ï¼Œå¯åŠ¨å¹¶è®¿é—®ã€‚\nå¯ä»¥åœ¨æµè§ˆå™¨æ§åˆ¶å°çœ‹åˆ°ä¸‹é¢çš„é”™è¯¯ï¼š\nä»localhost:8090è®¿é—®localhost:10010ï¼Œç«¯å£ä¸åŒï¼Œæ˜¾ç„¶æ˜¯è·¨åŸŸçš„è¯·æ±‚ã€‚\n3.6.3.è§£å†³è·¨åŸŸé—®é¢˜ åœ¨gatewayæœåŠ¡çš„application.ymlæ–‡ä»¶ä¸­ï¼Œæ·»åŠ ä¸‹é¢çš„é…ç½®ï¼š\nspring: cloud: gateway: # ã€‚ã€‚ã€‚ globalcors: # å…¨å±€çš„è·¨åŸŸå¤„ç† add-to-simple-url-handler-mapping: true # è§£å†³optionsè¯·æ±‚è¢«æ‹¦æˆªé—®é¢˜ corsConfigurations: '[/**]': allowedOrigins: # å…è®¸å“ªäº›ç½‘ç«™çš„è·¨åŸŸè¯·æ±‚ - \"http://localhost:8090\" allowedMethods: # å…è®¸çš„è·¨åŸŸajaxçš„è¯·æ±‚æ–¹å¼ - \"GET\" - \"POST\" - \"DELETE\" - \"PUT\" - \"OPTIONS\" allowedHeaders: \"*\" # å…è®¸åœ¨è¯·æ±‚ä¸­æºå¸¦çš„å¤´ä¿¡æ¯ allowCredentials: true # æ˜¯å¦å…è®¸æºå¸¦cookie maxAge: 360000 # è¿™æ¬¡è·¨åŸŸæ£€æµ‹çš„æœ‰æ•ˆæœŸ ",
  "wordCount" : "8937",
  "inLanguage": "zh",
  "image":"https://XianCH.github.io/postsImg/springcloud.png","datePublished": "2022-12-22T10:16:51Z",
  "dateModified": "2023-09-22T10:16:51Z",
  "author":[{
    "@type": "Person",
    "name": "x14n"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://XianCH.github.io/posts/tech/distributed/springcloud/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "X14n's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://XianCH.github.io/img/favicon.icon"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://XianCH.github.io/" accesskey="h" title="x14n&#39;s Blog (Alt + H)">
            <img src="https://XianCH.github.io/img/main.png" alt="logo" aria-label="logo"
                 height="35">x14n&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                         stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                         stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                </ul>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://XianCH.github.io/search" title="Search (Alt &#43; /)" accesskey=/>
                <span>Search</span>
                </a>
            </li>
            <li>
                <a href="https://XianCH.github.io/" title="Home">
                <span>Home</span>
                </a>
            </li>
            <li>
                <a href="https://XianCH.github.io/posts" title="posts">
                <span>posts</span>
                </a>
            </li>
            <li>
                <a href="https://XianCH.github.io/tags" title="Tags">
                <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://XianCH.github.io/archives/" title="â±ï¸Archives">
                <span>â±ï¸Archives</span>
                </a>
            </li>
            <li>
                <a href="https://XianCH.github.io/about" title="â™‚ï¸About">
                <span>â™‚ï¸About</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main page">
<style>
    i[id*="post_meta_style"] {
        display: flex;
        align-items: center;
        margin: 0 0 10px 0;
    }
</style>

<article class="post-single">
    <div id="single-content">
        <header class="post-header">
            <div class="breadcrumbs"><a href="https://XianCH.github.io/">ğŸ  ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href="https://XianCH.github.io/posts/">Post</a>&nbsp;Â»&nbsp;<a href="https://XianCH.github.io/posts/tech/">Tech</a></div>
            <h1 class="post-title">
                springcloud
            </h1>
            <div class="post-description">
                springcloudå­¦ä¹ 
            </div>
            <div class="post-meta">

<style>
    i[id*="post_meta_style"] {
        display: flex;
        align-items: center;
        margin: 0 0 10px 0;
    }

    .parent-post-meta {
        display: flex;
        flex-wrap: wrap;
        opacity: 0.8;
    }
</style>

<span class="parent-post-meta">
    <span id="post_meta_style_1">
        <span class="fa fa-calendar-check-o"></span>
        <span>2022-12-22
            &nbsp;&nbsp;
        </span>
    </span>
    
    
    
    
    
    
    
    <span id="post_meta_style_3">
        <span class="fa fa-file-word-o"></span>
        <span>8937å­—
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_4">
        <span class="fa fa-clock-o"></span>
        <span>18åˆ†é’Ÿ
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_5">
        <span class="fa fa-user-o"></span>
        <span>x14n
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_6">
        <span class="fa fa-tags" style="opacity: 0.8"></span>
        <span>
            <span class="post-tags-meta">
                <a href="https://XianCH.github.io/tags/distributed/" style="color: var(--secondary)!important;">Distributed</a>
            </span>
        </span>
    </span>
</span>
<span style="opacity: 0.8;">
                    <span id="post_meta_style_7">
                        &nbsp;&nbsp;
                        <span class="fa fa-eye" ></span>
                        <span>
                            <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv"></span></span>
                            &nbsp;&nbsp;
                        </span>
                    </span>
                    <span id="post_meta_style_8">
                        <span class="fa fa-commenting-o"></span>
                        <span>
                            <script src="https://cdn.staticfile.org/twikoo//twikoo.all.min.js"></script>
                            <script>
                                let url = document.documentURI
                                
                                let dnsUrl = "https://XianCH.github.io/"
                                let urlSplit = url.split(dnsUrl)
                                let finalUrl = urlSplit[1]
                                if (finalUrl[0] !== '/') {
                                    finalUrl = '/'+finalUrl
                                }
                                twikoo.getCommentsCount({
                                    envId:  null , 
                                region:  null , 
                                urls: [ 
                                    
                                    finalUrl,
                                ],
                                    includeReply: false 
                                }).then(function (res) {
                                    let count = res[0].count
                                    const obj = document.getElementById("comment_count");
                                    obj.innerText = count
                                    
                                    
                                    
                                }).catch(function (err) {
                                    
                                    console.error(err);
                                });
                            </script>
                            <span id="comment_count"></span>
                        </span>
                    </span>
                </span>

</div>
        </header> 
<figure class="entry-cover1"><img style="zoom:;" loading="lazy" src="https://XianCH.github.io/postsImg/springcloud.png" alt="">
    
</figure><aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">ç›®å½•</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#1nacos%e9%85%8d%e7%bd%ae%e7%ae%a1%e7%90%86" aria-label="1.Nacosé…ç½®ç®¡ç†">1.Nacosé…ç½®ç®¡ç†</a><ul>
                        
                <li>
                    <a href="#11%e7%bb%9f%e4%b8%80%e9%85%8d%e7%bd%ae%e7%ae%a1%e7%90%86" aria-label="1.1.ç»Ÿä¸€é…ç½®ç®¡ç†">1.1.ç»Ÿä¸€é…ç½®ç®¡ç†</a><ul>
                        
                <li>
                    <a href="#111%e5%9c%a8nacos%e4%b8%ad%e6%b7%bb%e5%8a%a0%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6" aria-label="1.1.1.åœ¨nacosä¸­æ·»åŠ é…ç½®æ–‡ä»¶">1.1.1.åœ¨nacosä¸­æ·»åŠ é…ç½®æ–‡ä»¶</a></li>
                <li>
                    <a href="#112%e4%bb%8e%e5%be%ae%e6%9c%8d%e5%8a%a1%e6%8b%89%e5%8f%96%e9%85%8d%e7%bd%ae" aria-label="1.1.2.ä»å¾®æœåŠ¡æ‹‰å–é…ç½®">1.1.2.ä»å¾®æœåŠ¡æ‹‰å–é…ç½®</a></li></ul>
                </li>
                <li>
                    <a href="#12%e9%85%8d%e7%bd%ae%e7%83%ad%e6%9b%b4%e6%96%b0" aria-label="1.2.é…ç½®çƒ­æ›´æ–°">1.2.é…ç½®çƒ­æ›´æ–°</a><ul>
                        
                <li>
                    <a href="#121%e6%96%b9%e5%bc%8f%e4%b8%80" aria-label="1.2.1.æ–¹å¼ä¸€">1.2.1.æ–¹å¼ä¸€</a></li>
                <li>
                    <a href="#122%e6%96%b9%e5%bc%8f%e4%ba%8c" aria-label="1.2.2.æ–¹å¼äºŒ">1.2.2.æ–¹å¼äºŒ</a></li></ul>
                </li>
                <li>
                    <a href="#13%e9%85%8d%e7%bd%ae%e5%85%b1%e4%ba%ab" aria-label="1.3.é…ç½®å…±äº«">1.3.é…ç½®å…±äº«</a><ul>
                        
                <li>
                    <a href="#1%e6%b7%bb%e5%8a%a0%e4%b8%80%e4%b8%aa%e7%8e%af%e5%a2%83%e5%85%b1%e4%ba%ab%e9%85%8d%e7%bd%ae" aria-label="1ï¼‰æ·»åŠ ä¸€ä¸ªç¯å¢ƒå…±äº«é…ç½®">1ï¼‰æ·»åŠ ä¸€ä¸ªç¯å¢ƒå…±äº«é…ç½®</a></li>
                <li>
                    <a href="#2%e5%9c%a8user-service%e4%b8%ad%e8%af%bb%e5%8f%96%e5%85%b1%e4%ba%ab%e9%85%8d%e7%bd%ae" aria-label="2ï¼‰åœ¨user-serviceä¸­è¯»å–å…±äº«é…ç½®">2ï¼‰åœ¨user-serviceä¸­è¯»å–å…±äº«é…ç½®</a></li>
                <li>
                    <a href="#3%e8%bf%90%e8%a1%8c%e4%b8%a4%e4%b8%aauserapplication%e4%bd%bf%e7%94%a8%e4%b8%8d%e5%90%8c%e7%9a%84profile" aria-label="3ï¼‰è¿è¡Œä¸¤ä¸ªUserApplicationï¼Œä½¿ç”¨ä¸åŒçš„profile">3ï¼‰è¿è¡Œä¸¤ä¸ªUserApplicationï¼Œä½¿ç”¨ä¸åŒçš„profile</a></li>
                <li>
                    <a href="#4%e9%85%8d%e7%bd%ae%e5%85%b1%e4%ba%ab%e7%9a%84%e4%bc%98%e5%85%88%e7%ba%a7" aria-label="4ï¼‰é…ç½®å…±äº«çš„ä¼˜å…ˆçº§">4ï¼‰é…ç½®å…±äº«çš„ä¼˜å…ˆçº§</a></li></ul>
                </li>
                <li>
                    <a href="#14%e6%90%ad%e5%bb%banacos%e9%9b%86%e7%be%a4" aria-label="1.4.æ­å»ºNacosé›†ç¾¤">1.4.æ­å»ºNacosé›†ç¾¤</a></li></ul>
                </li>
                <li>
                    <a href="#2feign%e8%bf%9c%e7%a8%8b%e8%b0%83%e7%94%a8" aria-label="2.Feignè¿œç¨‹è°ƒç”¨">2.Feignè¿œç¨‹è°ƒç”¨</a><ul>
                        
                <li>
                    <a href="#21feign%e6%9b%bf%e4%bb%a3resttemplate" aria-label="2.1.Feignæ›¿ä»£RestTemplate">2.1.Feignæ›¿ä»£RestTemplate</a><ul>
                        
                <li>
                    <a href="#1%e5%bc%95%e5%85%a5%e4%be%9d%e8%b5%96" aria-label="1ï¼‰å¼•å…¥ä¾èµ–">1ï¼‰å¼•å…¥ä¾èµ–</a></li>
                <li>
                    <a href="#2%e6%b7%bb%e5%8a%a0%e6%b3%a8%e8%a7%a3" aria-label="2ï¼‰æ·»åŠ æ³¨è§£">2ï¼‰æ·»åŠ æ³¨è§£</a></li>
                <li>
                    <a href="#3%e7%bc%96%e5%86%99feign%e7%9a%84%e5%ae%a2%e6%88%b7%e7%ab%af" aria-label="3ï¼‰ç¼–å†™Feignçš„å®¢æˆ·ç«¯">3ï¼‰ç¼–å†™Feignçš„å®¢æˆ·ç«¯</a></li>
                <li>
                    <a href="#4%e6%b5%8b%e8%af%95" aria-label="4ï¼‰æµ‹è¯•">4ï¼‰æµ‹è¯•</a></li>
                <li>
                    <a href="#5%e6%80%bb%e7%bb%93" aria-label="5ï¼‰æ€»ç»“">5ï¼‰æ€»ç»“</a></li></ul>
                </li>
                <li>
                    <a href="#22%e8%87%aa%e5%ae%9a%e4%b9%89%e9%85%8d%e7%bd%ae" aria-label="2.2.è‡ªå®šä¹‰é…ç½®">2.2.è‡ªå®šä¹‰é…ç½®</a><ul>
                        
                <li>
                    <a href="#221%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%e6%96%b9%e5%bc%8f" aria-label="2.2.1.é…ç½®æ–‡ä»¶æ–¹å¼">2.2.1.é…ç½®æ–‡ä»¶æ–¹å¼</a></li>
                <li>
                    <a href="#222java%e4%bb%a3%e7%a0%81%e6%96%b9%e5%bc%8f" aria-label="2.2.2.Javaä»£ç æ–¹å¼">2.2.2.Javaä»£ç æ–¹å¼</a></li></ul>
                </li>
                <li>
                    <a href="#23feign%e4%bd%bf%e7%94%a8%e4%bc%98%e5%8c%96" aria-label="2.3.Feignä½¿ç”¨ä¼˜åŒ–">2.3.Feignä½¿ç”¨ä¼˜åŒ–</a></li>
                <li>
                    <a href="#24%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5" aria-label="2.4.æœ€ä½³å®è·µ">2.4.æœ€ä½³å®è·µ</a><ul>
                        
                <li>
                    <a href="#241%e7%bb%a7%e6%89%bf%e6%96%b9%e5%bc%8f" aria-label="2.4.1.ç»§æ‰¿æ–¹å¼">2.4.1.ç»§æ‰¿æ–¹å¼</a></li>
                <li>
                    <a href="#242%e6%8a%bd%e5%8f%96%e6%96%b9%e5%bc%8f" aria-label="2.4.2.æŠ½å–æ–¹å¼">2.4.2.æŠ½å–æ–¹å¼</a></li>
                <li>
                    <a href="#243%e5%ae%9e%e7%8e%b0%e5%9f%ba%e4%ba%8e%e6%8a%bd%e5%8f%96%e7%9a%84%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5" aria-label="2.4.3.å®ç°åŸºäºæŠ½å–çš„æœ€ä½³å®è·µ">2.4.3.å®ç°åŸºäºæŠ½å–çš„æœ€ä½³å®è·µ</a><ul>
                        
                <li>
                    <a href="#1%e6%8a%bd%e5%8f%96" aria-label="1ï¼‰æŠ½å–">1ï¼‰æŠ½å–</a></li>
                <li>
                    <a href="#2%e5%9c%a8order-service%e4%b8%ad%e4%bd%bf%e7%94%a8feign-api" aria-label="2ï¼‰åœ¨order-serviceä¸­ä½¿ç”¨feign-api">2ï¼‰åœ¨order-serviceä¸­ä½¿ç”¨feign-api</a></li>
                <li>
                    <a href="#3%e9%87%8d%e5%90%af%e6%b5%8b%e8%af%95" aria-label="3ï¼‰é‡å¯æµ‹è¯•">3ï¼‰é‡å¯æµ‹è¯•</a></li>
                <li>
                    <a href="#4%e8%a7%a3%e5%86%b3%e6%89%ab%e6%8f%8f%e5%8c%85%e9%97%ae%e9%a2%98" aria-label="4ï¼‰è§£å†³æ‰«æåŒ…é—®é¢˜">4ï¼‰è§£å†³æ‰«æåŒ…é—®é¢˜</a></li></ul>
                </li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#3gateway%e6%9c%8d%e5%8a%a1%e7%bd%91%e5%85%b3" aria-label="3.GatewayæœåŠ¡ç½‘å…³">3.GatewayæœåŠ¡ç½‘å…³</a><ul>
                        
                <li>
                    <a href="#31%e4%b8%ba%e4%bb%80%e4%b9%88%e9%9c%80%e8%a6%81%e7%bd%91%e5%85%b3" aria-label="3.1.ä¸ºä»€ä¹ˆéœ€è¦ç½‘å…³">3.1.ä¸ºä»€ä¹ˆéœ€è¦ç½‘å…³</a></li>
                <li>
                    <a href="#32gateway%e5%bf%ab%e9%80%9f%e5%85%a5%e9%97%a8" aria-label="3.2.gatewayå¿«é€Ÿå…¥é—¨">3.2.gatewayå¿«é€Ÿå…¥é—¨</a><ul>
                        
                <li>
                    <a href="#1%e5%88%9b%e5%bb%bagateway%e6%9c%8d%e5%8a%a1%e5%bc%95%e5%85%a5%e4%be%9d%e8%b5%96" aria-label="1ï¼‰åˆ›å»ºgatewayæœåŠ¡ï¼Œå¼•å…¥ä¾èµ–">1ï¼‰åˆ›å»ºgatewayæœåŠ¡ï¼Œå¼•å…¥ä¾èµ–</a></li>
                <li>
                    <a href="#2%e7%bc%96%e5%86%99%e5%90%af%e5%8a%a8%e7%b1%bb" aria-label="2ï¼‰ç¼–å†™å¯åŠ¨ç±»">2ï¼‰ç¼–å†™å¯åŠ¨ç±»</a></li>
                <li>
                    <a href="#3%e7%bc%96%e5%86%99%e5%9f%ba%e7%a1%80%e9%85%8d%e7%bd%ae%e5%92%8c%e8%b7%af%e7%94%b1%e8%a7%84%e5%88%99" aria-label="3ï¼‰ç¼–å†™åŸºç¡€é…ç½®å’Œè·¯ç”±è§„åˆ™">3ï¼‰ç¼–å†™åŸºç¡€é…ç½®å’Œè·¯ç”±è§„åˆ™</a></li>
                <li>
                    <a href="#4%e9%87%8d%e5%90%af%e6%b5%8b%e8%af%95" aria-label="4ï¼‰é‡å¯æµ‹è¯•">4ï¼‰é‡å¯æµ‹è¯•</a></li>
                <li>
                    <a href="#5%e7%bd%91%e5%85%b3%e8%b7%af%e7%94%b1%e7%9a%84%e6%b5%81%e7%a8%8b%e5%9b%be" aria-label="5ï¼‰ç½‘å…³è·¯ç”±çš„æµç¨‹å›¾">5ï¼‰ç½‘å…³è·¯ç”±çš„æµç¨‹å›¾</a></li></ul>
                </li>
                <li>
                    <a href="#33%e6%96%ad%e8%a8%80%e5%b7%a5%e5%8e%82" aria-label="3.3.æ–­è¨€å·¥å‚">3.3.æ–­è¨€å·¥å‚</a></li>
                <li>
                    <a href="#34%e8%bf%87%e6%bb%a4%e5%99%a8%e5%b7%a5%e5%8e%82" aria-label="3.4.è¿‡æ»¤å™¨å·¥å‚">3.4.è¿‡æ»¤å™¨å·¥å‚</a><ul>
                        
                <li>
                    <a href="#341%e8%b7%af%e7%94%b1%e8%bf%87%e6%bb%a4%e5%99%a8%e7%9a%84%e7%a7%8d%e7%b1%bb" aria-label="3.4.1.è·¯ç”±è¿‡æ»¤å™¨çš„ç§ç±»">3.4.1.è·¯ç”±è¿‡æ»¤å™¨çš„ç§ç±»</a></li>
                <li>
                    <a href="#342%e8%af%b7%e6%b1%82%e5%a4%b4%e8%bf%87%e6%bb%a4%e5%99%a8" aria-label="3.4.2.è¯·æ±‚å¤´è¿‡æ»¤å™¨">3.4.2.è¯·æ±‚å¤´è¿‡æ»¤å™¨</a></li>
                <li>
                    <a href="#343%e9%bb%98%e8%ae%a4%e8%bf%87%e6%bb%a4%e5%99%a8" aria-label="3.4.3.é»˜è®¤è¿‡æ»¤å™¨">3.4.3.é»˜è®¤è¿‡æ»¤å™¨</a></li>
                <li>
                    <a href="#344%e6%80%bb%e7%bb%93" aria-label="3.4.4.æ€»ç»“">3.4.4.æ€»ç»“</a></li></ul>
                </li>
                <li>
                    <a href="#35%e5%85%a8%e5%b1%80%e8%bf%87%e6%bb%a4%e5%99%a8" aria-label="3.5.å…¨å±€è¿‡æ»¤å™¨">3.5.å…¨å±€è¿‡æ»¤å™¨</a><ul>
                        
                <li>
                    <a href="#351%e5%85%a8%e5%b1%80%e8%bf%87%e6%bb%a4%e5%99%a8%e4%bd%9c%e7%94%a8" aria-label="3.5.1.å…¨å±€è¿‡æ»¤å™¨ä½œç”¨">3.5.1.å…¨å±€è¿‡æ»¤å™¨ä½œç”¨</a></li>
                <li>
                    <a href="#352%e8%87%aa%e5%ae%9a%e4%b9%89%e5%85%a8%e5%b1%80%e8%bf%87%e6%bb%a4%e5%99%a8" aria-label="3.5.2.è‡ªå®šä¹‰å…¨å±€è¿‡æ»¤å™¨">3.5.2.è‡ªå®šä¹‰å…¨å±€è¿‡æ»¤å™¨</a></li>
                <li>
                    <a href="#353%e8%bf%87%e6%bb%a4%e5%99%a8%e6%89%a7%e8%a1%8c%e9%a1%ba%e5%ba%8f" aria-label="3.5.3.è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåº">3.5.3.è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåº</a></li></ul>
                </li>
                <li>
                    <a href="#36%e8%b7%a8%e5%9f%9f%e9%97%ae%e9%a2%98" aria-label="3.6.è·¨åŸŸé—®é¢˜">3.6.è·¨åŸŸé—®é¢˜</a><ul>
                        
                <li>
                    <a href="#361%e4%bb%80%e4%b9%88%e6%98%af%e8%b7%a8%e5%9f%9f%e9%97%ae%e9%a2%98" aria-label="3.6.1.ä»€ä¹ˆæ˜¯è·¨åŸŸé—®é¢˜">3.6.1.ä»€ä¹ˆæ˜¯è·¨åŸŸé—®é¢˜</a></li>
                <li>
                    <a href="#362%e6%a8%a1%e6%8b%9f%e8%b7%a8%e5%9f%9f%e9%97%ae%e9%a2%98" aria-label="3.6.2.æ¨¡æ‹Ÿè·¨åŸŸé—®é¢˜">3.6.2.æ¨¡æ‹Ÿè·¨åŸŸé—®é¢˜</a></li>
                <li>
                    <a href="#363%e8%a7%a3%e5%86%b3%e8%b7%a8%e5%9f%9f%e9%97%ae%e9%a2%98" aria-label="3.6.3.è§£å†³è·¨åŸŸé—®é¢˜">3.6.3.è§£å†³è·¨åŸŸé—®é¢˜</a>
                </li>
            </ul>
            </li>
            </ul>
            </li>
            </ul>
        </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
        
        activeElement = elements[0];
        const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
        document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
    }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        if (elements) {
            activeElement = Array.from(elements).find((element) => {
                if ((getOffsetTop(element) - window.pageYOffset) > 0 &&
                    (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                    return element;
                }
            }) || activeElement

            elements.forEach(element => {
                const id = encodeURI(element.getAttribute('id')).toLowerCase();
                if (element === activeElement){
                    document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
                } else {
                    document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
                }
            })
        }
    }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;
        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;
    }
</script>
        <div class="post-content"><h1 id="1nacosé…ç½®ç®¡ç†">1.Nacosé…ç½®ç®¡ç†<a hidden class="anchor" aria-hidden="true" href="#1nacosé…ç½®ç®¡ç†">#</a></h1>
<p>Nacosé™¤äº†å¯ä»¥åšæ³¨å†Œä¸­å¿ƒï¼ŒåŒæ ·å¯ä»¥åšé…ç½®ç®¡ç†æ¥ä½¿ç”¨ã€‚</p>
<h2 id="11ç»Ÿä¸€é…ç½®ç®¡ç†">1.1.ç»Ÿä¸€é…ç½®ç®¡ç†<a hidden class="anchor" aria-hidden="true" href="#11ç»Ÿä¸€é…ç½®ç®¡ç†">#</a></h2>
<p>å½“å¾®æœåŠ¡éƒ¨ç½²çš„å®ä¾‹è¶Šæ¥è¶Šå¤šï¼Œè¾¾åˆ°æ•°åã€æ•°ç™¾æ—¶ï¼Œé€ä¸ªä¿®æ”¹å¾®æœåŠ¡é…ç½®å°±ä¼šè®©äººæŠ“ç‹‚ï¼Œè€Œä¸”å¾ˆå®¹æ˜“å‡ºé”™ã€‚æˆ‘ä»¬éœ€è¦ä¸€ç§ç»Ÿä¸€é…ç½®ç®¡ç†æ–¹æ¡ˆï¼Œå¯ä»¥é›†ä¸­ç®¡ç†æ‰€æœ‰å®ä¾‹çš„é…ç½®ã€‚</p>
<p><img loading="lazy" src="assets/image-20210714164426792.png" alt="image-20210714164426792"  />
</p>
<p>Nacosä¸€æ–¹é¢å¯ä»¥å°†é…ç½®é›†ä¸­ç®¡ç†ï¼Œå¦ä¸€æ–¹å¯ä»¥åœ¨é…ç½®å˜æ›´æ—¶ï¼ŒåŠæ—¶é€šçŸ¥å¾®æœåŠ¡ï¼Œå®ç°é…ç½®çš„çƒ­æ›´æ–°ã€‚</p>
<h3 id="111åœ¨nacosä¸­æ·»åŠ é…ç½®æ–‡ä»¶">1.1.1.åœ¨nacosä¸­æ·»åŠ é…ç½®æ–‡ä»¶<a hidden class="anchor" aria-hidden="true" href="#111åœ¨nacosä¸­æ·»åŠ é…ç½®æ–‡ä»¶">#</a></h3>
<p>å¦‚ä½•åœ¨nacosä¸­ç®¡ç†é…ç½®å‘¢ï¼Ÿ</p>
<p><img loading="lazy" src="assets/image-20210714164742924.png" alt="image-20210714164742924"  />
</p>
<p>ç„¶ååœ¨å¼¹å‡ºçš„è¡¨å•ä¸­ï¼Œå¡«å†™é…ç½®ä¿¡æ¯ï¼š</p>
<p><img loading="lazy" src="assets/image-20210714164856664.png" alt="image-20210714164856664"  />
</p>
<blockquote>
<p>æ³¨æ„ï¼šé¡¹ç›®çš„æ ¸å¿ƒé…ç½®ï¼Œéœ€è¦çƒ­æ›´æ–°çš„é…ç½®æ‰æœ‰æ”¾åˆ°nacosç®¡ç†çš„å¿…è¦ã€‚åŸºæœ¬ä¸ä¼šå˜æ›´çš„ä¸€äº›é…ç½®è¿˜æ˜¯ä¿å­˜åœ¨å¾®æœåŠ¡æœ¬åœ°æ¯”è¾ƒå¥½ã€‚</p>
</blockquote>
<h3 id="112ä»å¾®æœåŠ¡æ‹‰å–é…ç½®">1.1.2.ä»å¾®æœåŠ¡æ‹‰å–é…ç½®<a hidden class="anchor" aria-hidden="true" href="#112ä»å¾®æœåŠ¡æ‹‰å–é…ç½®">#</a></h3>
<p>å¾®æœåŠ¡è¦æ‹‰å–nacosä¸­ç®¡ç†çš„é…ç½®ï¼Œå¹¶ä¸”ä¸æœ¬åœ°çš„application.ymlé…ç½®åˆå¹¶ï¼Œæ‰èƒ½å®Œæˆé¡¹ç›®å¯åŠ¨ã€‚</p>
<p>ä½†å¦‚æœå°šæœªè¯»å–application.ymlï¼Œåˆå¦‚ä½•å¾—çŸ¥nacosåœ°å€å‘¢ï¼Ÿ</p>
<p>å› æ­¤springå¼•å…¥äº†ä¸€ç§æ–°çš„é…ç½®æ–‡ä»¶ï¼šbootstrap.yamlæ–‡ä»¶ï¼Œä¼šåœ¨application.ymlä¹‹å‰è¢«è¯»å–ï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p>
<p><img loading="lazy" src="assets/L0iFYNF.png" alt="img"  />
</p>
<p>1ï¼‰å¼•å…¥nacos-configä¾èµ–</p>
<p>é¦–å…ˆï¼Œåœ¨user-serviceæœåŠ¡ä¸­ï¼Œå¼•å…¥nacos-configçš„å®¢æˆ·ç«¯ä¾èµ–ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#75715e">&lt;!--nacosé…ç½®ç®¡ç†ä¾èµ–--&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;groupId&gt;</span>com.alibaba.cloud<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;artifactId&gt;</span>spring-cloud-starter-alibaba-nacos-config<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>2ï¼‰æ·»åŠ bootstrap.yaml</p>
<p>ç„¶åï¼Œåœ¨user-serviceä¸­æ·»åŠ ä¸€ä¸ªbootstrap.yamlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">spring</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">application</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">userservice</span> <span style="color:#75715e"># æœåŠ¡åç§°</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">profiles</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">active</span>: <span style="color:#ae81ff">dev</span> <span style="color:#75715e">#å¼€å‘ç¯å¢ƒï¼Œè¿™é‡Œæ˜¯dev </span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">cloud</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">nacos</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">server-addr</span>: <span style="color:#ae81ff">localhost:8848</span> <span style="color:#75715e"># Nacosåœ°å€</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">config</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">file-extension</span>: <span style="color:#ae81ff">yaml</span> <span style="color:#75715e"># æ–‡ä»¶åç¼€å</span>
</span></span></code></pre></div><p>è¿™é‡Œä¼šæ ¹æ®spring.cloud.nacos.server-addrè·å–nacosåœ°å€ï¼Œå†æ ¹æ®</p>
<p><code>${spring.application.name}-${spring.profiles.active}.${spring.cloud.nacos.config.file-extension}</code>ä½œä¸ºæ–‡ä»¶idï¼Œæ¥è¯»å–é…ç½®ã€‚</p>
<p>æœ¬ä¾‹ä¸­ï¼Œå°±æ˜¯å»è¯»å–<code>userservice-dev.yaml</code>ï¼š</p>
<p><img loading="lazy" src="assets/image-20210714170845901.png" alt="image-20210714170845901"  />
</p>
<p>3ï¼‰è¯»å–nacosé…ç½®</p>
<p>åœ¨user-serviceä¸­çš„UserControllerä¸­æ·»åŠ ä¸šåŠ¡é€»è¾‘ï¼Œè¯»å–pattern.dateformaté…ç½®ï¼š</p>
<p><img loading="lazy" src="assets/image-20210714170337448.png" alt="image-20210714170337448"  />
</p>
<p>å®Œæ•´ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> cn.itcast.user.web;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> cn.itcast.user.pojo.User;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> cn.itcast.user.service.UserService;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> lombok.extern.slf4j.Slf4j;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.beans.factory.annotation.Autowired;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.beans.factory.annotation.Value;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.web.bind.annotation.*;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.time.LocalDateTime;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.time.format.DateTimeFormatter;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Slf4j</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@RestController</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@RequestMapping</span>(<span style="color:#e6db74">&#34;/user&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UserController</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> UserService userService;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Value</span>(<span style="color:#e6db74">&#34;${pattern.dateformat}&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> String dateformat;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@GetMapping</span>(<span style="color:#e6db74">&#34;now&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">now</span>(){
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> LocalDateTime.<span style="color:#a6e22e">now</span>().<span style="color:#a6e22e">format</span>(DateTimeFormatter.<span style="color:#a6e22e">ofPattern</span>(dateformat));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...ç•¥</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>åœ¨é¡µé¢è®¿é—®ï¼Œå¯ä»¥çœ‹åˆ°æ•ˆæœï¼š</p>
<p><img loading="lazy" src="assets/image-20210714170449612.png" alt="image-20210714170449612"  />
</p>
<h2 id="12é…ç½®çƒ­æ›´æ–°">1.2.é…ç½®çƒ­æ›´æ–°<a hidden class="anchor" aria-hidden="true" href="#12é…ç½®çƒ­æ›´æ–°">#</a></h2>
<p>æˆ‘ä»¬æœ€ç»ˆçš„ç›®çš„ï¼Œæ˜¯ä¿®æ”¹nacosä¸­çš„é…ç½®åï¼Œå¾®æœåŠ¡ä¸­æ— éœ€é‡å¯å³å¯è®©é…ç½®ç”Ÿæ•ˆï¼Œä¹Ÿå°±æ˜¯<strong>é…ç½®çƒ­æ›´æ–°</strong>ã€‚</p>
<p>è¦å®ç°é…ç½®çƒ­æ›´æ–°ï¼Œå¯ä»¥ä½¿ç”¨ä¸¤ç§æ–¹å¼ï¼š</p>
<h3 id="121æ–¹å¼ä¸€">1.2.1.æ–¹å¼ä¸€<a hidden class="anchor" aria-hidden="true" href="#121æ–¹å¼ä¸€">#</a></h3>
<p>åœ¨@Valueæ³¨å…¥çš„å˜é‡æ‰€åœ¨ç±»ä¸Šæ·»åŠ æ³¨è§£@RefreshScopeï¼š</p>
<p><img loading="lazy" src="assets/image-20210714171036335.png" alt="image-20210714171036335"  />
</p>
<h3 id="122æ–¹å¼äºŒ">1.2.2.æ–¹å¼äºŒ<a hidden class="anchor" aria-hidden="true" href="#122æ–¹å¼äºŒ">#</a></h3>
<p>ä½¿ç”¨@ConfigurationPropertiesæ³¨è§£ä»£æ›¿@Valueæ³¨è§£ã€‚</p>
<p>åœ¨user-serviceæœåŠ¡ä¸­ï¼Œæ·»åŠ ä¸€ä¸ªç±»ï¼Œè¯»å–patterrn.dateformatå±æ€§ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> cn.itcast.user.config;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> lombok.Data;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.boot.context.properties.ConfigurationProperties;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.stereotype.Component;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Component</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Data</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@ConfigurationProperties</span>(prefix <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;pattern&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PatternProperties</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> String dateformat;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>åœ¨UserControllerä¸­ä½¿ç”¨è¿™ä¸ªç±»ä»£æ›¿@Valueï¼š</p>
<p><img loading="lazy" src="assets/image-20210714171316124.png" alt="image-20210714171316124"  />
</p>
<p>å®Œæ•´ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> cn.itcast.user.web;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> cn.itcast.user.config.PatternProperties;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> cn.itcast.user.pojo.User;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> cn.itcast.user.service.UserService;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> lombok.extern.slf4j.Slf4j;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.beans.factory.annotation.Autowired;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.web.bind.annotation.GetMapping;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.web.bind.annotation.PathVariable;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.web.bind.annotation.RequestMapping;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.web.bind.annotation.RestController;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.time.LocalDateTime;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.time.format.DateTimeFormatter;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Slf4j</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@RestController</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@RequestMapping</span>(<span style="color:#e6db74">&#34;/user&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UserController</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> UserService userService;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> PatternProperties patternProperties;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@GetMapping</span>(<span style="color:#e6db74">&#34;now&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">now</span>(){
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> LocalDateTime.<span style="color:#a6e22e">now</span>().<span style="color:#a6e22e">format</span>(DateTimeFormatter.<span style="color:#a6e22e">ofPattern</span>(patternProperties.<span style="color:#a6e22e">getDateformat</span>()));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ç•¥</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="13é…ç½®å…±äº«">1.3.é…ç½®å…±äº«<a hidden class="anchor" aria-hidden="true" href="#13é…ç½®å…±äº«">#</a></h2>
<p>å…¶å®å¾®æœåŠ¡å¯åŠ¨æ—¶ï¼Œä¼šå»nacosè¯»å–å¤šä¸ªé…ç½®æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>
<p><code>[spring.application.name]-[spring.profiles.active].yaml</code>ï¼Œä¾‹å¦‚ï¼šuserservice-dev.yaml</p>
</li>
<li>
<p><code>[spring.application.name].yaml</code>ï¼Œä¾‹å¦‚ï¼šuserservice.yaml</p>
</li>
</ul>
<p>è€Œ<code>[spring.application.name].yaml</code>ä¸åŒ…å«ç¯å¢ƒï¼Œå› æ­¤å¯ä»¥è¢«å¤šä¸ªç¯å¢ƒå…±äº«ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬é€šè¿‡æ¡ˆä¾‹æ¥æµ‹è¯•é…ç½®å…±äº«</p>
<h3 id="1æ·»åŠ ä¸€ä¸ªç¯å¢ƒå…±äº«é…ç½®">1ï¼‰æ·»åŠ ä¸€ä¸ªç¯å¢ƒå…±äº«é…ç½®<a hidden class="anchor" aria-hidden="true" href="#1æ·»åŠ ä¸€ä¸ªç¯å¢ƒå…±äº«é…ç½®">#</a></h3>
<p>æˆ‘ä»¬åœ¨nacosä¸­æ·»åŠ ä¸€ä¸ªuserservice.yamlæ–‡ä»¶ï¼š</p>
<p><img loading="lazy" src="assets/image-20210714173233650.png" alt="image-20210714173233650"  />
</p>
<h3 id="2åœ¨user-serviceä¸­è¯»å–å…±äº«é…ç½®">2ï¼‰åœ¨user-serviceä¸­è¯»å–å…±äº«é…ç½®<a hidden class="anchor" aria-hidden="true" href="#2åœ¨user-serviceä¸­è¯»å–å…±äº«é…ç½®">#</a></h3>
<p>åœ¨user-serviceæœåŠ¡ä¸­ï¼Œä¿®æ”¹PatternPropertiesç±»ï¼Œè¯»å–æ–°æ·»åŠ çš„å±æ€§ï¼š</p>
<p><img loading="lazy" src="assets/image-20210714173324231.png" alt="image-20210714173324231"  />
</p>
<p>åœ¨user-serviceæœåŠ¡ä¸­ï¼Œä¿®æ”¹UserControllerï¼Œæ·»åŠ ä¸€ä¸ªæ–¹æ³•ï¼š</p>
<p><img loading="lazy" src="assets/image-20210714173721309.png" alt="image-20210714173721309"  />
</p>
<h3 id="3è¿è¡Œä¸¤ä¸ªuserapplicationä½¿ç”¨ä¸åŒçš„profile">3ï¼‰è¿è¡Œä¸¤ä¸ªUserApplicationï¼Œä½¿ç”¨ä¸åŒçš„profile<a hidden class="anchor" aria-hidden="true" href="#3è¿è¡Œä¸¤ä¸ªuserapplicationä½¿ç”¨ä¸åŒçš„profile">#</a></h3>
<p>ä¿®æ”¹UserApplication2è¿™ä¸ªå¯åŠ¨é¡¹ï¼Œæ”¹å˜å…¶profileå€¼ï¼š</p>
<p><img loading="lazy" src="assets/image-20210714173538538.png" alt="image-20210714173538538"  />
</p>
<p><img loading="lazy" src="assets/image-20210714173519963.png" alt="image-20210714173519963"  />
</p>
<p>è¿™æ ·ï¼ŒUserApplication(8081)ä½¿ç”¨çš„profileæ˜¯devï¼ŒUserApplication2(8082)ä½¿ç”¨çš„profileæ˜¯testã€‚</p>
<p>å¯åŠ¨UserApplicationå’ŒUserApplication2</p>
<p>è®¿é—®http://localhost:8081/user/propï¼Œç»“æœï¼š</p>
<p><img loading="lazy" src="assets/image-20210714174313344.png" alt="image-20210714174313344"  />
</p>
<p>è®¿é—®http://localhost:8082/user/propï¼Œç»“æœï¼š</p>
<p><img loading="lazy" src="assets/image-20210714174424818.png" alt="image-20210714174424818"  />
</p>
<p>å¯ä»¥çœ‹å‡ºæ¥ï¼Œä¸ç®¡æ˜¯devï¼Œè¿˜æ˜¯testç¯å¢ƒï¼Œéƒ½è¯»å–åˆ°äº†envSharedValueè¿™ä¸ªå±æ€§çš„å€¼ã€‚</p>
<h3 id="4é…ç½®å…±äº«çš„ä¼˜å…ˆçº§">4ï¼‰é…ç½®å…±äº«çš„ä¼˜å…ˆçº§<a hidden class="anchor" aria-hidden="true" href="#4é…ç½®å…±äº«çš„ä¼˜å…ˆçº§">#</a></h3>
<p>å½“nacosã€æœåŠ¡æœ¬åœ°åŒæ—¶å‡ºç°ç›¸åŒå±æ€§æ—¶ï¼Œä¼˜å…ˆçº§æœ‰é«˜ä½ä¹‹åˆ†ï¼š</p>
<p><img loading="lazy" src="assets/image-20210714174623557.png" alt="image-20210714174623557"  />
</p>
<h2 id="14æ­å»ºnacosé›†ç¾¤">1.4.æ­å»ºNacosé›†ç¾¤<a hidden class="anchor" aria-hidden="true" href="#14æ­å»ºnacosé›†ç¾¤">#</a></h2>
<p>Nacosç”Ÿäº§ç¯å¢ƒä¸‹ä¸€å®šè¦éƒ¨ç½²ä¸ºé›†ç¾¤çŠ¶æ€ï¼Œéƒ¨ç½²æ–¹å¼å‚è€ƒè¯¾å‰èµ„æ–™ä¸­çš„æ–‡æ¡£ï¼š</p>
<p><img loading="lazy" src="assets/image-20210714174728042.png" alt="image-20210714174728042"  />
</p>
<h1 id="2feignè¿œç¨‹è°ƒç”¨">2.Feignè¿œç¨‹è°ƒç”¨<a hidden class="anchor" aria-hidden="true" href="#2feignè¿œç¨‹è°ƒç”¨">#</a></h1>
<p>å…ˆæ¥çœ‹æˆ‘ä»¬ä»¥å‰åˆ©ç”¨RestTemplateå‘èµ·è¿œç¨‹è°ƒç”¨çš„ä»£ç ï¼š</p>
<p><img loading="lazy" src="assets/image-20210714174814204.png" alt="image-20210714174814204"  />
</p>
<p>å­˜åœ¨ä¸‹é¢çš„é—®é¢˜ï¼š</p>
<p>â€¢ä»£ç å¯è¯»æ€§å·®ï¼Œç¼–ç¨‹ä½“éªŒä¸ç»Ÿä¸€</p>
<p>â€¢å‚æ•°å¤æ‚URLéš¾ä»¥ç»´æŠ¤</p>
<p>Feignæ˜¯ä¸€ä¸ªå£°æ˜å¼çš„httpå®¢æˆ·ç«¯ï¼Œå®˜æ–¹åœ°å€ï¼šhttps://github.com/OpenFeign/feign</p>
<p>å…¶ä½œç”¨å°±æ˜¯å¸®åŠ©æˆ‘ä»¬ä¼˜é›…çš„å®ç°httpè¯·æ±‚çš„å‘é€ï¼Œè§£å†³ä¸Šé¢æåˆ°çš„é—®é¢˜ã€‚</p>
<p><img loading="lazy" src="assets/image-20210714174918088.png" alt="image-20210714174918088"  />
</p>
<h2 id="21feignæ›¿ä»£resttemplate">2.1.Feignæ›¿ä»£RestTemplate<a hidden class="anchor" aria-hidden="true" href="#21feignæ›¿ä»£resttemplate">#</a></h2>
<p>Feginçš„ä½¿ç”¨æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<h3 id="1å¼•å…¥ä¾èµ–">1ï¼‰å¼•å…¥ä¾èµ–<a hidden class="anchor" aria-hidden="true" href="#1å¼•å…¥ä¾èµ–">#</a></h3>
<p>æˆ‘ä»¬åœ¨order-serviceæœåŠ¡çš„pomæ–‡ä»¶ä¸­å¼•å…¥feignçš„ä¾èµ–ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework.cloud<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;artifactId&gt;</span>spring-cloud-starter-openfeign<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/dependency&gt;</span>
</span></span></code></pre></div><h3 id="2æ·»åŠ æ³¨è§£">2ï¼‰æ·»åŠ æ³¨è§£<a hidden class="anchor" aria-hidden="true" href="#2æ·»åŠ æ³¨è§£">#</a></h3>
<p>åœ¨order-serviceçš„å¯åŠ¨ç±»æ·»åŠ æ³¨è§£å¼€å¯Feignçš„åŠŸèƒ½ï¼š</p>
<p><img loading="lazy" src="assets/image-20210714175102524.png" alt="image-20210714175102524"  />
</p>
<h3 id="3ç¼–å†™feignçš„å®¢æˆ·ç«¯">3ï¼‰ç¼–å†™Feignçš„å®¢æˆ·ç«¯<a hidden class="anchor" aria-hidden="true" href="#3ç¼–å†™feignçš„å®¢æˆ·ç«¯">#</a></h3>
<p>åœ¨order-serviceä¸­æ–°å»ºä¸€ä¸ªæ¥å£ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> cn.itcast.order.client;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> cn.itcast.order.pojo.User;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.cloud.openfeign.FeignClient;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.web.bind.annotation.GetMapping;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.web.bind.annotation.PathVariable;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@FeignClient</span>(<span style="color:#e6db74">&#34;userservice&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">UserClient</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@GetMapping</span>(<span style="color:#e6db74">&#34;/user/{id}&#34;</span>)
</span></span><span style="display:flex;"><span>    User <span style="color:#a6e22e">findById</span>(<span style="color:#a6e22e">@PathVariable</span>(<span style="color:#e6db74">&#34;id&#34;</span>) Long id);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>è¿™ä¸ªå®¢æˆ·ç«¯ä¸»è¦æ˜¯åŸºäºSpringMVCçš„æ³¨è§£æ¥å£°æ˜è¿œç¨‹è°ƒç”¨çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>æœåŠ¡åç§°ï¼šuserservice</li>
<li>è¯·æ±‚æ–¹å¼ï¼šGET</li>
<li>è¯·æ±‚è·¯å¾„ï¼š/user/{id}</li>
<li>è¯·æ±‚å‚æ•°ï¼šLong id</li>
<li>è¿”å›å€¼ç±»å‹ï¼šUser</li>
</ul>
<p>è¿™æ ·ï¼ŒFeignå°±å¯ä»¥å¸®åŠ©æˆ‘ä»¬å‘é€httpè¯·æ±‚ï¼Œæ— éœ€è‡ªå·±ä½¿ç”¨RestTemplateæ¥å‘é€äº†ã€‚</p>
<h3 id="4æµ‹è¯•">4ï¼‰æµ‹è¯•<a hidden class="anchor" aria-hidden="true" href="#4æµ‹è¯•">#</a></h3>
<p>ä¿®æ”¹order-serviceä¸­çš„OrderServiceç±»ä¸­çš„queryOrderByIdæ–¹æ³•ï¼Œä½¿ç”¨Feignå®¢æˆ·ç«¯ä»£æ›¿RestTemplateï¼š</p>
<p><img loading="lazy" src="assets/image-20210714175415087.png" alt="image-20210714175415087"  />
</p>
<p>æ˜¯ä¸æ˜¯çœ‹èµ·æ¥ä¼˜é›…å¤šäº†ã€‚</p>
<h3 id="5æ€»ç»“">5ï¼‰æ€»ç»“<a hidden class="anchor" aria-hidden="true" href="#5æ€»ç»“">#</a></h3>
<p>ä½¿ç”¨Feignçš„æ­¥éª¤ï¼š</p>
<p>â‘  å¼•å…¥ä¾èµ–</p>
<p>â‘¡ æ·»åŠ @EnableFeignClientsæ³¨è§£</p>
<p>â‘¢ ç¼–å†™FeignClientæ¥å£</p>
<p>â‘£ ä½¿ç”¨FeignClientä¸­å®šä¹‰çš„æ–¹æ³•ä»£æ›¿RestTemplate</p>
<h2 id="22è‡ªå®šä¹‰é…ç½®">2.2.è‡ªå®šä¹‰é…ç½®<a hidden class="anchor" aria-hidden="true" href="#22è‡ªå®šä¹‰é…ç½®">#</a></h2>
<p>Feignå¯ä»¥æ”¯æŒå¾ˆå¤šçš„è‡ªå®šä¹‰é…ç½®ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p>
<table>
<thead>
<tr>
<th>ç±»å‹</th>
<th>ä½œç”¨</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>feign.Logger.Level</strong></td>
<td>ä¿®æ”¹æ—¥å¿—çº§åˆ«</td>
<td>åŒ…å«å››ç§ä¸åŒçš„çº§åˆ«ï¼šNONEã€BASICã€HEADERSã€FULL</td>
</tr>
<tr>
<td>feign.codec.Decoder</td>
<td>å“åº”ç»“æœçš„è§£æå™¨</td>
<td>httpè¿œç¨‹è°ƒç”¨çš„ç»“æœåšè§£æï¼Œä¾‹å¦‚è§£æjsonå­—ç¬¦ä¸²ä¸ºjavaå¯¹è±¡</td>
</tr>
<tr>
<td>feign.codec.Encoder</td>
<td>è¯·æ±‚å‚æ•°ç¼–ç </td>
<td>å°†è¯·æ±‚å‚æ•°ç¼–ç ï¼Œä¾¿äºé€šè¿‡httpè¯·æ±‚å‘é€</td>
</tr>
<tr>
<td>feign. Contract</td>
<td>æ”¯æŒçš„æ³¨è§£æ ¼å¼</td>
<td>é»˜è®¤æ˜¯SpringMVCçš„æ³¨è§£</td>
</tr>
<tr>
<td>feign. Retryer</td>
<td>å¤±è´¥é‡è¯•æœºåˆ¶</td>
<td>è¯·æ±‚å¤±è´¥çš„é‡è¯•æœºåˆ¶ï¼Œé»˜è®¤æ˜¯æ²¡æœ‰ï¼Œä¸è¿‡ä¼šä½¿ç”¨Ribbonçš„é‡è¯•</td>
</tr>
</tbody>
</table>
<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œé»˜è®¤å€¼å°±èƒ½æ»¡è¶³æˆ‘ä»¬ä½¿ç”¨ï¼Œå¦‚æœè¦è‡ªå®šä¹‰æ—¶ï¼Œåªéœ€è¦åˆ›å»ºè‡ªå®šä¹‰çš„@Beanè¦†ç›–é»˜è®¤Beanå³å¯ã€‚</p>
<p>ä¸‹é¢ä»¥æ—¥å¿—ä¸ºä¾‹æ¥æ¼”ç¤ºå¦‚ä½•è‡ªå®šä¹‰é…ç½®ã€‚</p>
<h3 id="221é…ç½®æ–‡ä»¶æ–¹å¼">2.2.1.é…ç½®æ–‡ä»¶æ–¹å¼<a hidden class="anchor" aria-hidden="true" href="#221é…ç½®æ–‡ä»¶æ–¹å¼">#</a></h3>
<p>åŸºäºé…ç½®æ–‡ä»¶ä¿®æ”¹feignçš„æ—¥å¿—çº§åˆ«å¯ä»¥é’ˆå¯¹å•ä¸ªæœåŠ¡ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">feign</span>:  
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">client</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">config</span>: 
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">userservice</span>: <span style="color:#75715e"># é’ˆå¯¹æŸä¸ªå¾®æœåŠ¡çš„é…ç½®</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">loggerLevel</span>: <span style="color:#ae81ff">FULL</span> <span style="color:#75715e">#  æ—¥å¿—çº§åˆ« </span>
</span></span></code></pre></div><p>ä¹Ÿå¯ä»¥é’ˆå¯¹æ‰€æœ‰æœåŠ¡ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">feign</span>:  
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">client</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">config</span>: 
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">default</span>: <span style="color:#75715e"># è¿™é‡Œç”¨defaultå°±æ˜¯å…¨å±€é…ç½®ï¼Œå¦‚æœæ˜¯å†™æœåŠ¡åç§°ï¼Œåˆ™æ˜¯é’ˆå¯¹æŸä¸ªå¾®æœåŠ¡çš„é…ç½®</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">loggerLevel</span>: <span style="color:#ae81ff">FULL</span> <span style="color:#75715e">#  æ—¥å¿—çº§åˆ« </span>
</span></span></code></pre></div><p>è€Œæ—¥å¿—çš„çº§åˆ«åˆ†ä¸ºå››ç§ï¼š</p>
<ul>
<li>NONEï¼šä¸è®°å½•ä»»ä½•æ—¥å¿—ä¿¡æ¯ï¼Œè¿™æ˜¯é»˜è®¤å€¼ã€‚</li>
<li>BASICï¼šä»…è®°å½•è¯·æ±‚çš„æ–¹æ³•ï¼ŒURLä»¥åŠå“åº”çŠ¶æ€ç å’Œæ‰§è¡Œæ—¶é—´</li>
<li>HEADERSï¼šåœ¨BASICçš„åŸºç¡€ä¸Šï¼Œé¢å¤–è®°å½•äº†è¯·æ±‚å’Œå“åº”çš„å¤´ä¿¡æ¯</li>
<li>FULLï¼šè®°å½•æ‰€æœ‰è¯·æ±‚å’Œå“åº”çš„æ˜ç»†ï¼ŒåŒ…æ‹¬å¤´ä¿¡æ¯ã€è¯·æ±‚ä½“ã€å…ƒæ•°æ®ã€‚</li>
</ul>
<h3 id="222javaä»£ç æ–¹å¼">2.2.2.Javaä»£ç æ–¹å¼<a hidden class="anchor" aria-hidden="true" href="#222javaä»£ç æ–¹å¼">#</a></h3>
<p>ä¹Ÿå¯ä»¥åŸºäºJavaä»£ç æ¥ä¿®æ”¹æ—¥å¿—çº§åˆ«ï¼Œå…ˆå£°æ˜ä¸€ä¸ªç±»ï¼Œç„¶åå£°æ˜ä¸€ä¸ªLogger.Levelçš„å¯¹è±¡ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DefaultFeignConfiguration</span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Bean</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> Logger.<span style="color:#a6e22e">Level</span> <span style="color:#a6e22e">feignLogLevel</span>(){
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> Logger.<span style="color:#a6e22e">Level</span>.<span style="color:#a6e22e">BASIC</span>; <span style="color:#75715e">// æ—¥å¿—çº§åˆ«ä¸ºBASIC</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>å¦‚æœè¦<strong>å…¨å±€ç”Ÿæ•ˆ</strong>ï¼Œå°†å…¶æ”¾åˆ°å¯åŠ¨ç±»çš„@EnableFeignClientsè¿™ä¸ªæ³¨è§£ä¸­ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@EnableFeignClients</span>(defaultConfiguration <span style="color:#f92672">=</span> DefaultFeignConfiguration .<span style="color:#a6e22e">class</span>) 
</span></span></code></pre></div><p>å¦‚æœæ˜¯<strong>å±€éƒ¨ç”Ÿæ•ˆ</strong>ï¼Œåˆ™æŠŠå®ƒæ”¾åˆ°å¯¹åº”çš„@FeignClientè¿™ä¸ªæ³¨è§£ä¸­ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@FeignClient</span>(value <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;userservice&#34;</span>, configuration <span style="color:#f92672">=</span> DefaultFeignConfiguration .<span style="color:#a6e22e">class</span>) 
</span></span></code></pre></div><h2 id="23feignä½¿ç”¨ä¼˜åŒ–">2.3.Feignä½¿ç”¨ä¼˜åŒ–<a hidden class="anchor" aria-hidden="true" href="#23feignä½¿ç”¨ä¼˜åŒ–">#</a></h2>
<p>Feignåº•å±‚å‘èµ·httpè¯·æ±‚ï¼Œä¾èµ–äºå…¶å®ƒçš„æ¡†æ¶ã€‚å…¶åº•å±‚å®¢æˆ·ç«¯å®ç°åŒ…æ‹¬ï¼š</p>
<p>â€¢URLConnectionï¼šé»˜è®¤å®ç°ï¼Œä¸æ”¯æŒè¿æ¥æ± </p>
<p>â€¢Apache HttpClient ï¼šæ”¯æŒè¿æ¥æ± </p>
<p>â€¢OKHttpï¼šæ”¯æŒè¿æ¥æ± </p>
<p>å› æ­¤æé«˜Feignçš„æ€§èƒ½ä¸»è¦æ‰‹æ®µå°±æ˜¯ä½¿ç”¨<strong>è¿æ¥æ± </strong>ä»£æ›¿é»˜è®¤çš„URLConnectionã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬ç”¨Apacheçš„HttpClientæ¥æ¼”ç¤ºã€‚</p>
<p>1ï¼‰å¼•å…¥ä¾èµ–</p>
<p>åœ¨order-serviceçš„pomæ–‡ä»¶ä¸­å¼•å…¥Apacheçš„HttpClientä¾èµ–ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#75715e">&lt;!--httpClientçš„ä¾èµ– --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;groupId&gt;</span>io.github.openfeign<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;artifactId&gt;</span>feign-httpclient<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>2ï¼‰é…ç½®è¿æ¥æ± </p>
<p>åœ¨order-serviceçš„application.ymlä¸­æ·»åŠ é…ç½®ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">feign</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">client</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">config</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">default</span>: <span style="color:#75715e"># defaultå…¨å±€çš„é…ç½®</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">loggerLevel</span>: <span style="color:#ae81ff">BASIC</span> <span style="color:#75715e"># æ—¥å¿—çº§åˆ«ï¼ŒBASICå°±æ˜¯åŸºæœ¬çš„è¯·æ±‚å’Œå“åº”ä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">httpclient</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span> <span style="color:#75715e"># å¼€å¯feignå¯¹HttpClientçš„æ”¯æŒ</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">max-connections</span>: <span style="color:#ae81ff">200</span> <span style="color:#75715e"># æœ€å¤§çš„è¿æ¥æ•°</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">max-connections-per-route</span>: <span style="color:#ae81ff">50</span> <span style="color:#75715e"># æ¯ä¸ªè·¯å¾„çš„æœ€å¤§è¿æ¥æ•°</span>
</span></span></code></pre></div><p>æ¥ä¸‹æ¥ï¼Œåœ¨FeignClientFactoryBeanä¸­çš„loadBalanceæ–¹æ³•ä¸­æ‰“æ–­ç‚¹ï¼š</p>
<p><img loading="lazy" src="assets/image-20210714185925910.png" alt="image-20210714185925910"  />
</p>
<p>Debugæ–¹å¼å¯åŠ¨order-serviceæœåŠ¡ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œçš„clientï¼Œåº•å±‚å°±æ˜¯Apache HttpClientï¼š</p>
<p><img loading="lazy" src="assets/image-20210714190041542.png" alt="image-20210714190041542"  />
</p>
<p>æ€»ç»“ï¼ŒFeignçš„ä¼˜åŒ–ï¼š</p>
<p>1.æ—¥å¿—çº§åˆ«å°½é‡ç”¨basic</p>
<p>2.ä½¿ç”¨HttpClientæˆ–OKHttpä»£æ›¿URLConnection</p>
<p>â‘   å¼•å…¥feign-httpClientä¾èµ–</p>
<p>â‘¡  é…ç½®æ–‡ä»¶å¼€å¯httpClientåŠŸèƒ½ï¼Œè®¾ç½®è¿æ¥æ± å‚æ•°</p>
<h2 id="24æœ€ä½³å®è·µ">2.4.æœ€ä½³å®è·µ<a hidden class="anchor" aria-hidden="true" href="#24æœ€ä½³å®è·µ">#</a></h2>
<p>æ‰€è°“æœ€è¿‘å®è·µï¼Œå°±æ˜¯ä½¿ç”¨è¿‡ç¨‹ä¸­æ€»ç»“çš„ç»éªŒï¼Œæœ€å¥½çš„ä¸€ç§ä½¿ç”¨æ–¹å¼ã€‚</p>
<p>è‡ªä¹ è§‚å¯Ÿå¯ä»¥å‘ç°ï¼ŒFeignçš„å®¢æˆ·ç«¯ä¸æœåŠ¡æä¾›è€…çš„controllerä»£ç éå¸¸ç›¸ä¼¼ï¼š</p>
<p>feignå®¢æˆ·ç«¯ï¼š</p>
<p><img loading="lazy" src="assets/image-20210714190542730.png" alt="image-20210714190542730"  />
</p>
<p>UserControllerï¼š</p>
<p><img loading="lazy" src="assets/image-20210714190528450.png" alt="image-20210714190528450"  />
</p>
<p>æœ‰æ²¡æœ‰ä¸€ç§åŠæ³•ç®€åŒ–è¿™ç§é‡å¤çš„ä»£ç ç¼–å†™å‘¢ï¼Ÿ</p>
<h3 id="241ç»§æ‰¿æ–¹å¼">2.4.1.ç»§æ‰¿æ–¹å¼<a hidden class="anchor" aria-hidden="true" href="#241ç»§æ‰¿æ–¹å¼">#</a></h3>
<p>ä¸€æ ·çš„ä»£ç å¯ä»¥é€šè¿‡ç»§æ‰¿æ¥å…±äº«ï¼š</p>
<p>1ï¼‰å®šä¹‰ä¸€ä¸ªAPIæ¥å£ï¼Œåˆ©ç”¨å®šä¹‰æ–¹æ³•ï¼Œå¹¶åŸºäºSpringMVCæ³¨è§£åšå£°æ˜ã€‚</p>
<p>2ï¼‰Feignå®¢æˆ·ç«¯å’ŒControlleréƒ½é›†æˆæ”¹æ¥å£</p>
<p><img loading="lazy" src="assets/image-20210714190640857.png" alt="image-20210714190640857"  />
</p>
<p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>ç®€å•</li>
<li>å®ç°äº†ä»£ç å…±äº«</li>
</ul>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>
<p>æœåŠ¡æä¾›æ–¹ã€æœåŠ¡æ¶ˆè´¹æ–¹ç´§è€¦åˆ</p>
</li>
<li>
<p>å‚æ•°åˆ—è¡¨ä¸­çš„æ³¨è§£æ˜ å°„å¹¶ä¸ä¼šç»§æ‰¿ï¼Œå› æ­¤Controllerä¸­å¿…é¡»å†æ¬¡å£°æ˜æ–¹æ³•ã€å‚æ•°åˆ—è¡¨ã€æ³¨è§£</p>
</li>
</ul>
<h3 id="242æŠ½å–æ–¹å¼">2.4.2.æŠ½å–æ–¹å¼<a hidden class="anchor" aria-hidden="true" href="#242æŠ½å–æ–¹å¼">#</a></h3>
<p>å°†Feignçš„ClientæŠ½å–ä¸ºç‹¬ç«‹æ¨¡å—ï¼Œå¹¶ä¸”æŠŠæ¥å£æœ‰å…³çš„POJOã€é»˜è®¤çš„Feigné…ç½®éƒ½æ”¾åˆ°è¿™ä¸ªæ¨¡å—ä¸­ï¼Œæä¾›ç»™æ‰€æœ‰æ¶ˆè´¹è€…ä½¿ç”¨ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå°†UserClientã€Userã€Feignçš„é»˜è®¤é…ç½®éƒ½æŠ½å–åˆ°ä¸€ä¸ªfeign-apiåŒ…ä¸­ï¼Œæ‰€æœ‰å¾®æœåŠ¡å¼•ç”¨è¯¥ä¾èµ–åŒ…ï¼Œå³å¯ç›´æ¥ä½¿ç”¨ã€‚</p>
<p><img loading="lazy" src="assets/image-20210714214041796.png" alt="image-20210714214041796"  />
</p>
<h3 id="243å®ç°åŸºäºæŠ½å–çš„æœ€ä½³å®è·µ">2.4.3.å®ç°åŸºäºæŠ½å–çš„æœ€ä½³å®è·µ<a hidden class="anchor" aria-hidden="true" href="#243å®ç°åŸºäºæŠ½å–çš„æœ€ä½³å®è·µ">#</a></h3>
<h4 id="1æŠ½å–">1ï¼‰æŠ½å–<a hidden class="anchor" aria-hidden="true" href="#1æŠ½å–">#</a></h4>
<p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªmoduleï¼Œå‘½åä¸ºfeign-apiï¼š</p>
<p><img loading="lazy" src="assets/image-20210714204557771.png" alt="image-20210714204557771"  />
</p>
<p>é¡¹ç›®ç»“æ„ï¼š</p>
<p><img loading="lazy" src="assets/image-20210714204656214.png" alt="image-20210714204656214"  />
</p>
<p>åœ¨feign-apiä¸­ç„¶åå¼•å…¥feignçš„starterä¾èµ–</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework.cloud<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;artifactId&gt;</span>spring-cloud-starter-openfeign<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>ç„¶åï¼Œorder-serviceä¸­ç¼–å†™çš„UserClientã€Userã€DefaultFeignConfigurationéƒ½å¤åˆ¶åˆ°feign-apié¡¹ç›®ä¸­</p>
<p><img loading="lazy" src="assets/image-20210714205221970.png" alt="image-20210714205221970"  />
</p>
<h4 id="2åœ¨order-serviceä¸­ä½¿ç”¨feign-api">2ï¼‰åœ¨order-serviceä¸­ä½¿ç”¨feign-api<a hidden class="anchor" aria-hidden="true" href="#2åœ¨order-serviceä¸­ä½¿ç”¨feign-api">#</a></h4>
<p>é¦–å…ˆï¼Œåˆ é™¤order-serviceä¸­çš„UserClientã€Userã€DefaultFeignConfigurationç­‰ç±»æˆ–æ¥å£ã€‚</p>
<p>åœ¨order-serviceçš„pomæ–‡ä»¶ä¸­ä¸­å¼•å…¥feign-apiçš„ä¾èµ–ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;groupId&gt;</span>cn.itcast.demo<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;artifactId&gt;</span>feign-api<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;version&gt;</span>1.0<span style="color:#f92672">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>ä¿®æ”¹order-serviceä¸­çš„æ‰€æœ‰ä¸ä¸Šè¿°ä¸‰ä¸ªç»„ä»¶æœ‰å…³çš„å¯¼åŒ…éƒ¨åˆ†ï¼Œæ”¹æˆå¯¼å…¥feign-apiä¸­çš„åŒ…</p>
<h4 id="3é‡å¯æµ‹è¯•">3ï¼‰é‡å¯æµ‹è¯•<a hidden class="anchor" aria-hidden="true" href="#3é‡å¯æµ‹è¯•">#</a></h4>
<p>é‡å¯åï¼Œå‘ç°æœåŠ¡æŠ¥é”™äº†ï¼š</p>
<p><img loading="lazy" src="assets/image-20210714205623048.png" alt="image-20210714205623048"  />
</p>
<p>è¿™æ˜¯å› ä¸ºUserClientç°åœ¨åœ¨cn.itcast.feign.clientsåŒ…ä¸‹ï¼Œ</p>
<p>è€Œorder-serviceçš„@EnableFeignClientsæ³¨è§£æ˜¯åœ¨cn.itcast.orderåŒ…ä¸‹ï¼Œä¸åœ¨åŒä¸€ä¸ªåŒ…ï¼Œæ— æ³•æ‰«æåˆ°UserClientã€‚</p>
<h4 id="4è§£å†³æ‰«æåŒ…é—®é¢˜">4ï¼‰è§£å†³æ‰«æåŒ…é—®é¢˜<a hidden class="anchor" aria-hidden="true" href="#4è§£å†³æ‰«æåŒ…é—®é¢˜">#</a></h4>
<p>æ–¹å¼ä¸€ï¼š</p>
<p>æŒ‡å®šFeignåº”è¯¥æ‰«æçš„åŒ…ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@EnableFeignClients</span>(basePackages <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;cn.itcast.feign.clients&#34;</span>)
</span></span></code></pre></div><p>æ–¹å¼äºŒï¼š</p>
<p>æŒ‡å®šéœ€è¦åŠ è½½çš„Clientæ¥å£ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@EnableFeignClients</span>(clients <span style="color:#f92672">=</span> {UserClient.<span style="color:#a6e22e">class</span>})
</span></span></code></pre></div><h1 id="3gatewayæœåŠ¡ç½‘å…³">3.GatewayæœåŠ¡ç½‘å…³<a hidden class="anchor" aria-hidden="true" href="#3gatewayæœåŠ¡ç½‘å…³">#</a></h1>
<p>Spring Cloud Gateway æ˜¯ Spring Cloud çš„ä¸€ä¸ªå…¨æ–°é¡¹ç›®ï¼Œè¯¥é¡¹ç›®æ˜¯åŸºäº Spring 5.0ï¼ŒSpring Boot 2.0 å’Œ Project Reactor ç­‰å“åº”å¼ç¼–ç¨‹å’Œäº‹ä»¶æµæŠ€æœ¯å¼€å‘çš„ç½‘å…³ï¼Œå®ƒæ—¨åœ¨ä¸ºå¾®æœåŠ¡æ¶æ„æä¾›ä¸€ç§ç®€å•æœ‰æ•ˆçš„ç»Ÿä¸€çš„ API è·¯ç”±ç®¡ç†æ–¹å¼ã€‚</p>
<h2 id="31ä¸ºä»€ä¹ˆéœ€è¦ç½‘å…³">3.1.ä¸ºä»€ä¹ˆéœ€è¦ç½‘å…³<a hidden class="anchor" aria-hidden="true" href="#31ä¸ºä»€ä¹ˆéœ€è¦ç½‘å…³">#</a></h2>
<p>Gatewayç½‘å…³æ˜¯æˆ‘ä»¬æœåŠ¡çš„å®ˆé—¨ç¥ï¼Œæ‰€æœ‰å¾®æœåŠ¡çš„ç»Ÿä¸€å…¥å£ã€‚</p>
<p>ç½‘å…³çš„<strong>æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§</strong>ï¼š</p>
<ul>
<li>è¯·æ±‚è·¯ç”±</li>
<li>æƒé™æ§åˆ¶</li>
<li>é™æµ</li>
</ul>
<p>æ¶æ„å›¾ï¼š</p>
<p><img loading="lazy" src="assets/image-20210714210131152.png" alt="image-20210714210131152"  />
</p>
<p><strong>æƒé™æ§åˆ¶</strong>ï¼šç½‘å…³ä½œä¸ºå¾®æœåŠ¡å…¥å£ï¼Œéœ€è¦æ ¡éªŒç”¨æˆ·æ˜¯æ˜¯å¦æœ‰è¯·æ±‚èµ„æ ¼ï¼Œå¦‚æœæ²¡æœ‰åˆ™è¿›è¡Œæ‹¦æˆªã€‚</p>
<p><strong>è·¯ç”±å’Œè´Ÿè½½å‡è¡¡</strong>ï¼šä¸€åˆ‡è¯·æ±‚éƒ½å¿…é¡»å…ˆç»è¿‡gatewayï¼Œä½†ç½‘å…³ä¸å¤„ç†ä¸šåŠ¡ï¼Œè€Œæ˜¯æ ¹æ®æŸç§è§„åˆ™ï¼ŒæŠŠè¯·æ±‚è½¬å‘åˆ°æŸä¸ªå¾®æœåŠ¡ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åšè·¯ç”±ã€‚å½“ç„¶è·¯ç”±çš„ç›®æ ‡æœåŠ¡æœ‰å¤šä¸ªæ—¶ï¼Œè¿˜éœ€è¦åšè´Ÿè½½å‡è¡¡ã€‚</p>
<p><strong>é™æµ</strong>ï¼šå½“è¯·æ±‚æµé‡è¿‡é«˜æ—¶ï¼Œåœ¨ç½‘å…³ä¸­æŒ‰ç…§ä¸‹æµçš„å¾®æœåŠ¡èƒ½å¤Ÿæ¥å—çš„é€Ÿåº¦æ¥æ”¾è¡Œè¯·æ±‚ï¼Œé¿å…æœåŠ¡å‹åŠ›è¿‡å¤§ã€‚</p>
<p>åœ¨SpringCloudä¸­ç½‘å…³çš„å®ç°åŒ…æ‹¬ä¸¤ç§ï¼š</p>
<ul>
<li>gateway</li>
<li>zuul</li>
</ul>
<p>Zuulæ˜¯åŸºäºServletçš„å®ç°ï¼Œå±äºé˜»å¡å¼ç¼–ç¨‹ã€‚è€ŒSpringCloudGatewayåˆ™æ˜¯åŸºäºSpring5ä¸­æä¾›çš„WebFluxï¼Œå±äºå“åº”å¼ç¼–ç¨‹çš„å®ç°ï¼Œå…·å¤‡æ›´å¥½çš„æ€§èƒ½ã€‚</p>
<h2 id="32gatewayå¿«é€Ÿå…¥é—¨">3.2.gatewayå¿«é€Ÿå…¥é—¨<a hidden class="anchor" aria-hidden="true" href="#32gatewayå¿«é€Ÿå…¥é—¨">#</a></h2>
<p>ä¸‹é¢ï¼Œæˆ‘ä»¬å°±æ¼”ç¤ºä¸‹ç½‘å…³çš„åŸºæœ¬è·¯ç”±åŠŸèƒ½ã€‚åŸºæœ¬æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>åˆ›å»ºSpringBootå·¥ç¨‹gatewayï¼Œå¼•å…¥ç½‘å…³ä¾èµ–</li>
<li>ç¼–å†™å¯åŠ¨ç±»</li>
<li>ç¼–å†™åŸºç¡€é…ç½®å’Œè·¯ç”±è§„åˆ™</li>
<li>å¯åŠ¨ç½‘å…³æœåŠ¡è¿›è¡Œæµ‹è¯•</li>
</ol>
<h3 id="1åˆ›å»ºgatewayæœåŠ¡å¼•å…¥ä¾èµ–">1ï¼‰åˆ›å»ºgatewayæœåŠ¡ï¼Œå¼•å…¥ä¾èµ–<a hidden class="anchor" aria-hidden="true" href="#1åˆ›å»ºgatewayæœåŠ¡å¼•å…¥ä¾èµ–">#</a></h3>
<p>åˆ›å»ºæœåŠ¡ï¼š</p>
<p><img loading="lazy" src="assets/image-20210714210919458.png" alt="image-20210714210919458"  />
</p>
<p>å¼•å…¥ä¾èµ–ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#75715e">&lt;!--ç½‘å…³--&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework.cloud<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;artifactId&gt;</span>spring-cloud-starter-gateway<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;!--nacosæœåŠ¡å‘ç°ä¾èµ–--&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;groupId&gt;</span>com.alibaba.cloud<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;artifactId&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/dependency&gt;</span>
</span></span></code></pre></div><h3 id="2ç¼–å†™å¯åŠ¨ç±»">2ï¼‰ç¼–å†™å¯åŠ¨ç±»<a hidden class="anchor" aria-hidden="true" href="#2ç¼–å†™å¯åŠ¨ç±»">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> cn.itcast.gateway;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.boot.SpringApplication;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@SpringBootApplication</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">GatewayApplication</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>(String<span style="color:#f92672">[]</span> args) {
</span></span><span style="display:flex;"><span>		SpringApplication.<span style="color:#a6e22e">run</span>(GatewayApplication.<span style="color:#a6e22e">class</span>, args);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="3ç¼–å†™åŸºç¡€é…ç½®å’Œè·¯ç”±è§„åˆ™">3ï¼‰ç¼–å†™åŸºç¡€é…ç½®å’Œè·¯ç”±è§„åˆ™<a hidden class="anchor" aria-hidden="true" href="#3ç¼–å†™åŸºç¡€é…ç½®å’Œè·¯ç”±è§„åˆ™">#</a></h3>
<p>åˆ›å»ºapplication.ymlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">server</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">port</span>: <span style="color:#ae81ff">10010</span> <span style="color:#75715e"># ç½‘å…³ç«¯å£</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spring</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">application</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">gateway</span> <span style="color:#75715e"># æœåŠ¡åç§°</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">cloud</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">nacos</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">server-addr</span>: <span style="color:#ae81ff">localhost:8848</span> <span style="color:#75715e"># nacosåœ°å€</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">gateway</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">routes</span>: <span style="color:#75715e"># ç½‘å…³è·¯ç”±é…ç½®</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">id</span>: <span style="color:#ae81ff">user-service</span> <span style="color:#75715e"># è·¯ç”±idï¼Œè‡ªå®šä¹‰ï¼Œåªè¦å”¯ä¸€å³å¯</span>
</span></span><span style="display:flex;"><span>          <span style="color:#75715e"># uri: http://127.0.0.1:8081 # è·¯ç”±çš„ç›®æ ‡åœ°å€ httpå°±æ˜¯å›ºå®šåœ°å€</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">uri</span>: <span style="color:#ae81ff">lb://userservice</span> <span style="color:#75715e"># è·¯ç”±çš„ç›®æ ‡åœ°å€ lbå°±æ˜¯è´Ÿè½½å‡è¡¡ï¼Œåé¢è·ŸæœåŠ¡åç§°</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">predicates</span>: <span style="color:#75715e"># è·¯ç”±æ–­è¨€ï¼Œä¹Ÿå°±æ˜¯åˆ¤æ–­è¯·æ±‚æ˜¯å¦ç¬¦åˆè·¯ç”±è§„åˆ™çš„æ¡ä»¶</span>
</span></span><span style="display:flex;"><span>            - <span style="color:#ae81ff">Path=/user/**</span> <span style="color:#75715e"># è¿™ä¸ªæ˜¯æŒ‰ç…§è·¯å¾„åŒ¹é…ï¼Œåªè¦ä»¥/user/å¼€å¤´å°±ç¬¦åˆè¦æ±‚</span>
</span></span></code></pre></div><p>æˆ‘ä»¬å°†ç¬¦åˆ<code>Path</code> è§„åˆ™çš„ä¸€åˆ‡è¯·æ±‚ï¼Œéƒ½ä»£ç†åˆ° <code>uri</code>å‚æ•°æŒ‡å®šçš„åœ°å€ã€‚</p>
<p>æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å°† <code>/user/**</code>å¼€å¤´çš„è¯·æ±‚ï¼Œä»£ç†åˆ°<code>lb://userservice</code>ï¼Œlbæ˜¯è´Ÿè½½å‡è¡¡ï¼Œæ ¹æ®æœåŠ¡åæ‹‰å–æœåŠ¡åˆ—è¡¨ï¼Œå®ç°è´Ÿè½½å‡è¡¡ã€‚</p>
<h3 id="4é‡å¯æµ‹è¯•">4ï¼‰é‡å¯æµ‹è¯•<a hidden class="anchor" aria-hidden="true" href="#4é‡å¯æµ‹è¯•">#</a></h3>
<p>é‡å¯ç½‘å…³ï¼Œè®¿é—®http://localhost:10010/user/1æ—¶ï¼Œç¬¦åˆ<code>/user/**</code>è§„åˆ™ï¼Œè¯·æ±‚è½¬å‘åˆ°uriï¼šhttp://userservice/user/1ï¼Œå¾—åˆ°äº†ç»“æœï¼š</p>
<p><img loading="lazy" src="assets/image-20210714211908341.png" alt="image-20210714211908341"  />
</p>
<h3 id="5ç½‘å…³è·¯ç”±çš„æµç¨‹å›¾">5ï¼‰ç½‘å…³è·¯ç”±çš„æµç¨‹å›¾<a hidden class="anchor" aria-hidden="true" href="#5ç½‘å…³è·¯ç”±çš„æµç¨‹å›¾">#</a></h3>
<p>æ•´ä¸ªè®¿é—®çš„æµç¨‹å¦‚ä¸‹ï¼š</p>
<p><img loading="lazy" src="assets/image-20210714211742956.png" alt="image-20210714211742956"  />
</p>
<p>æ€»ç»“ï¼š</p>
<p>ç½‘å…³æ­å»ºæ­¥éª¤ï¼š</p>
<ol>
<li>
<p>åˆ›å»ºé¡¹ç›®ï¼Œå¼•å…¥nacosæœåŠ¡å‘ç°å’Œgatewayä¾èµ–</p>
</li>
<li>
<p>é…ç½®application.ymlï¼ŒåŒ…æ‹¬æœåŠ¡åŸºæœ¬ä¿¡æ¯ã€nacosåœ°å€ã€è·¯ç”±</p>
</li>
</ol>
<p>è·¯ç”±é…ç½®åŒ…æ‹¬ï¼š</p>
<ol>
<li>
<p>è·¯ç”±idï¼šè·¯ç”±çš„å”¯ä¸€æ ‡ç¤º</p>
</li>
<li>
<p>è·¯ç”±ç›®æ ‡ï¼ˆuriï¼‰ï¼šè·¯ç”±çš„ç›®æ ‡åœ°å€ï¼Œhttpä»£è¡¨å›ºå®šåœ°å€ï¼Œlbä»£è¡¨æ ¹æ®æœåŠ¡åè´Ÿè½½å‡è¡¡</p>
</li>
<li>
<p>è·¯ç”±æ–­è¨€ï¼ˆpredicatesï¼‰ï¼šåˆ¤æ–­è·¯ç”±çš„è§„åˆ™ï¼Œ</p>
</li>
<li>
<p>è·¯ç”±è¿‡æ»¤å™¨ï¼ˆfiltersï¼‰ï¼šå¯¹è¯·æ±‚æˆ–å“åº”åšå¤„ç†</p>
</li>
</ol>
<p>æ¥ä¸‹æ¥ï¼Œå°±é‡ç‚¹æ¥å­¦ä¹ è·¯ç”±æ–­è¨€å’Œè·¯ç”±è¿‡æ»¤å™¨çš„è¯¦ç»†çŸ¥è¯†</p>
<h2 id="33æ–­è¨€å·¥å‚">3.3.æ–­è¨€å·¥å‚<a hidden class="anchor" aria-hidden="true" href="#33æ–­è¨€å·¥å‚">#</a></h2>
<p>æˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ä¸­å†™çš„æ–­è¨€è§„åˆ™åªæ˜¯å­—ç¬¦ä¸²ï¼Œè¿™äº›å­—ç¬¦ä¸²ä¼šè¢«Predicate Factoryè¯»å–å¹¶å¤„ç†ï¼Œè½¬å˜ä¸ºè·¯ç”±åˆ¤æ–­çš„æ¡ä»¶</p>
<p>ä¾‹å¦‚Path=/user/**æ˜¯æŒ‰ç…§è·¯å¾„åŒ¹é…ï¼Œè¿™ä¸ªè§„åˆ™æ˜¯ç”±</p>
<p><code>org.springframework.cloud.gateway.handler.predicate.PathRoutePredicateFactory</code>ç±»æ¥</p>
<p>å¤„ç†çš„ï¼Œåƒè¿™æ ·çš„æ–­è¨€å·¥å‚åœ¨SpringCloudGatewayè¿˜æœ‰åå‡ ä¸ª:</p>
<table>
<thead>
<tr>
<th><strong>åç§°</strong></th>
<th><strong>è¯´æ˜</strong></th>
<th><strong>ç¤ºä¾‹</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>After</td>
<td>æ˜¯æŸä¸ªæ—¶é—´ç‚¹åçš„è¯·æ±‚</td>
<td>-  After=2037-01-20T17:42:47.789-07:00[America/Denver]</td>
</tr>
<tr>
<td>Before</td>
<td>æ˜¯æŸä¸ªæ—¶é—´ç‚¹ä¹‹å‰çš„è¯·æ±‚</td>
<td>-  Before=2031-04-13T15:14:47.433+08:00[Asia/Shanghai]</td>
</tr>
<tr>
<td>Between</td>
<td>æ˜¯æŸä¸¤ä¸ªæ—¶é—´ç‚¹ä¹‹å‰çš„è¯·æ±‚</td>
<td>-  Between=2037-01-20T17:42:47.789-07:00[America/Denver],  2037-01-21T17:42:47.789-07:00[America/Denver]</td>
</tr>
<tr>
<td>Cookie</td>
<td>è¯·æ±‚å¿…é¡»åŒ…å«æŸäº›cookie</td>
<td>- Cookie=chocolate, ch.p</td>
</tr>
<tr>
<td>Header</td>
<td>è¯·æ±‚å¿…é¡»åŒ…å«æŸäº›header</td>
<td>- Header=X-Request-Id, \d+</td>
</tr>
<tr>
<td>Host</td>
<td>è¯·æ±‚å¿…é¡»æ˜¯è®¿é—®æŸä¸ªhostï¼ˆåŸŸåï¼‰</td>
<td>-  Host=<strong>.somehost.org,</strong>.anotherhost.org</td>
</tr>
<tr>
<td>Method</td>
<td>è¯·æ±‚æ–¹å¼å¿…é¡»æ˜¯æŒ‡å®šæ–¹å¼</td>
<td>- Method=GET,POST</td>
</tr>
<tr>
<td>Path</td>
<td>è¯·æ±‚è·¯å¾„å¿…é¡»ç¬¦åˆæŒ‡å®šè§„åˆ™</td>
<td>- Path=/red/{segment},/blue/**</td>
</tr>
<tr>
<td>Query</td>
<td>è¯·æ±‚å‚æ•°å¿…é¡»åŒ…å«æŒ‡å®šå‚æ•°</td>
<td>- Query=name, Jackæˆ–è€…-  Query=name</td>
</tr>
<tr>
<td>RemoteAddr</td>
<td>è¯·æ±‚è€…çš„ipå¿…é¡»æ˜¯æŒ‡å®šèŒƒå›´</td>
<td>- RemoteAddr=192.168.1.1/24</td>
</tr>
<tr>
<td>Weight</td>
<td>æƒé‡å¤„ç†</td>
<td></td>
</tr>
</tbody>
</table>
<p>æˆ‘ä»¬åªéœ€è¦æŒæ¡Pathè¿™ç§è·¯ç”±å·¥ç¨‹å°±å¯ä»¥äº†ã€‚</p>
<h2 id="34è¿‡æ»¤å™¨å·¥å‚">3.4.è¿‡æ»¤å™¨å·¥å‚<a hidden class="anchor" aria-hidden="true" href="#34è¿‡æ»¤å™¨å·¥å‚">#</a></h2>
<p>GatewayFilteræ˜¯ç½‘å…³ä¸­æä¾›çš„ä¸€ç§è¿‡æ»¤å™¨ï¼Œå¯ä»¥å¯¹è¿›å…¥ç½‘å…³çš„è¯·æ±‚å’Œå¾®æœåŠ¡è¿”å›çš„å“åº”åšå¤„ç†ï¼š</p>
<p><img loading="lazy" src="assets/image-20210714212312871.png" alt="image-20210714212312871"  />
</p>
<h3 id="341è·¯ç”±è¿‡æ»¤å™¨çš„ç§ç±»">3.4.1.è·¯ç”±è¿‡æ»¤å™¨çš„ç§ç±»<a hidden class="anchor" aria-hidden="true" href="#341è·¯ç”±è¿‡æ»¤å™¨çš„ç§ç±»">#</a></h3>
<p>Springæä¾›äº†31ç§ä¸åŒçš„è·¯ç”±è¿‡æ»¤å™¨å·¥å‚ã€‚ä¾‹å¦‚ï¼š</p>
<table>
<thead>
<tr>
<th><strong>åç§°</strong></th>
<th><strong>è¯´æ˜</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>AddRequestHeader</td>
<td>ç»™å½“å‰è¯·æ±‚æ·»åŠ ä¸€ä¸ªè¯·æ±‚å¤´</td>
</tr>
<tr>
<td>RemoveRequestHeader</td>
<td>ç§»é™¤è¯·æ±‚ä¸­çš„ä¸€ä¸ªè¯·æ±‚å¤´</td>
</tr>
<tr>
<td>AddResponseHeader</td>
<td>ç»™å“åº”ç»“æœä¸­æ·»åŠ ä¸€ä¸ªå“åº”å¤´</td>
</tr>
<tr>
<td>RemoveResponseHeader</td>
<td>ä»å“åº”ç»“æœä¸­ç§»é™¤æœ‰ä¸€ä¸ªå“åº”å¤´</td>
</tr>
<tr>
<td>RequestRateLimiter</td>
<td>é™åˆ¶è¯·æ±‚çš„æµé‡</td>
</tr>
</tbody>
</table>
<h3 id="342è¯·æ±‚å¤´è¿‡æ»¤å™¨">3.4.2.è¯·æ±‚å¤´è¿‡æ»¤å™¨<a hidden class="anchor" aria-hidden="true" href="#342è¯·æ±‚å¤´è¿‡æ»¤å™¨">#</a></h3>
<p>ä¸‹é¢æˆ‘ä»¬ä»¥AddRequestHeader ä¸ºä¾‹æ¥è®²è§£ã€‚</p>
<blockquote>
<p><strong>éœ€æ±‚</strong>ï¼šç»™æ‰€æœ‰è¿›å…¥userserviceçš„è¯·æ±‚æ·»åŠ ä¸€ä¸ªè¯·æ±‚å¤´ï¼šTruth=itcast is freaking awesome!</p>
</blockquote>
<p>åªéœ€è¦ä¿®æ”¹gatewayæœåŠ¡çš„application.ymlæ–‡ä»¶ï¼Œæ·»åŠ è·¯ç”±è¿‡æ»¤å³å¯ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">spring</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">cloud</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">gateway</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">routes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">id</span>: <span style="color:#ae81ff">user-service </span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uri</span>: <span style="color:#ae81ff">lb://userservice </span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">predicates</span>: 
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">Path=/user/** </span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">filters</span>: <span style="color:#75715e"># è¿‡æ»¤å™¨</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">AddRequestHeader=Truth, Itcast is freaking awesome!</span> <span style="color:#75715e"># æ·»åŠ è¯·æ±‚å¤´</span>
</span></span></code></pre></div><p>å½“å‰è¿‡æ»¤å™¨å†™åœ¨userserviceè·¯ç”±ä¸‹ï¼Œå› æ­¤ä»…ä»…å¯¹è®¿é—®userserviceçš„è¯·æ±‚æœ‰æ•ˆã€‚</p>
<h3 id="343é»˜è®¤è¿‡æ»¤å™¨">3.4.3.é»˜è®¤è¿‡æ»¤å™¨<a hidden class="anchor" aria-hidden="true" href="#343é»˜è®¤è¿‡æ»¤å™¨">#</a></h3>
<p>å¦‚æœè¦å¯¹æ‰€æœ‰çš„è·¯ç”±éƒ½ç”Ÿæ•ˆï¼Œåˆ™å¯ä»¥å°†è¿‡æ»¤å™¨å·¥å‚å†™åˆ°defaultä¸‹ã€‚æ ¼å¼å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">spring</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">cloud</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">gateway</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">routes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">id</span>: <span style="color:#ae81ff">user-service </span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uri</span>: <span style="color:#ae81ff">lb://userservice </span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">predicates</span>: 
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">Path=/user/**</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">default-filters</span>: <span style="color:#75715e"># é»˜è®¤è¿‡æ»¤é¡¹</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">AddRequestHeader=Truth, Itcast is freaking awesome! </span>
</span></span></code></pre></div><h3 id="344æ€»ç»“">3.4.4.æ€»ç»“<a hidden class="anchor" aria-hidden="true" href="#344æ€»ç»“">#</a></h3>
<p>è¿‡æ»¤å™¨çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>â‘  å¯¹è·¯ç”±çš„è¯·æ±‚æˆ–å“åº”åšåŠ å·¥å¤„ç†ï¼Œæ¯”å¦‚æ·»åŠ è¯·æ±‚å¤´</p>
<p>â‘¡ é…ç½®åœ¨è·¯ç”±ä¸‹çš„è¿‡æ»¤å™¨åªå¯¹å½“å‰è·¯ç”±çš„è¯·æ±‚ç”Ÿæ•ˆ</p>
<p>defaultFiltersçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>â‘  å¯¹æ‰€æœ‰è·¯ç”±éƒ½ç”Ÿæ•ˆçš„è¿‡æ»¤å™¨</p>
<h2 id="35å…¨å±€è¿‡æ»¤å™¨">3.5.å…¨å±€è¿‡æ»¤å™¨<a hidden class="anchor" aria-hidden="true" href="#35å…¨å±€è¿‡æ»¤å™¨">#</a></h2>
<p>ä¸Šä¸€èŠ‚å­¦ä¹ çš„è¿‡æ»¤å™¨ï¼Œç½‘å…³æä¾›äº†31ç§ï¼Œä½†æ¯ä¸€ç§è¿‡æ»¤å™¨çš„ä½œç”¨éƒ½æ˜¯å›ºå®šçš„ã€‚å¦‚æœæˆ‘ä»¬å¸Œæœ›æ‹¦æˆªè¯·æ±‚ï¼Œåšè‡ªå·±çš„ä¸šåŠ¡é€»è¾‘åˆ™æ²¡åŠæ³•å®ç°ã€‚</p>
<h3 id="351å…¨å±€è¿‡æ»¤å™¨ä½œç”¨">3.5.1.å…¨å±€è¿‡æ»¤å™¨ä½œç”¨<a hidden class="anchor" aria-hidden="true" href="#351å…¨å±€è¿‡æ»¤å™¨ä½œç”¨">#</a></h3>
<p>å…¨å±€è¿‡æ»¤å™¨çš„ä½œç”¨ä¹Ÿæ˜¯å¤„ç†ä¸€åˆ‡è¿›å…¥ç½‘å…³çš„è¯·æ±‚å’Œå¾®æœåŠ¡å“åº”ï¼Œä¸GatewayFilterçš„ä½œç”¨ä¸€æ ·ã€‚åŒºåˆ«åœ¨äºGatewayFilteré€šè¿‡é…ç½®å®šä¹‰ï¼Œå¤„ç†é€»è¾‘æ˜¯å›ºå®šçš„ï¼›è€ŒGlobalFilterçš„é€»è¾‘éœ€è¦è‡ªå·±å†™ä»£ç å®ç°ã€‚</p>
<p>å®šä¹‰æ–¹å¼æ˜¯å®ç°GlobalFilteræ¥å£ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">GlobalFilter</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *  å¤„ç†å½“å‰è¯·æ±‚ï¼Œæœ‰å¿…è¦çš„è¯é€šè¿‡{@link GatewayFilterChain}å°†è¯·æ±‚äº¤ç»™ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨å¤„ç†
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param exchange è¯·æ±‚ä¸Šä¸‹æ–‡ï¼Œé‡Œé¢å¯ä»¥è·å–Requestã€Responseç­‰ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param chain ç”¨æ¥æŠŠè¯·æ±‚å§”æ‰˜ç»™ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨ 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return {@code Mono&lt;Void&gt;} è¿”å›æ ‡ç¤ºå½“å‰è¿‡æ»¤å™¨ä¸šåŠ¡ç»“æŸ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    Mono<span style="color:#f92672">&lt;</span>Void<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">filter</span>(ServerWebExchange exchange, GatewayFilterChain chain);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>åœ¨filterä¸­ç¼–å†™è‡ªå®šä¹‰é€»è¾‘ï¼Œå¯ä»¥å®ç°ä¸‹åˆ—åŠŸèƒ½ï¼š</p>
<ul>
<li>ç™»å½•çŠ¶æ€åˆ¤æ–­</li>
<li>æƒé™æ ¡éªŒ</li>
<li>è¯·æ±‚é™æµç­‰</li>
</ul>
<h3 id="352è‡ªå®šä¹‰å…¨å±€è¿‡æ»¤å™¨">3.5.2.è‡ªå®šä¹‰å…¨å±€è¿‡æ»¤å™¨<a hidden class="anchor" aria-hidden="true" href="#352è‡ªå®šä¹‰å…¨å±€è¿‡æ»¤å™¨">#</a></h3>
<p>éœ€æ±‚ï¼šå®šä¹‰å…¨å±€è¿‡æ»¤å™¨ï¼Œæ‹¦æˆªè¯·æ±‚ï¼Œåˆ¤æ–­è¯·æ±‚çš„å‚æ•°æ˜¯å¦æ»¡è¶³ä¸‹é¢æ¡ä»¶ï¼š</p>
<ul>
<li>
<p>å‚æ•°ä¸­æ˜¯å¦æœ‰authorizationï¼Œ</p>
</li>
<li>
<p>authorizationå‚æ•°å€¼æ˜¯å¦ä¸ºadmin</p>
</li>
</ul>
<p>å¦‚æœåŒæ—¶æ»¡è¶³åˆ™æ”¾è¡Œï¼Œå¦åˆ™æ‹¦æˆª</p>
<p>å®ç°ï¼š</p>
<p>åœ¨gatewayä¸­å®šä¹‰ä¸€ä¸ªè¿‡æ»¤å™¨ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> cn.itcast.gateway.filters;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.cloud.gateway.filter.GatewayFilterChain;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.cloud.gateway.filter.GlobalFilter;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.core.annotation.Order;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.http.HttpStatus;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.stereotype.Component;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.web.server.ServerWebExchange;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> reactor.core.publisher.Mono;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Order</span>(<span style="color:#f92672">-</span>1)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Component</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AuthorizeFilter</span> <span style="color:#66d9ef">implements</span> GlobalFilter {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> Mono<span style="color:#f92672">&lt;</span>Void<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">filter</span>(ServerWebExchange exchange, GatewayFilterChain chain) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 1.è·å–è¯·æ±‚å‚æ•°</span>
</span></span><span style="display:flex;"><span>        MultiValueMap<span style="color:#f92672">&lt;</span>String, String<span style="color:#f92672">&gt;</span> params <span style="color:#f92672">=</span> exchange.<span style="color:#a6e22e">getRequest</span>().<span style="color:#a6e22e">getQueryParams</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 2.è·å–authorizationå‚æ•°</span>
</span></span><span style="display:flex;"><span>        String auth <span style="color:#f92672">=</span> params.<span style="color:#a6e22e">getFirst</span>(<span style="color:#e6db74">&#34;authorization&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 3.æ ¡éªŒ</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#e6db74">&#34;admin&#34;</span>.<span style="color:#a6e22e">equals</span>(auth)) {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// æ”¾è¡Œ</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> chain.<span style="color:#a6e22e">filter</span>(exchange);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 4.æ‹¦æˆª</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 4.1.ç¦æ­¢è®¿é—®ï¼Œè®¾ç½®çŠ¶æ€ç </span>
</span></span><span style="display:flex;"><span>        exchange.<span style="color:#a6e22e">getResponse</span>().<span style="color:#a6e22e">setStatusCode</span>(HttpStatus.<span style="color:#a6e22e">FORBIDDEN</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 4.2.ç»“æŸå¤„ç†</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> exchange.<span style="color:#a6e22e">getResponse</span>().<span style="color:#a6e22e">setComplete</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="353è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåº">3.5.3.è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåº<a hidden class="anchor" aria-hidden="true" href="#353è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåº">#</a></h3>
<p>è¯·æ±‚è¿›å…¥ç½‘å…³ä¼šç¢°åˆ°ä¸‰ç±»è¿‡æ»¤å™¨ï¼šå½“å‰è·¯ç”±çš„è¿‡æ»¤å™¨ã€DefaultFilterã€GlobalFilter</p>
<p>è¯·æ±‚è·¯ç”±åï¼Œä¼šå°†å½“å‰è·¯ç”±è¿‡æ»¤å™¨å’ŒDefaultFilterã€GlobalFilterï¼Œåˆå¹¶åˆ°ä¸€ä¸ªè¿‡æ»¤å™¨é“¾ï¼ˆé›†åˆï¼‰ä¸­ï¼Œæ’åºåä¾æ¬¡æ‰§è¡Œæ¯ä¸ªè¿‡æ»¤å™¨ï¼š</p>
<p><img loading="lazy" src="assets/image-20210714214228409.png" alt="image-20210714214228409"  />
</p>
<p>æ’åºçš„è§„åˆ™æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<ul>
<li>æ¯ä¸€ä¸ªè¿‡æ»¤å™¨éƒ½å¿…é¡»æŒ‡å®šä¸€ä¸ªintç±»å‹çš„orderå€¼ï¼Œ<strong>orderå€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œæ‰§è¡Œé¡ºåºè¶Šé å‰</strong>ã€‚</li>
<li>GlobalFilteré€šè¿‡å®ç°Orderedæ¥å£ï¼Œæˆ–è€…æ·»åŠ @Orderæ³¨è§£æ¥æŒ‡å®šorderå€¼ï¼Œç”±æˆ‘ä»¬è‡ªå·±æŒ‡å®š</li>
<li>è·¯ç”±è¿‡æ»¤å™¨å’ŒdefaultFilterçš„orderç”±SpringæŒ‡å®šï¼Œé»˜è®¤æ˜¯æŒ‰ç…§å£°æ˜é¡ºåºä»1é€’å¢ã€‚</li>
<li>å½“è¿‡æ»¤å™¨çš„orderå€¼ä¸€æ ·æ—¶ï¼Œä¼šæŒ‰ç…§ defaultFilter &gt; è·¯ç”±è¿‡æ»¤å™¨ &gt; GlobalFilterçš„é¡ºåºæ‰§è¡Œã€‚</li>
</ul>
<p>è¯¦ç»†å†…å®¹ï¼Œå¯ä»¥æŸ¥çœ‹æºç ï¼š</p>
<p><code>org.springframework.cloud.gateway.route.RouteDefinitionRouteLocator#getFilters()</code>æ–¹æ³•æ˜¯å…ˆåŠ è½½defaultFiltersï¼Œç„¶åå†åŠ è½½æŸä¸ªrouteçš„filtersï¼Œç„¶ååˆå¹¶ã€‚</p>
<p><code>org.springframework.cloud.gateway.handler.FilteringWebHandler#handle()</code>æ–¹æ³•ä¼šåŠ è½½å…¨å±€è¿‡æ»¤å™¨ï¼Œä¸å‰é¢çš„è¿‡æ»¤å™¨åˆå¹¶åæ ¹æ®orderæ’åºï¼Œç»„ç»‡è¿‡æ»¤å™¨é“¾</p>
<h2 id="36è·¨åŸŸé—®é¢˜">3.6.è·¨åŸŸé—®é¢˜<a hidden class="anchor" aria-hidden="true" href="#36è·¨åŸŸé—®é¢˜">#</a></h2>
<h3 id="361ä»€ä¹ˆæ˜¯è·¨åŸŸé—®é¢˜">3.6.1.ä»€ä¹ˆæ˜¯è·¨åŸŸé—®é¢˜<a hidden class="anchor" aria-hidden="true" href="#361ä»€ä¹ˆæ˜¯è·¨åŸŸé—®é¢˜">#</a></h3>
<p>è·¨åŸŸï¼šåŸŸåä¸ä¸€è‡´å°±æ˜¯è·¨åŸŸï¼Œä¸»è¦åŒ…æ‹¬ï¼š</p>
<ul>
<li>
<p>åŸŸåä¸åŒï¼š <a href="https://www.taobao.com">www.taobao.com</a> å’Œ <a href="https://www.taobao.org">www.taobao.org</a> å’Œ <a href="https://www.jd.com">www.jd.com</a> å’Œ miaosha.jd.com</p>
</li>
<li>
<p>åŸŸåç›¸åŒï¼Œç«¯å£ä¸åŒï¼šlocalhost:8080å’Œlocalhost8081</p>
</li>
</ul>
<p>è·¨åŸŸé—®é¢˜ï¼šæµè§ˆå™¨ç¦æ­¢è¯·æ±‚çš„å‘èµ·è€…ä¸æœåŠ¡ç«¯å‘ç”Ÿè·¨åŸŸajaxè¯·æ±‚ï¼Œè¯·æ±‚è¢«æµè§ˆå™¨æ‹¦æˆªçš„é—®é¢˜</p>
<p>è§£å†³æ–¹æ¡ˆï¼šCORSï¼Œè¿™ä¸ªä»¥å‰åº”è¯¥å­¦ä¹ è¿‡ï¼Œè¿™é‡Œä¸å†èµ˜è¿°äº†ã€‚ä¸çŸ¥é“çš„å°ä¼™ä¼´å¯ä»¥æŸ¥çœ‹https://www.ruanyifeng.com/blog/2016/04/cors.html</p>
<h3 id="362æ¨¡æ‹Ÿè·¨åŸŸé—®é¢˜">3.6.2.æ¨¡æ‹Ÿè·¨åŸŸé—®é¢˜<a hidden class="anchor" aria-hidden="true" href="#362æ¨¡æ‹Ÿè·¨åŸŸé—®é¢˜">#</a></h3>
<p>æ‰¾åˆ°è¯¾å‰èµ„æ–™çš„é¡µé¢æ–‡ä»¶ï¼š</p>
<p><img loading="lazy" src="assets/image-20210714215713563.png" alt="image-20210714215713563"  />
</p>
<p>æ”¾å…¥tomcatæˆ–è€…nginxè¿™æ ·çš„webæœåŠ¡å™¨ä¸­ï¼Œå¯åŠ¨å¹¶è®¿é—®ã€‚</p>
<p>å¯ä»¥åœ¨æµè§ˆå™¨æ§åˆ¶å°çœ‹åˆ°ä¸‹é¢çš„é”™è¯¯ï¼š</p>
<p><img loading="lazy" src="assets/image-20210714215832675.png" alt="image-20210714215832675"  />
</p>
<p>ä»localhost:8090è®¿é—®localhost:10010ï¼Œç«¯å£ä¸åŒï¼Œæ˜¾ç„¶æ˜¯è·¨åŸŸçš„è¯·æ±‚ã€‚</p>
<h3 id="363è§£å†³è·¨åŸŸé—®é¢˜">3.6.3.è§£å†³è·¨åŸŸé—®é¢˜<a hidden class="anchor" aria-hidden="true" href="#363è§£å†³è·¨åŸŸé—®é¢˜">#</a></h3>
<p>åœ¨gatewayæœåŠ¡çš„application.ymlæ–‡ä»¶ä¸­ï¼Œæ·»åŠ ä¸‹é¢çš„é…ç½®ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">spring</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">cloud</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">gateway</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># ã€‚ã€‚ã€‚</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">globalcors</span>: <span style="color:#75715e"># å…¨å±€çš„è·¨åŸŸå¤„ç†</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">add-to-simple-url-handler-mapping</span>: <span style="color:#66d9ef">true</span> <span style="color:#75715e"># è§£å†³optionsè¯·æ±‚è¢«æ‹¦æˆªé—®é¢˜</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">corsConfigurations</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#39;[/**]&#39;</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">allowedOrigins</span>: <span style="color:#75715e"># å…è®¸å“ªäº›ç½‘ç«™çš„è·¨åŸŸè¯·æ±‚ </span>
</span></span><span style="display:flex;"><span>              - <span style="color:#e6db74">&#34;http://localhost:8090&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">allowedMethods</span>: <span style="color:#75715e"># å…è®¸çš„è·¨åŸŸajaxçš„è¯·æ±‚æ–¹å¼</span>
</span></span><span style="display:flex;"><span>              - <span style="color:#e6db74">&#34;GET&#34;</span>
</span></span><span style="display:flex;"><span>              - <span style="color:#e6db74">&#34;POST&#34;</span>
</span></span><span style="display:flex;"><span>              - <span style="color:#e6db74">&#34;DELETE&#34;</span>
</span></span><span style="display:flex;"><span>              - <span style="color:#e6db74">&#34;PUT&#34;</span>
</span></span><span style="display:flex;"><span>              - <span style="color:#e6db74">&#34;OPTIONS&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">allowedHeaders</span>: <span style="color:#e6db74">&#34;*&#34;</span> <span style="color:#75715e"># å…è®¸åœ¨è¯·æ±‚ä¸­æºå¸¦çš„å¤´ä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">allowCredentials</span>: <span style="color:#66d9ef">true</span> <span style="color:#75715e"># æ˜¯å¦å…è®¸æºå¸¦cookie</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">maxAge</span>: <span style="color:#ae81ff">360000</span> <span style="color:#75715e"># è¿™æ¬¡è·¨åŸŸæ£€æµ‹çš„æœ‰æ•ˆæœŸ</span>
</span></span></code></pre></div>

        </div>

        <footer class="post-footer">
            
<nav class="paginav">
  <a class="prev" href="https://XianCH.github.io/posts/tech/distributed/%E5%A4%9A%E7%BA%A7%E7%BC%93%E5%AD%98/">
    <span class="title">Â« ä¸Šä¸€é¡µ</span>
    <br>
    <span>å¤šçº§ç¼“å­˜</span>
  </a>
  <a class="next" href="https://XianCH.github.io/posts/tech/distributed/rabbitmq%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97/">
    <span class="title">ä¸‹ä¸€é¡µ Â»</span>
    <br>
    <span>RabbitMqéƒ¨ç½²æŒ‡å—</span>
  </a>
</nav>

        </footer>
    </div>






</article>
</main>

<footer class="footer">
    <span>
        Copyright
        &copy;
        -2024
        <a href="https://XianCH.github.io/" style="color:#939393;">X14n&#39;s Blog</a>
        All Rights Reserved
    </span>
    <a href="https://beian.miit.gov.cn/" target="_blank" style="color:#939393;"></a>&nbsp;
    <span>
        <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=null"
           style="display:inline-block;text-decoration:none;height:20px;color:#939393;">
            <img src="" style="float:left;margin: 0px 5px 0px 0px;"/>
            
        </a>
    </span>
    <span id="busuanzi_container">
        <span class="fa fa-user"></span> <span id="busuanzi_value_site_uv"></span>
        <span class="fa fa-eye"></span> <span id="busuanzi_value_site_pv"></span>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <span class="topInner">
        <svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z"/>
        </svg>
        <span id="read_progress"></span>
    </span>
</a>

<script>
    document.addEventListener('scroll', function (e) {
        const readProgress = document.getElementById("read_progress");
        const scrollHeight = document.documentElement.scrollHeight;
        const clientHeight = document.documentElement.clientHeight;
        const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
        readProgress.innerText = ((scrollTop / (scrollHeight - clientHeight)).toFixed(2) * 100).toFixed(0);
    })
</script>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });
</script>
<script>
    let mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };
</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        (function() {
            document.cookie = "change-themes" + "="+ escape ("false");
        })()

        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    });
</script>

<script>
    document.body.addEventListener('copy', function (e) {
        if (window.getSelection().toString() && window.getSelection().toString().length > 50) {
            let clipboardData = e.clipboardData || window.clipboardData;
            if (clipboardData) {
                e.preventDefault();
                let htmlData = window.getSelection().toString() +
                    '\r\n\nâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r\n' +
                    'ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œ'+"X14n's Blog"+'ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚' +
                '\r\nåŸæ–‡é“¾æ¥ï¼š' + location.href;
                let textData = window.getSelection().toString() +
                    '\r\n\nâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r\n' +
                    'ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œ'+"X14n's Blog"+'ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚' +
                '\r\nåŸæ–‡é“¾æ¥ï¼š' + location.href;
                clipboardData.setData('text/html', htmlData);
                clipboardData.setData('text/plain', textData);
            }
        }
    });
</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;
        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'å¤åˆ¶';

        function copyingDone() {
            copybutton.innerText = 'å·²å¤åˆ¶ï¼';
            setTimeout(() => {
                copybutton.innerText = 'å¤åˆ¶';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                let text = codeblock.textContent +
                    '\r\nâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r\n' +
                    'ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œ'+"X14n's Blog"+'ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚' +
                '\r\nåŸæ–‡é“¾æ¥ï¼š' + location.href;
                navigator.clipboard.writeText(text);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) {}
            selection.removeRange(range);
        });

        let language = codeblock.className.replaceAll("language-", "")
        let macTool = document.createElement("div")
        let macTool1 = document.createElement("div")
        let macTool2 = document.createElement("div")
        let macTool3 = document.createElement("div")
        let languageType = document.createElement("div")
        languageType.innerText = language
        macTool.setAttribute('class', 'mac-tool')
        macTool1.setAttribute('class', 'mac bb1')
        macTool2.setAttribute('class', 'mac bb2')
        macTool3.setAttribute('class', 'mac bb3')
        languageType.setAttribute('class', 'language-type')
        macTool.appendChild(macTool1)
        macTool.appendChild(macTool2)
        macTool.appendChild(macTool3)
        macTool.appendChild(languageType)

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
            container.appendChild(macTool)
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
            container.appendChild(macTool)
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
            container.appendChild(macTool)
        }
    });
</script>
<script>
    $("code[class^=language] ").on("mouseover", function () {
        if (this.clientWidth < this.scrollWidth) {
            $(this).css("width", "135%")
            $(this).css("border-top-right-radius", "var(--radius)")
        }
    }).on("mouseout", function () {
        $(this).css("width", "100%")
        $(this).css("border-top-right-radius", "unset")
    })
</script>
</body>

</html>
